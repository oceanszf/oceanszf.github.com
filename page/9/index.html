<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Suzf Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Suzf linux tech blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Suzf Blog">
<meta property="og:url" content="http://blog.suzf.net/page/9/index.html">
<meta property="og:site_name" content="Suzf Blog">
<meta property="og:description" content="Suzf linux tech blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Suzf Blog">
<meta name="twitter:description" content="Suzf linux tech blog">
  
    <link rel="alternative" href="/atom.xml" title="Suzf Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Suzf Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Life is short, We need smile.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.suzf.net"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-linux-web-server-site-failure-analysis-commonly-used-commands" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/07/05/linux-web-server-site-failure-analysis-commonly-used-commands/" class="article-date">
  <time datetime="2015-07-05T09:50:59.000Z" itemprop="datePublished">2015-07-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web/">Web</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/05/linux-web-server-site-failure-analysis-commonly-used-commands/">Linux Web 服务器网站故障分析常用的命令</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>系统连接状态篇：<br>1.查看TCP连接状态<br>netstat -nat |awk ‘{print $6}’|sort|uniq -c|sort -rn<br>netstat -n | awk ‘/^tcp/ {++S[$NF]};END {for(a in S) print a, S[a]}’ 或<br>netstat -n | awk ‘/^tcp/ {++state[$NF]}; END {for(key in state) print key,”t”,state[key]}’<br>netstat -n | awk ‘/^tcp/ {++arr[$NF]};END {for(k in arr) print k,”t”,arr[k]}’<br>netstat -n |awk ‘/^tcp/ {print $NF}’|sort|uniq -c|sort -rn<br>netstat -ant | awk ‘{print $NF}’ | grep -v ‘[a-z]’ | sort | uniq -c</p>
<p>2.查找请求数请20个IP（常用于查找攻来源）：</p>
<p>netstat -anlp|grep 80|grep tcp|awk ‘{print $5}’|awk -F: ‘{print $1}’|sort|uniq -c|sort -nr|head -n20</p>
<p>netstat -ant |awk ‘/:80/{split($5,ip,”:”);++A[ip[1]]}END{for(i in A) print A[i],i}’ |sort -rn|head -n20</p>
<p>&nbsp;</p>
<p>3.用tcpdump嗅探80端口的访问看看谁最高</p>
<p>tcpdump -i eth0 -tnn dst port 80 -c 1000 | awk -F”.” ‘{print $1”.”$2”.”$3”.”$4}’ | sort | uniq -c | sort -nr |head -20</p>
<p>&nbsp;</p>
<p>4.查找较多time_wait连接</p>
<p>netstat -n|grep TIME_WAIT|awk ‘{print $5}’|sort|uniq -c|sort -rn|head -n20</p>
<p>&nbsp;</p>
<p>5.找查较多的SYN连接</p>
<p>netstat -an | grep SYN | awk ‘{print $5}’ | awk -F: ‘{print $1}’ | sort | uniq -c | sort -nr | more</p>
<p>&nbsp;</p>
<p>6.根据端口列进程</p>
<p>netstat -ntlp | grep 80 | awk ‘{print $7}’ | cut -d/ -f1</p>
<p>&nbsp;</p>
<p>网站日志分析篇1（Apache）：<br>1.获得访问前10位的ip地址</p>
<p>cat access.log|awk ‘{print $1}’|sort|uniq -c|sort -nr|head -10<br>cat access.log|awk ‘{counts[$(11)]+=1}; END {for(url in counts) print counts[url], url}’</p>
<p>2.访问次数最多的文件或页面,取前20</p>
<p>cat access.log|awk ‘{print $11}’|sort|uniq -c|sort -nr|head -20</p>
<p>3.列出传输最大的几个exe文件（分析下载站的时候常用）</p>
<p>cat access.log |awk ‘($7~/.exe/){print $10 “ “ $1 “ “ $4 “ “ $7}’|sort -nr|head -20</p>
<p>4.列出输出大于200000byte(约200kb)的exe文件以及对应文件发生次数</p>
<p>cat access.log |awk ‘($10 &gt; 200000 &amp;&amp; $7~/.exe/){print $7}’|sort -n|uniq -c|sort -nr|head -100</p>
<p>5.如果日志最后一列记录的是页面文件传输时间，则有列出到客户端最耗时的页面</p>
<p>cat access.log |awk ‘($7~/.php/){print $NF “ “ $1 “ “ $4 “ “ $7}’|sort -nr|head -100</p>
<p>6.列出最最耗时的页面(超过60秒的)的以及对应页面发生次数</p>
<p>cat access.log |awk ‘($NF &gt; 60 &amp;&amp; $7~/.php/){print $7}’|sort -n|uniq -c|sort -nr|head -100</p>
<p>7.列出传输时间超过 30 秒的文件</p>
<p>cat access.log |awk ‘($NF &gt; 30){print $7}’|sort -n|uniq -c|sort -nr|head -20</p>
<p>8.统计网站流量（G)</p>
<p>cat access.log |awk ‘{sum+=$10} END {print sum/1024/1024/1024}’</p>
<p>9.统计404的连接</p>
<p>awk ‘($9 ~/404/)’ access.log | awk ‘{print $9,$7}’ | sort</p>
<p>10. 统计http status</p>
<p>cat access.log |awk ‘{counts[$(9)]+=1}; END {for(code in counts) print code, counts[code]}’<br>cat access.log |awk ‘{print $9}’|sort|uniq -c|sort -rn</p>
<p>10.蜘蛛分析，查看是哪些蜘蛛在抓取内容。</p>
<p>/usr/sbin/tcpdump -i eth0 -l -s 0 -w - dst port 80 | strings | grep -i user-agent | grep -i -E ‘bot|crawler|slurp|spider’<br>网站日分析2(Squid篇）按域统计流量</p>
<p>zcat squid_access.log.tar.gz| awk ‘{print $10,$7}’ |awk ‘BEGIN{FS=”[ /]”}{trfc[$4]+=$1}END{for(domain in trfc){printf “%st%dn”,domain,trfc[domain]}}’</p>
<p>&nbsp;</p>
<p>数据库篇<br>1.查看数据库执行的sql</p>
<p>/usr/sbin/tcpdump -i eth0 -s 0 -l -w - dst port 3306 | strings | egrep -i ‘SELECT|UPDATE|DELETE|INSERT|SET|COMMIT|ROLLBACK|CREATE|DROP|ALTER|CALL’</p>
<p>&nbsp;</p>
<p>系统Debug分析篇<br>1.调试命令<br>strace -p pid<br>2.跟踪指定进程的PID<br>gdb -p pid</p>
<p>&nbsp;</p>
<p><span style="color: #003300;"><strong>#############################################</strong></span><br><span style="color: #003300;"><strong> # Version     1.0.0                                                    #</strong></span><br><span style="color: #003300;"><strong> # Copyright GPLV2                                                 #</strong></span><br><span style="color: #003300;"><strong> # Date         July 5, 2015                                         #</strong></span><br><span style="color: #003300;"><strong> # Author     Jeffrey.su                                             #</strong></span><br><span style="color: #003300;"><strong> # Mail          jeffrey.su@suzf.net                              #</strong></span><br><span style="color: #003300;"><strong> # Website   <a href="http://suzf.net" target="_blank" rel="external">http://suzf.net</a>                              #</strong></span><br><span style="color: #003300;"><strong> # 如需重新发行，请注明以上信息，谢谢合作       #</strong></span><br><span style="color: #003300;"><strong> ############################################</strong></span></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.suzf.net/2015/07/05/linux-web-server-site-failure-analysis-commonly-used-commands/" data-id="ciqcd6lqq006zclo9i8yzfmu5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CMD/">CMD</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/">web</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-xiao-ming-is-gone-he-had-lived-in-Beijing-brutally" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/07/01/xiao-ming-is-gone-he-had-lived-in-Beijing-brutally/" class="article-date">
  <time datetime="2015-07-01T02:09:54.000Z" itemprop="datePublished">2015-07-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Life/">Life</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/01/xiao-ming-is-gone-he-had-lived-in-Beijing-brutally/">[ 致运维 ] 小明走了，他曾在北京残酷地活过</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>导读：故事的主人公是我的高中同学，现在“小明”这个名字很火，刚好他名字里也有一个“明”字，因此，我们也叫他小明好了。</p>
<p>高考时候，小明选择了一个很牛很牛的专业，叫“采暖、给排水与通风”。但由于皮肤黝黑，他固执地认为自己天生就是个黑客。作为高中班级里唯一一个没有考上本科的学生，读完三年的专科，小明选择了专升本，而且是跨专业，跳槽去学计算机。<br>
        
          <p class="article-more-link">
            <a href="/2015/07/01/xiao-ming-is-gone-he-had-lived-in-Beijing-brutally/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.suzf.net/2015/07/01/xiao-ming-is-gone-he-had-lived-in-Beijing-brutally/" data-id="ciqcd6lke001sclo9yn0xjyul" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Life/">Life</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-faq-flask-attributeerror-module-object-has-no-attribute-autoescape" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/12/faq-flask-attributeerror-module-object-has-no-attribute-autoescape/" class="article-date">
  <time datetime="2015-06-12T09:27:57.000Z" itemprop="datePublished">2015-06-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Python/">Python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/12/faq-flask-attributeerror-module-object-has-no-attribute-autoescape/">Flask_Faq :  AttributeError: &#39;module&#39; object has no attribute &#39;autoescape&#39;</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>前些天从 “spider_net” 上找了一篇文章 , 大致就是利用 highcharts + flask + mysql 构建的一个简单的监控系统 ,<br>经过几番挣扎终于还是给捣持出来了 , 现在总结一下 , 分享给大家 .   o_O</p>
<p>部分报错信息：</p>
<ul>
<li>Detected change in ‘flask_web.py’, reloading </li>
<li>Restarting with reloader<br>X.X.X.X - - [11/Jun/2015 15:24:14] “GET / HTTP/1.1” 500 -<br>Traceback (most recent call last):<br>…<br>…<br>File “/usr/lib64/python2.6/site-packages/jinja2/utils.py”, line 195, in import_string<br>return getattr(<strong>import</strong>(module, None, None, [obj]), obj)<br>AttributeError: ‘module’ object has no attribute ‘autoescape’ </li>
</ul>
<p>解决办法：<br>yum install python-pip -y<br>pip install –upgrade jinja2</p>
<p>redhat 官方宣称这是一个bug , for more :<br><a href="https://bugzilla.redhat.com/show_bug.cgi?id=799087" target="_blank" rel="external">https://bugzilla.redhat.com/show_bug.cgi?id=799087</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.suzf.net/2015/06/12/faq-flask-attributeerror-module-object-has-no-attribute-autoescape/" data-id="ciqcd6lu9009qclo9g0z9lowr" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bug/">bug</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/faq/">faq</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pip/">pip</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-python-pip-simple-instructions" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/11/python-pip-simple-instructions/" class="article-date">
  <time datetime="2015-06-11T13:47:18.000Z" itemprop="datePublished">2015-06-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Python/">Python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/11/python-pip-simple-instructions/">Python pip  简单使用说明</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>简单来说 pip 就是 Python 的一个包管理工具, 和 yum / apt-get 有异曲同工之妙 。<br>好了， 会到正文<br>~(≧▽≦)/~</p>
<p>1、安装</p>
<h1 id="yum_install_python-pip_-y"><a href="#yum_install_python-pip_-y" class="headerlink" title="yum install python-pip -y"></a>yum install python-pip -y</h1><p>or</p>
<h1 id="wget__u201Chttps_3A//pypi-python-org/packages/source/p/pip/pip-1-5-4-tar-gz_23md5_3D834b2904f92d46aaa333267fb1c922bb_u201C__u2013no-check-certificate"><a href="#wget__u201Chttps_3A//pypi-python-org/packages/source/p/pip/pip-1-5-4-tar-gz_23md5_3D834b2904f92d46aaa333267fb1c922bb_u201C__u2013no-check-certificate" class="headerlink" title="wget “https://pypi.python.org/packages/source/p/pip/pip-1.5.4.tar.gz#md5=834b2904f92d46aaa333267fb1c922bb“ –no-check-certificate"></a>wget “<a href="https://pypi.python.org/packages/source/p/pip/pip-1.5.4.tar.gz#md5=834b2904f92d46aaa333267fb1c922bb" target="_blank" rel="external">https://pypi.python.org/packages/source/p/pip/pip-1.5.4.tar.gz#md5=834b2904f92d46aaa333267fb1c922bb</a>“ –no-check-certificate</h1><h1 id="tar_-xzvf_pip-1-5-4-tar-gz"><a href="#tar_-xzvf_pip-1-5-4-tar-gz" class="headerlink" title="tar -xzvf pip-1.5.4.tar.gz"></a>tar -xzvf pip-1.5.4.tar.gz</h1><h1 id="cd_pip-1-5-4__26amp_3B_26amp_3B_python_setup-py_install"><a href="#cd_pip-1-5-4__26amp_3B_26amp_3B_python_setup-py_install" class="headerlink" title="cd pip-1.5.4 &amp;&amp; python setup.py install"></a>cd pip-1.5.4 &amp;&amp; python setup.py install</h1><p>升级</p>
<p>pip install –upgrade pip</p>
<p>2. 常用操作</p>
<p>#安装</p>
<h1 id="pip_install_pkgname"><a href="#pip_install_pkgname" class="headerlink" title="pip install pkgname"></a>pip install pkgname</h1><p>#卸载<br>$ pip uninstall pkgname</p>
<p>#升级</p>
<h1 id="pip_install__u2013upgrade_pkgname"><a href="#pip_install__u2013upgrade_pkgname" class="headerlink" title="pip install –upgrade pkgname"></a>pip install –upgrade pkgname</h1><p>#检测更新</p>
<h1 id="pip_list__u2013outdated"><a href="#pip_list__u2013outdated" class="headerlink" title="pip list –outdated"></a>pip list –outdated</h1><p>#查看</p>
<h1 id="pip_show__u2013files_pkgname"><a href="#pip_show__u2013files_pkgname" class="headerlink" title="pip show –files pkgname"></a>pip show –files pkgname</h1><p>#查看某个库的信息：</p>
<h1 id="pip_show_Jinja2"><a href="#pip_show_Jinja2" class="headerlink" title="pip show Jinja2"></a>pip show Jinja2</h1><h1 id="u67E5_u770B_u5DF2_u7ECF_u5B89_u88C5_u7684_u5E93_uFF1A"><a href="#u67E5_u770B_u5DF2_u7ECF_u5B89_u88C5_u7684_u5E93_uFF1A" class="headerlink" title="查看已经安装的库："></a>查看已经安装的库：</h1><p>pip list    or   pip freze</p>
<p>3. FAQ :</p>
<p>ImportError No module named setuptools<br>请参考《ImportError No module named setuptools解决》</p>
<p>4. 参数说明</p>
<h1 id="pip_-h"><a href="#pip_-h" class="headerlink" title="pip -h"></a>pip -h</h1><p>Usage:<br>pip <command> [options]</p>
<p>Commands:<br>install 安装包.<br>uninstall 卸载包.<br>freeze 按着一定格式输出已安装包列表<br>list 列出已安装包.<br>show 显示包详细信息.<br>search 搜索包，类似yum里的search.<br>wheel Build wheels from your requirements.<br>zip 不推荐. Zip individual packages.<br>unzip 不推荐. Unzip individual packages.<br>bundle 不推荐. Create pybundles.<br>help 当前帮助.</p>
<p>General Options:<br>-h, –help 显示帮助.<br>-v, –verbose 更多的输出，最多可以使用3次<br>-V, –version 现实版本信息然后退出.<br>-q, –quiet 最少的输出.<br>–log-file 覆盖的方式记录verbose错误日志，默认文件：/root/.pip/pip.log<br>–log 不覆盖记录verbose输出的日志.<br>–proxy Specify a proxy in the form [user:passwd@]proxy.server:port.<br>–timeout 连接超时时间 (默认15秒).<br>–exists-action Default action when a path already exists: (s)witch, (i)gnore, (w)ipe, (b)ackup.<br>–cert 证书.</p>
<p>Learn more : <a href="https://pypi.python.org/pypi/pip" target="_blank" rel="external">https://pypi.python.org/pypi/pip</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.suzf.net/2015/06/11/python-pip-simple-instructions/" data-id="ciqcd6lna0042clo9id3f6uh5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pip/">pip</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-use_mutt_sendmail_with_attachment" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/01/use_mutt_sendmail_with_attachment/" class="article-date">
  <time datetime="2015-06-01T04:27:12.000Z" itemprop="datePublished">2015-06-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/01/use_mutt_sendmail_with_attachment/">use mutt/postfix to send attachment</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>使用Mutt发邮件极其方便,只需要一条命令即可发送或者批量发送邮件<br>功能说明：E-mail管理程序。</p>
<p>语　　法：mutt [-hnpRvxz][-a&lt;文件&gt;][-b&lt;地址&gt;][-c&lt;地址&gt;][-f&lt;邮件文件&gt;][-F&lt;配置文件&gt;][-H&lt;邮件草稿&gt;][-i&lt;文件&gt;][-m&lt;类型&gt;][-s&lt;主题&gt;][邮件地址]</p>
<p>补充说明：mutt是一个文字模式的邮件管理程序，提供了全屏幕的操作界面。</p>
<p>参　　数：<br>-a&lt;文件&gt; 在邮件中加上附加文件。<br>-b&lt;地址&gt; 指定密件副本的收信人地址。<br>-c&lt;地址&gt; 指定副本的收信人地址。<br>-f&lt;邮件文件&gt; 指定要载入的邮件文件。<br>-F&lt;配置文件&gt; 指定mutt程序的设置文件，而不读取预设的.muttrc文件。<br>-h 显示帮助。<br>-H&lt;邮件草稿&gt; 将指定的邮件草稿送出。<br>-i&lt;文件&gt; 将指定文件插入邮件内文中。<br>-m&lt;类型&gt; 指定预设的邮件信箱类型。<br>-n 不要去读取程序培植文件(/etc/Muttrc)。<br>-p 在mutt中编辑完邮件后，而不想将邮件立即送出，可将该邮件暂缓寄出。<br>-R 以只读的方式开启邮件文件。<br>-s&lt;主题&gt; 指定邮件的主题。<br>-v 显示mutt的版本信息以及当初编译此文件时所给予的参数。<br>-x 模拟mailx的编辑方式。<br>-z 与-f参数一并使用时，若邮件文件中没有邮件即不启动mutt。</p>
<p>1.安装方法<br>Centos安装 #<br>yum install -y mutt</p>
<p>2.使用方法<br>最简单的测试方法<br>echo “Test” | mutt -s “Title” xxx@qq.com</p>
<p>带附件的<br>echo “Test” | mutt -s “mysql backup” -a /xxx.tar.gz xxx@qq.com</p>
<p>读取文本中的信息作为内容<br>mutt -s “Test” xxx@qq.com</p>
<p>添加多个附件<br>echo “Test” | mutt -s “web backup” -a /mysql.tar.gz -a /web.tar.gz xxxx@qq.com</p>
<p>#读取mail.txt内容为邮件内容,内容必须UTF8编码,否则乱码</p>
<p>3.设置发件人<br>编辑配置文件<br>vi /etc/Muttrc</p>
<p>添加如下内容,防止被作为垃圾邮件<br>set from = “robot@suzf.net”<br>set use_from = yes<br>set envelope_from = “yes”<br>set realname = “Robot”</p>
<p>FAQ:<br>通常来说目前主流的邮箱支持的邮箱附件仅在 百兆之内 [ qq 单个邮件附件为 70M]。</p>
<p>#echo “mutt test” |mutt username@domain.name -s “test”   -a “/root/xxx.tar.gz”<br>postdrop: warning: uid=0: File too large<br>sendmail: fatal: root(0): message file too big<br>Error sending message, child exited 75 (Deferred.).<br>Could not send the message.</p>
<p>#查看日志<br>Jan 25 15:43:08 xxx postfix/smtp[26575]: 9DB3A1160C2: to=<a href="/&#x6d;&#x61;&#105;&#x6c;&#x74;&#111;&#x3a;&#120;&#x78;&#120;&#x78;&#120;&#120;&#x78;&#x78;&#120;&#x40;&#113;&#113;&#46;&#x63;&#111;&#x6d;">&#120;&#x78;&#120;&#x78;&#120;&#120;&#x78;&#x78;&#120;&#x40;&#113;&#113;&#46;&#x63;&#111;&#x6d;</a>, relay=mx3.qq.com[184.105.206.32]:25, delay=9.8, delays=3.6/0.29/5.9/0, dsn=5.3.4, status=bounced (message size 92650110 exceeds size limit 73400320 of server mx3.qq.com[184.105.206.32])</p>
<p>方案：<br>修改main.cf里面的message_size_limit参数，调大点。<br>如果里面没有，自己手工加一个。单位是字节，如果不懂用法，man 5 postconf找到这个参数的说明<br>eg: 修改成如下大小即可（1G）<br>postconf -e “message_size_limit = 1024000000”<br>postconf -e “mailbox_size_limit = 1024000000”</p>
<p>再次发送邮件可以收到邮件了， So cool!</p>
<p>注：发送邮件略慢，需要等待一分钟或者更长才能发送成功(可做定时备份)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.suzf.net/2015/06/01/use_mutt_sendmail_with_attachment/" data-id="ciqcd6llb002lclo9iwayftvp" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-puppet-drawing-module-into-a-dependency-graph" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/05/26/puppet-drawing-module-into-a-dependency-graph/" class="article-date">
  <time datetime="2015-05-26T13:36:59.000Z" itemprop="datePublished">2015-05-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Puppet/">Puppet</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/26/puppet-drawing-module-into-a-dependency-graph/">Puppet drawing module into a dependency graph</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>依赖使关系迅速变得复杂，并且很容易结束循环依赖，（其中A依赖B，B又依赖A）这将引起<br>puppet编译错误并停止工作，幸运的是，puppet的图表选项可以很容易生成一个资源之间的依赖<br>关系图，它可以帮助我们解决这些问题。</p>
<p>准备工作：</p>
<p>1.安装看图文件所需要的graphviz软件包：</p>
<h1 id="apt-get_install_graphviz"><a href="#apt-get_install_graphviz" class="headerlink" title="apt-get install graphviz"></a>apt-get install graphviz</h1><p>如何做<br>1.创建/etc/puppet/modules/admin/manifests/ntp.pp文件，并使用下面的代码包含一个循环依赖：<br>class admin::ntp {<br>     package { “ntp”:<br>         ensure =&gt; installed,<br>         require =&gt; File[“/etc/ntp.conf”],**<br>     }</p>
<pre><code>service { &quot;ntp&quot;:
    ensure  =&gt; running,
    require =&gt; Package[&quot;ntp&quot;],
}

file { &quot;/etc/ntp.conf&quot;:
    source  =&gt; &quot;puppet:///modules/admin/ntp.conf&quot;,
    notify  =&gt; Service[&quot;ntp&quot;],
    require =&gt; Package[&quot;ntp&quot;],
}
</code></pre><p> }<br>2.复制已经存在的ntp.conf文件到admin模块files目录:</p>
<h1 id="cp_/etc/ntp-conf_/etc/puppet/modules/admin/files"><a href="#cp_/etc/ntp-conf_/etc/puppet/modules/admin/files" class="headerlink" title="cp /etc/ntp.conf /etc/puppet/modules/admin/files"></a>cp /etc/ntp.conf /etc/puppet/modules/admin/files</h1><p>3. 添加要执行这个类的客户端节点：<br> node cookbook {<br>   include admin::ntp<br> }<br>4.客户端运行puppet:</p>
<h1 id="puppet_agent__u2013test"><a href="#puppet_agent__u2013test" class="headerlink" title="puppet agent –test"></a>puppet agent –test</h1><p> info: Retrieving plugin<br> info: Caching catalog for cookbook.bitfieldconsulting.com<br> err: Could not apply complete catalog: Found dependency cycles in<br>the following relationships: File[/etc/ntp.conf] =&gt; Package[ntp],<br>Package[ntp] =&gt; File[/etc/ntp.conf], Package[ntp] =&gt; Service[ntp],<br>File[/etc/ntp.conf] =&gt; Service[ntp]; try using the ‘–graph’<br>option and open the ‘.dot’ files in OmniGraffle or GraphViz<br>notice: Finished catalog run in 0.42 seconds<br>5.查看图片文件是否已创建</p>
<h1 id="ls_/var/lib/puppet/state/graphs/"><a href="#ls_/var/lib/puppet/state/graphs/" class="headerlink" title="ls /var/lib/puppet/state/graphs/"></a>ls /var/lib/puppet/state/graphs/</h1><p> expanded_relationships.dot  relationships.dot  resources.dot<br>6.创建一个图形化的关系依赖图：</p>
<h1 id="dot_-Tpng_-o_relationships-png_/var/lib/puppet/state/graphs/relationships-dot"><a href="#dot_-Tpng_-o_relationships-png_/var/lib/puppet/state/graphs/relationships-dot" class="headerlink" title="dot -Tpng -o relationships.png /var/lib/puppet/state/graphs/relationships.dot"></a>dot -Tpng -o relationships.png /var/lib/puppet/state/graphs/relationships.dot</h1><p>7.查看图片:如下图所示</p>
<h1 id="eog_relationships-png"><a href="#eog_relationships-png" class="headerlink" title="eog relationships.png"></a>eog relationships.png</h1><p>是如何工作的<br>当你使用puppet –graph(或者在配置文件里启用图形化)，puppet 会生成三个DOT格式的<br>三个文件（图形语言）<br>resource.dot 显示资源的类和次结构，但没有依赖关系。<br>releationships.dot 以箭头显示资源之间的依赖关系，如上图<br>expanded_relationships.dot 一个更详细的版本关系图<br>dot工具（graphviz软件包的一部分）可以将这些图像等转换为png格式进行查看。<br>在关系图中，每个资源在你的代码中显示为一个气球，用带箭头的线，连接他们表示依赖，在上面的<br>例子中我们可以看到，在文件/etc/ntp.conf与软件包ntp之间的依赖关系，</p>
<p>为了解决相互依赖关系的问题，所以你要做的就是删除依赖关系之一的线，因此可以打破循环。<br>还有更多</p>
<p>即使你不用去寻找bug，资源和关系图都非常有用，如果你有一个非常复杂的网络类和资源，<br>例如：研究资源图表可以让你看起来更简单，一目了然,同样，当依赖关系变得过于复杂，从阅读<br>代码到理解，图表跟文档相比较是更有用的。<br>[总结]<br>本章节puppet 如何绘画资源依赖关系图就到此结束，接下来下章会介绍如何调试puppet代码，<br>这对puppet 新手来说很重要，在写出漂亮的puppet代码的时候，还必须会调试它，本系列<br>都是按照puppet cookbook进行翻译的，错误在所难免，如有错误，欢迎指出谢谢！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.suzf.net/2015/05/26/puppet-drawing-module-into-a-dependency-graph/" data-id="ciqcd6lo60053clo9xmep8y0m" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Puppet/">Puppet</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-web-faq-tcp-time-wait-bucket-table-overflow" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/05/16/web-faq-tcp-time-wait-bucket-table-overflow/" class="article-date">
  <time datetime="2015-05-16T11:59:59.000Z" itemprop="datePublished">2015-05-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web/">Web</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/16/web-faq-tcp-time-wait-bucket-table-overflow/">Web_Faq:   TCP: time wait bucket table overflow</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> 前几日 查看自己的 VPS 主机 返现 有报错信息如下：<br> kernel: TCP: time wait bucket table overflow<br> kernel: TCP: time wait bucket table overflow<br> kernel: TCP: time wait bucket table overflow<br>（TCP:时间等待桶表）</p>
<p>根据报错提示，需要更改net.ipv4.tcp_max_tw_buckets这个内核参数。这个参数是系统同时保持timewait套接字的最大数量。如果超过这个数字，time-wait套接字将立刻被清除并打印警告信息。这个限制仅仅是为了防止简单的 DoS攻击，你绝对不能过分依靠它或者人为地减小这个值，如果网络实际需要大于缺省值，更应该增加这个值(如果增加了内存之后)。</p>
<p>解决方法：增大 tcp_max_tw_buckets的值，并不是这个值越小越好，我看了我系统中TIME_WAIT 大部是由php-fpm产生的，是属于正常的现象。<br>系统在同时所处理的最大timewait sockets 数目。如果超过此数的话﹐time-wait socket 会被立即砍除并且显示警告信息。之所以要设定这个限制﹐纯粹为了抵御那些简单的 DoS 攻击﹐千万不要人为的降低这个限制﹐不过﹐如果网络条件需要比默认值更多﹐则可以提高它(或许还要增加内存)。</p>
<p>netstat -an | grep 9000 | awk ‘{print $6}’ | sort | uniq -c | sort -rn<br>netstat -an | grep 80   | awk ‘{print $6}’ | sort | uniq -c | sort -rn</p>
<p>排查步骤：</p>
<p>1. 查看服务器网络连接情况；</p>
<h1 id="netstat_-pant__7Cawk__u2018/_5Etcp/__7B++state_5B_246_5D_7D_END__7Bfor_28key_in_state_29_printf_28_u201C_25-10s_5Ct_25d_5Cn_u201D_2Ckey_2Cstate_5Bkey_5D_29__7D_u2019"><a href="#netstat_-pant__7Cawk__u2018/_5Etcp/__7B++state_5B_246_5D_7D_END__7Bfor_28key_in_state_29_printf_28_u201C_25-10s_5Ct_25d_5Cn_u201D_2Ckey_2Cstate_5Bkey_5D_29__7D_u2019" class="headerlink" title="netstat -pant |awk ‘/^tcp/ {++state[$6]} END {for(key in state) printf(“%-10s\t%d\n”,key,state[key]) }’"></a>netstat -pant |awk ‘/^tcp/ {++state[$6]} END {for(key in state) printf(“%-10s\t%d\n”,key,state[key]) }’</h1><p>TIME_WAIT       6798<br>CLOSE_WAIT      1<br>ESTABLISHED     592<br>SYN_RECV        69<br>CLOSING         39<br>LAST_ACK        19<br>LISTEN          107</p>
<p>2.查看内核参数</p>
<p>#sysctl -a | grep net.ipv4.tcp_max_tw_buckets<br>net.ipv4.tcp_max_tw_buckets = 8192</p>
<p>改为：net.ipv4.tcp_max_tw_buckets = 10000</p>
<p>3.使更改的内核参数生效<br>sysctl -p</p>
<p>4. 再次查看服务器网络连接情况；</p>
<h1 id="netstat_-pant__7Cawk__u2018/_5Etcp/__7B++state_5B_246_5D_7D_END__7Bfor_28key_in_state_29_printf_28_u201C_25-10s_5Ct_25d_5Cn_u201D_2Ckey_2Cstate_5Bkey_5D_29__7D_u2019-1"><a href="#netstat_-pant__7Cawk__u2018/_5Etcp/__7B++state_5B_246_5D_7D_END__7Bfor_28key_in_state_29_printf_28_u201C_25-10s_5Ct_25d_5Cn_u201D_2Ckey_2Cstate_5Bkey_5D_29__7D_u2019-1" class="headerlink" title="netstat -pant |awk ‘/^tcp/ {++state[$6]} END {for(key in state) printf(“%-10s\t%d\n”,key,state[key]) }’"></a>netstat -pant |awk ‘/^tcp/ {++state[$6]} END {for(key in state) printf(“%-10s\t%d\n”,key,state[key]) }’</h1><p>TIME_WAIT       6644<br>…</p>
<p>5.再看/var/log/messages和dmesg的信息，已经不再报错了<br>  看来net.ipv4.tcp_max_tw_buckets=10000暂时是够用了</p>
<p>6.原因</p>
<p>  服务器的TCP连接数，超出了内核定义最大数。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.suzf.net/2015/05/16/web-faq-tcp-time-wait-bucket-table-overflow/" data-id="ciqcd6lku0029clo9kgj4xw16" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/faq/">faq</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/">web</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-warning-unsafe-statement-written-to-the-binary-log-using-statement-format-since-binlog-format-statement-insert-on-duplicate-key-update-on-a-table-with-more-than-one-unique-key-is-unsafe-state" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/05/16/warning-unsafe-statement-written-to-the-binary-log-using-statement-format-since-binlog-format-statement-insert-on-duplicate-key-update-on-a-table-with-more-than-one-unique-key-is-unsafe-state/" class="article-date">
  <time datetime="2015-05-16T09:15:13.000Z" itemprop="datePublished">2015-05-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Mysql/">Mysql</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/16/warning-unsafe-statement-written-to-the-binary-log-using-statement-format-since-binlog-format-statement-insert-on-duplicate-key-update-on-a-table-with-more-than-one-unique-key-is-unsafe-state/">[Warning] Unsafe statement written to the binary log using statement format since BINLOG_FORMAT = STATEMENT.</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>问题描述</p>
<pre><code>发现网站反应比较慢 ， 顺便查看了一下mysql的错误日志，发现产生了很多warning的日志：
150527 21:15:28 [Warning] Unsafe statement written to the binary log using statement format since           BINLOG_FORMAT =  STATEMENT. INSERT... ON DUPLICATE KEY UPDATE  on a table with more than one UNIQUE KEY is unsafe Statement: INSERT INTO &apos;xxx&apos;
</code></pre><p>问题原因</p>
<pre><code>查了下原因，xxx 这个表上有2个唯一键。则使用INSERT ... ON DUPLICATE KEY UPDATE ，且当前数据库binlog_format是statement格式，这种sql语句就会报unsafe。
</code></pre><p>查了下手册</p>
<pre><code>INSERT ... ON DUPLICATE KEY UPDATE statements on tables with multiple primary or unique keys.When executed against a table that contains more than one primary or unique key, this statement is considered unsafe, being sensitive to the order in which the storage engine checks the keys, which is not deterministic, and on which the choice of rows updated by the MySQL Server depends.

INSERT ... ON DUPLICATE KEY UPDATEstatement against a table having more than one unique or primary key is marked as unsafe for statement-based replication beginning with MySQL 5.6.6\. (Bug #11765650, Bug #58637)

link : http://dev.mysql.com/doc/refman/5.6/en/replication-rbr-safe-unsafe.html
binlog format : http://dev.mysql.com/doc/refman/5.6/en/replication-options-binary-log.html#sysvar_binlog_format

看官方解释，是server层把数据传给innodb引擎，innodb引擎检查key值比较敏感造成的。
</code></pre><p>问题解决<br>两种办法：<br>    1.修改binlog_format格式为mixed；<br>      登陆mysql，执行 set global binlog_format=MIXED; FLUSH LOGS; </p>
<pre><code>  注意：
       如果是 master-&gt;slave 结构的数据库架构。并且 slave上开启了 log_slave_updates。那么在master上修改完binlog格式，开启了log_slave_updates的从库，会同布中断。
       所以，需要先在 slave上，设置 binlog_format=mixed，之后再在master上设置。slave报错信息如下：
       Last_SQL_Errno: 1666
       Last_SQL_Error: Error executing row event: &apos;Cannot execute statement: impossible to write to binary log since statement is in row format and BINLOG_FORMAT = STATEMENT.&apos;

2.不要使用这类sql；
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.suzf.net/2015/05/16/warning-unsafe-statement-written-to-the-binary-log-using-statement-format-since-binlog-format-statement-insert-on-duplicate-key-update-on-a-table-with-more-than-one-unique-key-is-unsafe-state/" data-id="ciqcd6ll4002gclo9636hg5jo" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Mysql/">Mysql</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/faq/">faq</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-puppet-set-up-dashboard-success-version" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/18/puppet-set-up-dashboard-success-version/" class="article-date">
  <time datetime="2015-03-18T14:10:21.000Z" itemprop="datePublished">2015-03-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Puppet/">Puppet</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/18/puppet-set-up-dashboard-success-version/">Puppet set up dashboard success version</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Puppet Dasshboard是由支持Puppet开发的公司Puppetlabs创建的，是Ruby on Rails程序。可以作为一个ENC（外部节点分类器）以及一个报告工具，并且正在逐渐成为一个包含许多Puppet新功能的集成界面，例如审计和资源管 理功能。 Puppet Dashboard是一个Ruby on Rails程序，用于显示Puppet master和agent的相关信息。它允许你查看从一个或多个Puppet master汇总的图形和报告数据。它同时从一个或者多个Puppet master上收集来自于Puppet agent的资产数据（主机的Fact和其他信息）。最后，它能作为一个ENC来配置Puppet节点，并指定这些节点上的类和参数。 </p>
<p>参考文档：</p>
<p><a href="http://kisspuppet.com/2014/10/20/puppet_learning_ext8/" target="_blank" rel="external">http://kisspuppet.com/2014/10/20/puppet_learning_ext8/</a></p>
<p><a href="http://ruby-on-rails-book.kejyun.com/install/install-passenger.html" target="_blank" rel="external">http://ruby-on-rails-book.kejyun.com/install/install-passenger.html</a><br>1 前期准备工作</p>
<p>Puppet Dashboard（1.2.3）程序目前版本只能安装在Ruby 1.8.x（Dashboard还不能工作在1.9.x下或者更新的版本下），只支持MySQL作为数据库后端。</p>
<p>Rake version 0.8.3 or newerMySQL database server version 5.xRuby-MySQL bindings version 2.7.x or 2.8.x</p>
<p>备注：更多详细信息请参考：<a href="http://docs.puppetlabs.com/dashboard/" target="_blank" rel="external">http://docs.puppetlabs.com/dashboard/</a><br>2 安装相关软件包</p>
<h1 id="yum_install_ruby-mysql_mysql-server_puppet-dashboard"><a href="#yum_install_ruby-mysql_mysql-server_puppet-dashboard" class="headerlink" title="yum install  ruby-mysql mysql-server puppet-dashboard"></a>yum install  ruby-mysql mysql-server puppet-dashboard</h1><p>3 配置Dashboard（包括与数据库的结合部分）</p>
<p>3.1 创建管理Dashboard的MySQL数据库账号并授权</p>
<h1 id="/etc/rc-d/init-d/mysqld_restart"><a href="#/etc/rc-d/init-d/mysqld_restart" class="headerlink" title="/etc/rc.d/init.d/mysqld restart"></a>/etc/rc.d/init.d/mysqld restart</h1><h1 id="chkconfig_mysqld_on"><a href="#chkconfig_mysqld_on" class="headerlink" title="chkconfig mysqld on"></a>chkconfig mysqld on</h1><h1 id="mysqladmin_-uroot_password_xxx"><a href="#mysqladmin_-uroot_password_xxx" class="headerlink" title="mysqladmin -uroot password xxx"></a>mysqladmin -uroot password xxx</h1><p>#mysql uroot -p<br>mysql&gt; create database dashboard_production character set utf8;<br>mysql&gt; grant all on dashboard_production.* to ‘dashboard’@’localhost’ identified by “xxxx”;<br>mysql&gt; flush privileges;    </p>
<p>#测试账号是否创建成功<br>mysql -udashboard -p -e “show processlist”;</p>
<p>3.2 优化数据库配置文件my.cnf</p>
<h1 id="vim_/etc/my-cnf"><a href="#vim_/etc/my-cnf" class="headerlink" title="vim /etc/my.cnf"></a>vim /etc/my.cnf</h1><p>[mysqld]</p>
<h1 id="Allowing_32MB_allows_an_occasional_17MB_row_with_plenty_of_spare_roommax_allowed_packet__3D_32M"><a href="#Allowing_32MB_allows_an_occasional_17MB_row_with_plenty_of_spare_roommax_allowed_packet__3D_32M" class="headerlink" title="Allowing 32MB allows an occasional 17MB row with plenty of spare roommax_allowed_packet = 32M"></a>Allowing 32MB allows an occasional 17MB row with plenty of spare roommax_allowed_packet = 32M</h1><h1 id="/etc/rc-d/init-d/mysqld_restart__23_u91CD_u542FMySQL_u751F_u6548"><a href="#/etc/rc-d/init-d/mysqld_restart__23_u91CD_u542FMySQL_u751F_u6548" class="headerlink" title="/etc/rc.d/init.d/mysqld restart #重启MySQL生效"></a>/etc/rc.d/init.d/mysqld restart #重启MySQL生效</h1><p>3.3 编辑dashboard YAML配置文件（database.yml）来指定数据库</p>
<h1 id="vim_/usr/share/puppet-dashboard/config/database-yml"><a href="#vim_/usr/share/puppet-dashboard/config/database-yml" class="headerlink" title="vim /usr/share/puppet-dashboard/config/database.yml"></a>vim /usr/share/puppet-dashboard/config/database.yml</h1><p>production:<br>database: dashboard_production<br>username: dashboard<br>password: xxx</p>
<p>encoding: utf8  adapter: mysql</p>
<p>…</p>
<p>3.4 填充数据库</p>
<h1 id="cd_/usr/share/puppet-dashboard/"><a href="#cd_/usr/share/puppet-dashboard/" class="headerlink" title="cd /usr/share/puppet-dashboard/"></a>cd /usr/share/puppet-dashboard/</h1><h1 id="rake_gems_3Arefresh_specs"><a href="#rake_gems_3Arefresh_specs" class="headerlink" title="rake gems:refresh_specs"></a>rake gems:refresh_specs</h1><h1 id="rake_RAILS_ENV_3Dproduction_db_3Amigrate"><a href="#rake_RAILS_ENV_3Dproduction_db_3Amigrate" class="headerlink" title="rake RAILS_ENV=production db:migrate"></a>rake RAILS_ENV=production db:migrate</h1><p>#环境变量RAILS_ENV=production告诉Ruby on Rails我们工作在生产环境。每次你运行一个rake命令都需要使用合适的环境值来设置RAILS_ENV环境变量</p>
<p>3.5 查看是否导入成功<br><img src="http://s3.51cto.com/wyfs02/M01/5B/7B/wKiom1UJha6AhvkbAAIkioLDfzw868.jpg" alt=""></p>
<p>4 启动并运行Dashboard（WEBrick方式）</p>
<p>WEBrick有助于快速使用Dashboard，不过它不能很好地进行扩展，并且当有许多Puppet agent向Dashboard进行报告时，它的性能会非常差，因此不推荐使用。</p>
<p>4.1 关闭httpd服务</p>
<h1 id="/etc/rc-d/init-d/httpd_stop__23_u4E4B_u524D_u914D_u7F6E_u8FC7_u4F7F_u7528httpd_u8FD0_u884Cpuppetmaster_uFF0C_u9700_u8981_u5173_u95ED"><a href="#/etc/rc-d/init-d/httpd_stop__23_u4E4B_u524D_u914D_u7F6E_u8FC7_u4F7F_u7528httpd_u8FD0_u884Cpuppetmaster_uFF0C_u9700_u8981_u5173_u95ED" class="headerlink" title="/etc/rc.d/init.d/httpd stop #之前配置过使用httpd运行puppetmaster，需要关闭"></a>/etc/rc.d/init.d/httpd stop #之前配置过使用httpd运行puppetmaster，需要关闭</h1><p>4.2 启动puppetmaster服务</p>
<h1 id="/etc/rc-d/init-d/puppetmaster_start"><a href="#/etc/rc-d/init-d/puppetmaster_start" class="headerlink" title="/etc/rc.d/init.d/puppetmaster start"></a>/etc/rc.d/init.d/puppetmaster start</h1><p>4.3 启动puppet-dashboard服务</p>
<h1 id="/etc/rc-d/init-d/puppet-dashboard_start__23_u542F_u52A8dashboard_Starting_Puppet_Dashboard_3A__3D_26gt_3B_Booting_WEBrick_3D_26gt_3B_Rails_2-3-17_application_starting_on_http_3A//0-0-0-0_3A3000__5B_OK__5D"><a href="#/etc/rc-d/init-d/puppet-dashboard_start__23_u542F_u52A8dashboard_Starting_Puppet_Dashboard_3A__3D_26gt_3B_Booting_WEBrick_3D_26gt_3B_Rails_2-3-17_application_starting_on_http_3A//0-0-0-0_3A3000__5B_OK__5D" class="headerlink" title="/etc/rc.d/init.d/puppet-dashboard start #启动dashboard    Starting Puppet Dashboard: =&gt; Booting WEBrick=&gt; Rails 2.3.17 application starting on http://0.0.0.0:3000                                                           [  OK  ]"></a>/etc/rc.d/init.d/puppet-dashboard start #启动dashboard    Starting Puppet Dashboard: =&gt; Booting WEBrick=&gt; Rails 2.3.17 application starting on <a href="http://0.0.0.0:3000" target="_blank" rel="external">http://0.0.0.0:3000</a>                                                           [  OK  ]</h1><p>4.4 通过浏览器访问<a href="http://172.16.7.81:3000" target="_blank" rel="external">http://172.16.7.81:3000</a><br><img src="http://s3.51cto.com/wyfs02/M02/5B/75/wKioL1UJhumx16eeAAI-AxYGV4k423.jpg" alt=""></p>
<p>5 启动并运行Dashboard（Passenger方式）</p>
<p>5.1 使用Ruby Gem安装Passenger</p>
<h1 id="yum_install_ruby-devel_ruby-libs_rubygems_libcurl-devel_23_yum_install_httpd_httpd-devel_apr-util-devel_apr-devel_mod_ssl"><a href="#yum_install_ruby-devel_ruby-libs_rubygems_libcurl-devel_23_yum_install_httpd_httpd-devel_apr-util-devel_apr-devel_mod_ssl" class="headerlink" title="yum install ruby-devel ruby-libs rubygems libcurl-devel# yum install httpd httpd-devel apr-util-devel apr-devel mod_ssl"></a>yum install ruby-devel ruby-libs rubygems libcurl-devel# yum install httpd httpd-devel apr-util-devel apr-devel mod_ssl</h1><h1 id="gem_install_passenger"><a href="#gem_install_passenger" class="headerlink" title="gem install passenger"></a>gem install passenger</h1><h1 id="passenger-install-apache2-module"><a href="#passenger-install-apache2-module" class="headerlink" title="passenger-install-apache2-module"></a>passenger-install-apache2-module</h1><p>注：安装过程会检查所需要的依赖包，若果发生错误，请按照passenger的提示安装<br><img src="http://s3.51cto.com/wyfs02/M00/5B/75/wKioL1UJhzPCNmhKAAXu2vpBYQ8318.jpg" alt=""></p>
<p>我这里缺少OpenSSL包，所以需要再重新安裝</p>
<h1 id="yum_install_openssl-devel_-y"><a href="#yum_install_openssl-devel_-y" class="headerlink" title="yum install openssl-devel -y"></a>yum install openssl-devel -y</h1><p>重新安装后再次执行passenger-install-apache2-module 安裝 Apache Passenger 套件即可，安装的过程需要编译apache 套件，所以需要一些时间</p>
<p>5.2 配置虚拟主机和passenger</p>
<h1 id="vim_/etc/httpd/conf-d/passenger-conf"><a href="#vim_/etc/httpd/conf-d/passenger-conf" class="headerlink" title="vim /etc/httpd/conf.d/passenger.conf"></a>vim /etc/httpd/conf.d/passenger.conf</h1><p>LoadModule passenger_module /usr/lib/ruby/gems/1.8/gems/passenger-4.0.19/buildout/apache2/mod_passenger.so</p>
<p><ifmodule mod_passenger.c=""><br>PassengerRoot /usr/lib/ruby/gems/1.8/gems/passenger-4.0.19<br>PassengerRuby /usr/bin/ruby   PassengerHighPerformance on<br>PassengerMaxPoolSize 12<br>PassengerPoolIdleTime 1500<br>PassengerStatThrottleRate 120 </ifmodule></p>
<h1 id="RailsAutoDetect_On"><a href="#RailsAutoDetect_On" class="headerlink" title="RailsAutoDetect On"></a>RailsAutoDetect On</h1><p><br>Listen 8141</p>
<virtualhost *:8141=""><br>DocumentRoot “/usr/share/puppet-dashboard/public/“<br><directory "="" usr="" share="" puppet-dashboard="" public=""><br>Options None             AllowOverride AuthConfig<br>Order allow,deny<br>allow from all<br></directory><br>ErrorLog /var/log/httpd/dashboard.error.log<br>LogLevel warn<br>CustomLog /var/log/httpd/dashboard.access.log combined<br></virtualhost>

<p>5.3 启动相关服务</p>
<h1 id="/etc/rc-d/init-d/puppetmaster_stop__23_u505C_u6389puppetmaster_u670D_u52A1Stopping_puppetmaster_3A__5B_OK__5D_23_/etc/rc-d/init-d/httpd_restart"><a href="#/etc/rc-d/init-d/puppetmaster_stop__23_u505C_u6389puppetmaster_u670D_u52A1Stopping_puppetmaster_3A__5B_OK__5D_23_/etc/rc-d/init-d/httpd_restart" class="headerlink" title="/etc/rc.d/init.d/puppetmaster stop  #停掉puppetmaster服务Stopping puppetmaster:                                     [  OK  ]# /etc/rc.d/init.d/httpd restart"></a>/etc/rc.d/init.d/puppetmaster stop  #停掉puppetmaster服务Stopping puppetmaster:                                     [  OK  ]# /etc/rc.d/init.d/httpd restart</h1><p>5.4 通过浏览器访问测试</p>
<p><a href="http://172.16.7.81:8141/" target="_blank" rel="external">http://172.16.7.81:8141/</a><br><img src="http://s3.51cto.com/wyfs02/M00/5B/7B/wKiom1UJhkyBw3iOAAJCa4-XQVs004.jpg" alt=""></p>
<p>6 集成Puppet Dashboard</p>
<p>6.1 手工导入现有的报告（方式一）</p>
<h1 id="cd_/usr/share/puppet-dashboard/_23_rake_RAILS_ENV_3Dproduction_reports_3Aimport__23_u5BFC_u5165_u5DF2_u7ECF_u5B58_u5728_u7684_u62A5_u544A"><a href="#cd_/usr/share/puppet-dashboard/_23_rake_RAILS_ENV_3Dproduction_reports_3Aimport__23_u5BFC_u5165_u5DF2_u7ECF_u5B58_u5728_u7684_u62A5_u544A" class="headerlink" title="cd /usr/share/puppet-dashboard/# rake RAILS_ENV=production reports:import  #导入已经存在的报告"></a>cd /usr/share/puppet-dashboard/# rake RAILS_ENV=production reports:import  #导入已经存在的报告</h1><p><img src="http://s3.51cto.com/wyfs02/M01/5B/75/wKioL1UJh5HQQkhLAAI0MtWwlP0990.jpg" alt=""></p>
<p>备注：默认节点报告会在/var/lib/puppet/reports/ 产生，如果路径发生变化，导入报告时需要在后面加上“REPORT_DIR=report路径”，reports更改路径可在puppet.conf中设置参数“reportdir = 新路径”，这种方式不够实时。<br><img src="http://s3.51cto.com/wyfs02/M02/5B/75/wKioL1UJh6bhiZWlAAGHXd9bNvA888.jpg" alt=""></p>
<p>6.2 配置实施汇总puppet报告（方式二）</p>
<h1 id="u914D_u7F6Eagent_u8282_u70B9_u81EA_u52A8_u53D1_u9001_u62A5_u544A"><a href="#u914D_u7F6Eagent_u8282_u70B9_u81EA_u52A8_u53D1_u9001_u62A5_u544A" class="headerlink" title="配置agent节点自动发送报告"></a>配置agent节点自动发送报告</h1><p>[root@agent1 ~]# vim /etc/puppet/puppet.conf    [agent]report = true                  #从2.7.0版本开始，报告系统会默认开启，不需要配置…</p>
<h1 id="u914D_u7F6Emaster__u62A5_u544A_u6C47_u603B_5Broot@master_puppet-dashboard_5D_23_vim_/etc/puppet/puppet-conf_5Bmain_5D_reports__3D_http"><a href="#u914D_u7F6Emaster__u62A5_u544A_u6C47_u603B_5Broot@master_puppet-dashboard_5D_23_vim_/etc/puppet/puppet-conf_5Bmain_5D_reports__3D_http" class="headerlink" title="配置master  报告汇总[root@master puppet-dashboard]# vim /etc/puppet/puppet.conf[main]    reports = http"></a>配置master  报告汇总[root@master puppet-dashboard]# vim /etc/puppet/puppet.conf[main]    reports = http</h1><pre><code>reporturl = http://172.16.7.81:8141/reports 
</code></pre><p>#定义为http报告处理器，除此之外还有store，log，tagmail，rrdgraph等报告处理器</p>
<p>#http报告处理器将puppet报告发送到一个HTTP URL和端口（Dashboard位置）。Puppet报告以被转储为HTTP Poort形式的YAML格式进行发送。 [root@master ~]# /etc/rc.d/init.d/httpd restart</p>
<p>6.3 开启后台处理报告进程</p>
<p>#运行“Delayed Job Workers”，使其在后台为我们处理报告日志</p>
<p>[root@master puppet-dashboard]# rake RAILS_ENV=production jobs:work &amp;[1] 20577</p>
<p>6.4 修改dashboard时区【master】</p>
<p>Dashboard默认时区为UTC格式，我们这里需要更改为CST（Asia/Shanghai）格式</p>
<h1 id="vim_/usr/share/puppet-dashboard/config/settings-yml"><a href="#vim_/usr/share/puppet-dashboard/config/settings-yml" class="headerlink" title="vim /usr/share/puppet-dashboard/config/settings.yml"></a>vim /usr/share/puppet-dashboard/config/settings.yml</h1><p>time_zone: ‘Asia/Shanghai’…<strong>备注</strong>：设置的settings.yml会覆盖掉config/environment.rb中对应的配置项（config.time_zone = ‘UTC’）</p>
<p>#/etc/init.d/httpd restart</p>
<p>6.5 显示报告</p>
<p>通过<a href="http://172.16.7.81:8141及时查看节点更新的报告信息，可以看到两个节点，默认显示时间为CST格式，除此之外还可以看到某一个节点在某一个时刻的更新报告和运行曲线图。" target="_blank" rel="external">http://172.16.7.81:8141及时查看节点更新的报告信息，可以看到两个节点，默认显示时间为CST格式，除此之外还可以看到某一个节点在某一个时刻的更新报告和运行曲线图。</a><br><img src="http://s3.51cto.com/wyfs02/M02/5B/7B/wKiom1UJhp_z5LLhAAFRPwQGzhc644.jpg" alt=""></p>
<p>6.6 删除报告</p>
<p>删除一个前的报告</p>
<p>[root@master puppet-dashboard]# rake RAILS_ENV=production reports:prune upto=1 unit=mon</p>
<p>删除一天前的报告</p>
<p>[root@master puppet-dashboard]# rake RAILS_ENV=production reports:prune upto=1 unit=day</p>
<p>删除效果如下：<br><img src="http://s3.51cto.com/wyfs02/M00/5B/75/wKioL1UJh__SnDeVAAEpgLydCtA405.jpg" alt=""></p>
<p>7 自定义报告</p>
<p>7.1 编写外部报告处理器</p>
<p>使用现有的被存储的报告，就是那些yaml文件，可以通过设置puppet.conf中reports = store进 行收集。然后编写一个外部的处理器来处理这些信息，例如绘图或者将他们存储在外部数据库。这也是Puppet Dashboard中的报告输入进程的工作原理。这些外部的报告处理器可以很简单地使用Ruby进行编写，以便使用Ruby反序列化YAML文件的能力以 及使用生成的对象。你可以使用任何支持导入第三方ymal数据的工具。</p>
<p>7.2 编写内部报告处理器</p>
<p>编写自定义报告处理器并将它添加到Puppet。和fact、函数、类型及提供者的插件不同，Puppet没有提供一个自动分发自定义报告的方法。</p>
<p>7.2.1 现有报告处理器信息</p>
<p><img src="http://s3.51cto.com/wyfs02/M00/5B/7B/wKiom1UJhubw_m8SAAO1-njCTZk791.jpg" alt=""></p>
<p>7.2.2 自定义摘要报告处理器</p>
<p>7.2.2.1 进入reports目录编写自定义summary.rb报告处理器</p>
<h1 id="cd_/usr/lib/ruby/site_ruby/1-8/puppet/reports"><a href="#cd_/usr/lib/ruby/site_ruby/1-8/puppet/reports" class="headerlink" title="cd /usr/lib/ruby/site_ruby/1.8/puppet/reports"></a>cd /usr/lib/ruby/site_ruby/1.8/puppet/reports</h1><h1 id="vim_summary-rbrequire"><a href="#vim_summary-rbrequire" class="headerlink" title="vim summary.rbrequire"></a>vim summary.rbrequire</h1><p>‘puppet’Puppet::Reports.register_report(:summary)<br>do  desc &lt; &lt;-DESC  Send summary report information to the report directory.<br>DESC  def process<br>client = self.host<br>summary = self.summary<br>dir = File.join(Puppet[:reportdir],client)<br>client = self.host<br>file = “summary.txt”<br>destination = File.join(dir,file)<br>File.open(destination,”w”)<br>do |f|        f.write(summary)<br>end<br>endend</p>
<p>7.2.2.2 将报告处理器的名字加入puppet.conf中，并重新启动httpd服务</p>
<h1 id="vim_/etc/puppet/puppet-conf"><a href="#vim_/etc/puppet/puppet-conf" class="headerlink" title="vim /etc/puppet/puppet.conf"></a>vim /etc/puppet/puppet.conf</h1><p>[main]reports = http,summary…</p>
<h1 id="/etc/rc-d/init-d/httpd_restart"><a href="#/etc/rc-d/init-d/httpd_restart" class="headerlink" title="/etc/rc.d/init.d/httpd restart"></a>/etc/rc.d/init.d/httpd restart</h1><p>7.2.2.3 使用mco命令触发更新节点agent1</p>
<p>[ mco 未完待续 ]<br>下面的这些涉及到 MCollective 事先配置好</p>
<p> mco puppet -v runonce  mco facts -v –with-fact  hostname=’agent1’Discovering hosts using the mc method for 2 second(s) …. 1 * [ ============================================================&gt; ] 1 / 1agent1.kisspuppet.com                      : OK    {:summary=&gt;      “Started a background Puppet run using the ‘puppet agent –onetime –daemonize –color=false –splay –splaylimit 30’ command”}—- rpc stats —-           Nodes: 1 / 1     Pass / Fail: 1 / 0      Start Time: Fri Oct 04 12:54:50 +0800 2013  Discovery Time: 2005.27ms      Agent Time: 1118.41ms      Total Time: 3123.68ms</p>
<p>7.2.2.4 查看新生成的报告信息</p>
<h1 id="cd_/var/lib/puppet/reports/agent1-jeffery-com/_23_cat_summary-txt_Changes_3A_Total_3A_1Events_3A_Total_3A_1_Success_3A_1Resources_3A_Out_of_sync_3A_1_Changed_3A_1_Total_3A_15_Skipped_3A_6Time_3A_Filebucket_3A_0-00_Package_3A_0-00_File_3A_0-11_Service_3A_0-12_Config_retrieval_3A_1-29_Total_3A_1-52_Last_run_3A_1380861882Version_3A_Config_3A_1380861878_Puppet_3A_2-7-23"><a href="#cd_/var/lib/puppet/reports/agent1-jeffery-com/_23_cat_summary-txt_Changes_3A_Total_3A_1Events_3A_Total_3A_1_Success_3A_1Resources_3A_Out_of_sync_3A_1_Changed_3A_1_Total_3A_15_Skipped_3A_6Time_3A_Filebucket_3A_0-00_Package_3A_0-00_File_3A_0-11_Service_3A_0-12_Config_retrieval_3A_1-29_Total_3A_1-52_Last_run_3A_1380861882Version_3A_Config_3A_1380861878_Puppet_3A_2-7-23" class="headerlink" title="cd /var/lib/puppet/reports/agent1.jeffery.com/# cat summary.txt Changes:            Total: 1Events:            Total: 1          Success: 1Resources:      Out of sync: 1          Changed: 1            Total: 15          Skipped: 6Time:       Filebucket: 0.00          Package: 0.00             File: 0.11          Service: 0.12   Config retrieval: 1.29            Total: 1.52         Last run: 1380861882Version:           Config: 1380861878           Puppet: 2.7.23"></a>cd /var/lib/puppet/reports/agent1.jeffery.com/# cat summary.txt Changes:            Total: 1Events:            Total: 1          Success: 1Resources:      Out of sync: 1          Changed: 1            Total: 15          Skipped: 6Time:       Filebucket: 0.00          Package: 0.00             File: 0.11          Service: 0.12   Config retrieval: 1.29            Total: 1.52         Last run: 1380861882Version:           Config: 1380861878           Puppet: 2.7.23</h1><p>在整个报告处理器中，我们定义了一个叫做process的方法来承载处理器的核心逻辑。我们从报告中提取了一些信息：使用self.host方式提取了主机名，使用summary方式提取了变更的摘要。还可以使用self.logs和self.metrics方式来访问报告中的日子以及度量值。 我们同时还将报告的摘要输出了报告目录下对应的以Puppet agent主机名命名的目录中，报告目录的位置是由reportdir配置的值来指定的，默认在/var/lib/puppet/reports/目录下。</p>
<p>备注：更多报告处理器信息请访问</p>
<p>现有报告处理器<a href="https://github.com/puppetlabs/puppet/tree/master/lib/puppet/reports报告参考" target="_blank" rel="external">https://github.com/puppetlabs/puppet/tree/master/lib/puppet/reports报告参考</a> <a href="http://docs.puppetlabs.com/references/latest/report.html#http" target="_blank" rel="external">http://docs.puppetlabs.com/references/latest/report.html#http</a> 报告及报告系统 <a href="http://docs.puppetlabs.com/guides/reporting.html" target="_blank" rel="external">http://docs.puppetlabs.com/guides/reporting.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.suzf.net/2015/03/18/puppet-set-up-dashboard-success-version/" data-id="ciqcd6lnw004rclo9s1ltgi1c" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Puppet/">Puppet</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-puppet-facter" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/12/25/puppet-facter/" class="article-date">
  <time datetime="2014-12-25T14:06:21.000Z" itemprop="datePublished">2014-12-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Puppet/">Puppet</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/12/25/puppet-facter/">Puppet 自定义facter 简述</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在使用puppet作为配置管理工具的同时，facter是一个非常有用的系统盘点工具，自定义fact可以让节点增加更多的标签。这个工具可以通过一些预先设定好变量定位一台主机，比如可 以通过变量lsbdistrelease便可以知道当前系统的版本号，通过osfamily便可以知道系统是RedHat还是SLES，还是其它等等。但 是这些预先设定好的变量毕竟有限，在整个自动化运维过程中，由于系统应用的多样性，更多需要通过应用的名称、角色的名称进行标示，这样就需要自定义一些 fact并赋值到每个节点上去，相当于给节点打上标签。<br>一、自定义(custom)fact的四种方法</p>
<p>1、定义到facter软件本身的lib库中</p>
<p>这种方法是直接在安装facter的lib库里面直接创建，相当于扩充facter软件的lib库。<br>可以通过以下方法找到facter包的lib库路径为/usr/lib/ruby/site_ruby/1.8/facter<br>[root@agent1 facter]# rpm -ql facter<br>/usr/bin/facter<br>/usr/lib/ruby/site_ruby/1.8/facter<br>/usr/lib/ruby/site_ruby/1.8/facter.rb<br>/usr/lib/ruby/site_ruby/1.8/facter/Cfkey.rb<br>/usr/lib/ruby/site_ruby/1.8/facter/application.rb<br>/usr/lib/ruby/site_ruby/1.8/facter/architecture.rb<br>/usr/lib/ruby/site_ruby/1.8/facter/augeasversion.rb<br>/usr/lib/ruby/site_ruby/1.8/facter/blockdevices.rb<br>/usr/lib/ruby/site_ruby/1.8/facter/domain.rb<br>/usr/lib/ruby/site_ruby/1.8/facter/ec2.rb<br>/usr/lib/ruby/site_ruby/1.8/facter/facterversion.rb<br>/usr/lib/ruby/site_ruby/1.8/facter/filesystems.rb<br>/usr/lib/ruby/site_ruby/1.8/facter/fqdn.rb<br>/usr/lib/ruby/site_ruby/1.8/facter/hardwareisa.rb<br>/usr/lib/ruby/site_ruby/1.8/facter/hardwaremodel.rb<br>1.1、在facter的lib库中创建fact，名称为rpms，可以显示当前安装了多少rpm包<br>[root@agent1 ~]# cd /usr/lib/ruby/site_ruby/1.8/facter/<br>[root@agent1 facter]# vim rpms.rb<br>Facter.add(:rpms) do<br>  setcode do<br>    %x{/bin/rpm -qa | wc -l}.chomp  #定义一个shell命令<br>  end<br>end<br>1.2、通过facter命令进行测试<br>[root@agent1 facter]# facter | grep rpms<br>rpms =&gt; 918<br>[root@agent1 facter]# facter  rpms<br>918<br>备注：这种方法相当于给facter软件打补丁，过多的使用可能会破坏facter本身软件的完整性，不建议使用。<br>2、使用环境变量‘FACTERLIB’创建fact</p>
<p>这种方法也非常简单，在一个目录下定义一个fact，然后export即可，方法如下<br>2.1、在自定义目录里面定义一个fact，列出当前系统登录的用户数<br>[root@agent1 ~]# vim /var/lib/puppet/kiss_fact/users.rb<br>Facter.add(:users) do<br>  setcode do<br>    %x{/usr/bin/who |wc -l}.chomp<br>  end<br>end<br>[root@agent1 kiss_fact]# facter users #无显示结果，需要设置FACTERLIB<br>[root@agent1 kiss_fact]#<br>2.2、将自定义fact路径赋值给变量FACTERLIB<br>[root@agent1 kiss_fact]# export FACTERLIB=/var/lib/puppet/kiss_fact<br>[root@agent1 kiss_fact]# facter users<br>2<br>[root@agent1 kiss_fact]# facter | grep users<br>users =&gt; 2<br>备注：这种方法是对第一种方法的扩展，可以自己定义目录，不过需要将路径加到变量FACTERLIB中，可以在/etc/profile添加，这样系统启动的时候便可以自动加载。<br>3、添加外部的(external)fact</p>
<p>这种方式支持txt、yaml、json、sh四种格式，内容也比较固定，默认情况下需要在目录/etc/facter/facts.d/下创建，使用也非常方便。 关于这个路径其实是可以修改的，不过修改起来并不是很方便，需要修改facter软件代码。<br>[root@agent1 ~]# vim /usr/lib/ruby/site_ruby/1.8/facter/util/config.rb<br>    def self.external_facts_dirs                                     #这些内容默认是有的<br>      if Facter::Util::Root.root?<br>        windows_dir = windows_data_dir<br>        if windows_dir.nil? then<br>          [“/etc/facter/facts.d”, “/etc/puppetlabs/facter/facts.d”]  #external路径位置<br>        else<br>          [File.join(windows_dir, ‘PuppetLabs’, ‘facter’, ‘facts.d’)]<br>        end<br>      else<br>        [File.expand_path(File.join(“~”, “.facter”, “facts.d”))]<br>      end<br>    end<br>特殊说明：只能用于1.7.3版本以上</p>
<p>3.1、通过txt文件创建<br>3.1.1、创建roles.txt文件<br>文件内容格式必须为“key=value”<br>[root@agent1 ~]# mkdir /etc/facter/facts.d -p<br>[root@agent1 facts.d]# vim roles.txt<br>web=http<br>db=mysql<br>3.1.2、测试<br>[root@agent1 facts.d]# facter web1<br>http1<br>[root@agent1 facts.d]# facter db1<br>mysql1<br>[root@agent1 facts.d]# facter | egrep ‘web1|db1’<br>db1 =&gt; mysql1<br>web1 =&gt; http1<br>3.2、通过yaml文件创建<br>3.2.1、创建yaml文件</p>
<h2 id="5Broot@agent1_facts-d_5D_23_vim_roles-yaml"><a href="#5Broot@agent1_facts-d_5D_23_vim_roles-yaml" class="headerlink" title="[root@agent1 facts.d]# vim roles.yaml"></a>[root@agent1 facts.d]# vim roles.yaml </h2><p>web2:</p>
<ul>
<li>http2<br>db2:</li>
<li>mysql2</li>
<li>3.2.2、测试<br>[root@agent1 facts.d]# facter | egrep ‘web2|db2’<br>db2 =&gt; mysql2<br>web2 =&gt; http2<br>3.3、通过json文件创建<br>3.3.1、创建json文件<br>[root@agent1 facts.d]# vim roles.json<br>{<br>“web3”: “http3”,<br>“db3”: “mysql3”<br>}<br>备注：提供一个在线编辑json的网站<a href="http://www.bejson.com/go.html?u=http://www.bejson.com/jsonview2/" target="_blank" rel="external">http://www.bejson.com/go.html?u=http://www.bejson.com/jsonview2/</a><br>3.3.2、安装rubygem-json包（json文件需要它的支持）<br>[root@agent1 facts.d]# facter | egrep ‘web3|db3’<br>Cannot parse JSON data file /etc/facter/facts.d/roles.json without the json library.<br>Suggested next step is <code>gem install json</code> to install the json library. #缺少json包<br>[root@agent1 facts.d]# rpm -ivh rubygem-json-1.5.5-2.el5.x86_64.rpm #安装rubygem-json包，找不到安装包的同志可在群共享里面查找，群号码在文章最后面。<br>3.3.3、测试<br>[root@agent1 facts.d]# facter | egrep ‘web3|db3’<br>db3 =&gt; mysql3<br>web3 =&gt; http3<br>3.4、通过sh脚本创建<br>3.4.1、创建shell脚本<br>[root@agent1 facts.d]# vim roles.sh<br>#!/bin/bash<br>echo “web4=http4”<br>echo “db4=mysql4”<br>3.4.2、设置文件具有可执行权限<br>[root@agent1 facts.d]# chmod a+x roles.sh<br>3.4.3、测试<br>[root@agent1 facts.d]# facter web4 db4<br>db4 =&gt; mysql4<br>web4 =&gt; http4<br>思考：那么如何做到所有节点批量部署呢，可以看到以上四种方式都是基于文件编辑的，可在puppetmaster端通过file资源实现部署。</li>
</ul>
<p>4、使用pluginsync进行发布</p>
<p>这种方法比较特殊，节点factpath目录里除了编写好的rb文件之外，还需要在puppet模块中引用，运行一次之后才会转换成fact。通常 在puppetmaster端模块里的lib库中添加，然后在puppet.conf中添加选项pluginsync=true即可，格式为ruby文 件。<br>4.1、创建模块facts<br>[root@puppetmaster ~]# cd /etc/puppet/environments/kissprd/environment/modules/<br>[root@puppetmaster modules]# tree facts/  #目录结构<br>facts/<br>└── lib<br>    └── facter<br>        └── hwclock.rb<br>2 directories, 1 file<br>备注：也可以放在其他已经编写好的模块中<br>[root@puppetmaster facter]# vim hwclock.rb  #自定义fact：hwclock，显示节点硬件时间<br>Facter.add(:hwclock) do<br>  setcode do<br>    %x{/usr/sbin/hwclock}.chomp<br>  end<br>end<br>4.2、应用自定义fact至motd模块中<br>[root@puppetmaster kissprd]# vim application/modules/motd/manifests/init.pp<br>class motd{<br>  package{ ‘setup’:<br>    ensure =&gt; present,<br>  }<br>  file{ ‘/etc/motd’:<br>    ensure  =&gt; present,<br>    owner   =&gt; ‘root’,<br>    group   =&gt; ‘root’,<br>    mode    =&gt; ‘0644’,<br>    source  =&gt; “puppet://$puppetserver/modules/motd/etc/motd”,<br>    require =&gt; Package[‘setup’],<br>  }<br>  notify { “ Hardware-Clock: ${::hwclock}”: } #添加一个通知，这里只是测试，没有实际意义<br>}<br>4.3、在puppetmaster端的puppet.conf中添加选项pluginsync<br>[root@puppetmaster kissprd]# vim /etc/puppet/puppet.conf<br>[main]<br>    logdir = /var/log/puppet<br>    rundir = /var/run/puppet<br>    ssldir = $vardir/ssl<br>    pluginsync = true    #添加插件选项<br>…<br>4.4、在所有节点puppet.conf中添加pluginsync（通过在puppet模块中添加实现）<br>[root@puppetmaster kissprd]# vim environment/modules/puppet/templates/puppet.conf.erb </p>
<h3 id="config_by_puppet"><a href="#config_by_puppet" class="headerlink" title="config by  puppet"></a>config by  puppet</h3><p>[main]<br>    logdir = /var/log/puppet<br>    rundir = /var/run/puppet<br>    ssldir = $vardir/ssl<br>    pluginsync = true  #添加插件选项<br>[agent]<br>    classfile = $vardir/classes.txt<br>    localconfig = $vardir/localconfig<br>    server = &lt; %= scope.lookupvar(‘puppet::params::puppetserver’) %&gt;<br>    certname = &lt; %= scope.lookupvar(‘puppet::params::certname’) %&gt;<br>4.5、节点运行puppet agent进行测试<br>[root@agent1 ~]# facter -p hwclock  #没有这个fact，自定义fact需要加上-p参数才能显示<br>[root@agent1 ~]# puppet agent -t –environment=kissprd  #运行一次<br>info: Retrieving plugin<br>notice: /File[/var/lib/puppet/lib/facter/historys.rb]/ensure: removed<br>notice: /File[/var/lib/puppet/lib/facter/hwclock.rb]/ensure: defined content as ‘{md5}d8cc9fe2b349a06f087692763c878e28’<br>info: Loading downloaded plugin /var/lib/puppet/lib/facter/hwclock.rb  #下载插件至节点factpath指定的目录<br>info: Loading facts in /var/lib/puppet/lib/facter/hwclock.rb<br>info: Caching catalog for agent1_cert.kisspuppet.com<br>info: Applying configuration version ‘1396170375’<br>notice:  Hardware-Clock: Sun 30 Mar 2014 05:06:16 PM CST  -0.055086 seconds<br>notice: /Stage[main]/Motd/Notify[ Hardware-Clock: Sun 30 Mar 2014 05:06:16 PM CST  -0.055086 seconds]/message: defined ‘message’ as ‘ Hardware-Clock: Sun 30 Mar 2014 05:06:16 PM CST  -0.055086 seconds’ #应用<br>notice: Finished catalog run in 0.51 seconds<br>[root@agent1 ~]# facter -p  hwclock #自定义的hwclock生效<br>hwclock =&gt; Sun 30 Mar 2014 05:06:25 PM CST  -0.567090 seconds</p>
<p>[root@agent1 ~]# ll /var/lib/puppet/lib/facter/  #插件已经下载到本地<br>total 4<br>-rw-r–r– 1 root root 79 Mar 30 17:06 hwclock.rb<br>关于factpath默认路径可通过以下命令查看，当然也可以在puppet.conf中进行修改<br>[root@agent1 ~]# puppet –genconfig | grep factpath<br>    factpath = /var/lib/puppet/lib/facter:/var/lib/puppet/facts<br>资料参考：</p>
<p>官网 <a href="http://docs.puppetlabs.com/guides/custom_facts.html" target="_blank" rel="external">http://docs.puppetlabs.com/guides/custom_facts.html</a><br>书籍《pro puppet 2》Chapter10:Extending Facter and Puppet 下载地址：<a href="http://kisspuppet.com/2014/03/29/propuppet2/" target="_blank" rel="external">http://kisspuppet.com/2014/03/29/propuppet2/</a><br>书籍《Puppet 3 Cookbook》Chapter8: External Tools the Puppet Ecosystem 下载地址：QQ群里已经共享，群号在文章最下面<br>那么在生产环境当中应当如何应用自定义的fact呢，下一章节会介绍一种方法，结合ENC(hiera)实现节点分类。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.suzf.net/2014/12/25/puppet-facter/" data-id="ciqcd6lo3004yclo9gmgxc8q6" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Puppet/">Puppet</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/facter/">facter</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/8/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" href="/page/10/">Next &raquo;</a>
    </nav>
  
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Apache/">Apache</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Auto-ops/">Auto ops</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/CouchBase/">CouchBase</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/HA/">HA</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hadoop/">Hadoop</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hardware/">Hardware</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Highcharts/">Highcharts</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/LVS/">LVS</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Life/">Life</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">28</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MongoDB/">MongoDB</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mysql/">Mysql</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Oracle/">Oracle</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Puppet/">Puppet</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">23</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Redis/">Redis</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Shell/">Shell</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tomcat/">Tomcat</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Zabbix/">Zabbix</a><span class="category-list-count">13</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Apache/">Apache</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CMD/">CMD</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ceph/">Ceph</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Debian/">Debian</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ELK/">ELK</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Exsi/">Exsi</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flask/">Flask</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GTID/">GTID</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kernel/">Kernel</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kickstart/">Kickstart</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LB/">LB</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LVS/">LVS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Life/">Life</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lnmp/">Lnmp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Log/">Log</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MongoDB/">MongoDB</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mysql/">Mysql</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NoSQL/">NoSQL</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Oracle/">Oracle</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/">PHP</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Proxy/">Proxy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Puppet/">Puppet</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a><span class="tag-list-count">23</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RAC/">RAC</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Re/">Re</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ZK/">ZK</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zabbix/">Zabbix</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bug/">bug</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/code/">code</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/coredump/">coredump</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/couchbase/">couchbase</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/debug/">debug</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/diy/">diy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elasticsearch/">elasticsearch</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/expect/">expect</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/facter/">facter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/faq/">faq</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hadoop/">hadoop</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/highcharts/">highcharts</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/idrac/">idrac</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iso/">iso</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka/">kafka</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lvm/">lvm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pip/">pip</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/">redis</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rewrite/">rewrite</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rsync/">rsync</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rsyslog/">rsyslog</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/snmp/">snmp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/strace/">strace</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sudo/">sudo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tcpdump/">tcpdump</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tomcat/">tomcat</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/">web</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wiki/">wiki</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zookeeper/">zookeeper</a><span class="tag-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Apache/" style="font-size: 10px;">Apache</a> <a href="/tags/CMD/" style="font-size: 10px;">CMD</a> <a href="/tags/Ceph/" style="font-size: 10.91px;">Ceph</a> <a href="/tags/Debian/" style="font-size: 10px;">Debian</a> <a href="/tags/ELK/" style="font-size: 10px;">ELK</a> <a href="/tags/Exsi/" style="font-size: 10px;">Exsi</a> <a href="/tags/Flask/" style="font-size: 10px;">Flask</a> <a href="/tags/GTID/" style="font-size: 10.91px;">GTID</a> <a href="/tags/Kernel/" style="font-size: 10.91px;">Kernel</a> <a href="/tags/Kickstart/" style="font-size: 10px;">Kickstart</a> <a href="/tags/LB/" style="font-size: 10px;">LB</a> <a href="/tags/LVS/" style="font-size: 10px;">LVS</a> <a href="/tags/Life/" style="font-size: 10px;">Life</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/Lnmp/" style="font-size: 10px;">Lnmp</a> <a href="/tags/Log/" style="font-size: 10px;">Log</a> <a href="/tags/MongoDB/" style="font-size: 11.82px;">MongoDB</a> <a href="/tags/Mysql/" style="font-size: 19.09px;">Mysql</a> <a href="/tags/Nginx/" style="font-size: 16.36px;">Nginx</a> <a href="/tags/NoSQL/" style="font-size: 12.73px;">NoSQL</a> <a href="/tags/Oracle/" style="font-size: 11.82px;">Oracle</a> <a href="/tags/PHP/" style="font-size: 10.91px;">PHP</a> <a href="/tags/Proxy/" style="font-size: 10px;">Proxy</a> <a href="/tags/Puppet/" style="font-size: 14.55px;">Puppet</a> <a href="/tags/Python/" style="font-size: 20px;">Python</a> <a href="/tags/RAC/" style="font-size: 10.91px;">RAC</a> <a href="/tags/Re/" style="font-size: 11.82px;">Re</a> <a href="/tags/ZK/" style="font-size: 10px;">ZK</a> <a href="/tags/Zabbix/" style="font-size: 18.18px;">Zabbix</a> <a href="/tags/bug/" style="font-size: 10px;">bug</a> <a href="/tags/code/" style="font-size: 10px;">code</a> <a href="/tags/coredump/" style="font-size: 10px;">coredump</a> <a href="/tags/couchbase/" style="font-size: 10px;">couchbase</a> <a href="/tags/debug/" style="font-size: 10px;">debug</a> <a href="/tags/diy/" style="font-size: 10px;">diy</a> <a href="/tags/elasticsearch/" style="font-size: 10px;">elasticsearch</a> <a href="/tags/expect/" style="font-size: 10px;">expect</a> <a href="/tags/facter/" style="font-size: 10px;">facter</a> <a href="/tags/faq/" style="font-size: 17.27px;">faq</a> <a href="/tags/hadoop/" style="font-size: 10px;">hadoop</a> <a href="/tags/highcharts/" style="font-size: 10px;">highcharts</a> <a href="/tags/idrac/" style="font-size: 10px;">idrac</a> <a href="/tags/iso/" style="font-size: 10px;">iso</a> <a href="/tags/kafka/" style="font-size: 10px;">kafka</a> <a href="/tags/lvm/" style="font-size: 10px;">lvm</a> <a href="/tags/pip/" style="font-size: 12.73px;">pip</a> <a href="/tags/redis/" style="font-size: 15.45px;">redis</a> <a href="/tags/rewrite/" style="font-size: 10px;">rewrite</a> <a href="/tags/rsync/" style="font-size: 10px;">rsync</a> <a href="/tags/rsyslog/" style="font-size: 10px;">rsyslog</a> <a href="/tags/snmp/" style="font-size: 10px;">snmp</a> <a href="/tags/strace/" style="font-size: 10px;">strace</a> <a href="/tags/sudo/" style="font-size: 10px;">sudo</a> <a href="/tags/tcpdump/" style="font-size: 10px;">tcpdump</a> <a href="/tags/tomcat/" style="font-size: 13.64px;">tomcat</a> <a href="/tags/vim/" style="font-size: 10.91px;">vim</a> <a href="/tags/web/" style="font-size: 12.73px;">web</a> <a href="/tags/wiki/" style="font-size: 10px;">wiki</a> <a href="/tags/zookeeper/" style="font-size: 12.73px;">zookeeper</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/05/12/839/">Linux 下使用 strace 诊断疑难杂症</a>
          </li>
        
          <li>
            <a href="/2016/04/27/MySQL_mysqldump_数据导出详解/">MySQL mysqldump 数据导出详解</a>
          </li>
        
          <li>
            <a href="/2016/04/24/Python_Re_module_learn/">Python Re module learn</a>
          </li>
        
          <li>
            <a href="/2016/04/22/Python正则表达式操作指南/">Python正则表达式操作指南</a>
          </li>
        
          <li>
            <a href="/2016/04/18/Hello_Kafka/">Hello Kafka</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Jeffrey Su<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>