<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Suzf Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Suzf linux tech blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Suzf Blog">
<meta property="og:url" content="http://blog.suzf.net/page/3/index.html">
<meta property="og:site_name" content="Suzf Blog">
<meta property="og:description" content="Suzf linux tech blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Suzf Blog">
<meta name="twitter:description" content="Suzf linux tech blog">
  
    <link rel="alternative" href="/atom.xml" title="Suzf Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Suzf Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Life is short, We need smile.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.suzf.net"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-redis-sentinel-test" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/17/redis-sentinel-test/" class="article-date">
  <time datetime="2016-03-17T10:00:00.000Z" itemprop="datePublished">2016-03-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Redis/">Redis</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/17/redis-sentinel-test/">Redis Sentinel Test</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Redis Sentinel 是一套用于管理Redis实例的分布式系统,主要完成3项任务:</p>
<p>1. Monitoring:持续监控Redis master或slave实例的运行情况是否符合预期<br>2. Notification:若被监控的Redis实例运行异常,sentinel会通过API通知外界（人或程序）<br>3. Automation failover:若master实例故障,sentinel会重新选主并启动自动故障切换:选择slave-priority最小的那个slave实例并将其提升为master,同时修改其它slave的配置,使其master配置项指向新的master,当old master恢复重启后,会自动降级为new master的slave.最后,根据配置,Redis Sentinel还会将新的master地址通知给当前正在访问Redis的应用程序.</p>
<p>Raft分布式算法</p>
<p>1. 主要用途:用于分布式系统,系统容错,以及选出领头羊<br>2. 作者:Diego Ongaro,毕业于哈佛<br>3. 目前用到这个算法的项目有:<br>a. CoreOS<br>b. ectd : a distributed, consistent shared configuration<br>c. LogCabin : 分布式存储系统<br>d. redis sentinel : redis 的监控系统</p>
<p>Sentinel使用的Raft算法核心: 原则</p>
<p>1. 所有sentinel都有选举的领头羊的权利<br>2. 每个sentinel都会要求其他sentinel选举自己为领头羊(主要由发现redis客观下线的sentinel先发起选举)<br>3. 每个sentinel只有一次选举的机会<br>4. 采用先到先得的原则<br>5. 一旦加入到系统了,则不会自动清除(这一点很重要, why?)<br>6. 每个sentinel都有唯一的uid,不会因为重启而变更<br>7. 达到领头羊的条件是 N/2 + 1个sentinel选择了自己<br>8. 采用配置纪元,如果一次选举出现脑裂,则配置纪元会递增,进入下一次选举,所有sentinel都会处于统一配置纪元,以最新的为标准.</p>
<p>Sentinel 配置样例</p>
<p><pre class="lang:default decode:true ">  port 26379<br>  dir /tmp<br>  sentinel monitor mymaster 127.0.0.1 6379 2<br>  sentinel down-after-milliseconds mymaster 30000<br>  sentinel parallel-syncs mymaster 1<br>  sentinel failover-timeout mymaster 180000<br>  sentinel notification-script myredis &lt;script-path&gt;</pre><br>其中:<br>port: 指定sentinel的侦听端口（即与redis server或client建立tcp连接的端口）<br>dir: 工作路径,sentinel一般指定/tmp比较简单<br>monitor: 指定sentinel要monitor的redis实例,包括一个redis实例的别名（alias）及redis实例的ip+port,该行最后的数字2表示至少2个setinel实例同时检测到redis server异常时,才将redis server的状态判决为real fail.也即,若这里配置为2,但实际部署中sentinel只部署了1套,则即使redis实例已经挂掉,sentinel也不会给出任何警告.这一点需要特别引起注意.<br>down-after-milliseconds: 指定sentinel监控到redis实例持续异常多长时间后,会判决其状态为down.若实际业务需要sentinel尽快判决出redis实例异常,则该值可适当配小.<br>failover-timeout: 若sentinel在该配置值内未能完成failover操作（即故障时master/slave自动切换）,则认为本次failover失败.该配置有4个用途,具体可参考sentinel.conf中的说明,限于篇幅,此处不再赘述.<br>parallel-syncs: 指定failover过程中,同时被sentinel reconfigure的最大slave实例数.由于reconfigure过程中,对应的slave会中断响应客户端请求,故为避免所有的slave同时不可用,该值需适当配小.<br>notification-script: 指定sentinel检测到master-name指向的实例异常时,调用的报警脚本.该配置项可选,但线上系统建议配置.</p>
<p>启动 sentinel的方法</p>
<p>当前Redis stable版已经自带了redis-sentinel这个工具.虽然 Redis Sentinel 已经提供了一个单独的可执行文件 redis-sentinel , 但实际上它只是一个运行在特殊模式下的 Redis实例, 你可以在启动一个普通 Redis实例时通过给定 –sentinel 选项来启动 Redis Sentinel 实例.也就是说:<br>redis-sentinel /path/to/sentinel.conf<br>等同于<br>redis-server /path/to/sentinel.conf –sentinel<br>其中sentinel.conf是redis的配置文件,Redis sentinel会需要写入配置文件来保存sentinel的当前状态.当配置文件无法写入时,Sentinel启动失败.</p>
<p>sentinel 测试<br>实验环境 &lt; one master / Three slaves / two sentinels &gt;:<br>a. one master（slave-priority为90）部署在ip为192.168.9.10的机器上；<br>b.Three slaves（slave-priority分别为100）的均部署在ip为192.168.9.70的机器上；<br>c. 启用两个sentinel进程监控redis集群状态</p>
<p>配置 sentinel</p>
<p>Sentinel可以通过master Redis实例来获得它的从实例的信息.所以每一个Sentinel只配置主实例的监控即可.Sentinel之间端口有所不同.</p>
<p><pre class="lang:default decode:true">  port 6666<br>  daemonize yes<br>  logfile “/var/log/redis/sentinel-6666.log”</pre></p>
<p>  #master 1111<br>  sentinel monitor master-1111 192.168.9.10 11111 1<br>  sentinel config-epoch master-1111 6<br>  sentinel leader-epoch master-1111 6<br>  sentinel known-slave master-1111 192.168.9.70 2222<br>启动 sentinel<br>配置文件修改完成后,启动各监控进程即可,例如:<br>redis-server /etc/redis/sentinel-6666.conf</p>
<p>连接Sentinel和主动failover</p>
<p>在默认情况下,Sentinel 使用TCP端口26379（普通 Redis 服务器使用的是 6379）.<br>Sentinel 接受 Redis 协议格式的命令请求,所以你可以使用 redis-cli 或者任何其他 Redis 客户端来与 Sentinel 进行通讯.<br>有两种方式可以和 Sentinel 进行通讯:<br>第一种方法是通过直接发送命令来查询被监视 Redis 服务器的当前状态, 以及进行主动转移等操作.这些命令包括:</p>
<p>SENTINEL masters<br>列出所有被监视的主Redis服务实例,以及这些主服务实例的当前状态.</p>
<p>SENTINEL slaves<br>列出给定主服务实例的所有从实例,以及这些从实例的当前状态.</p>
<p>SENTINEL get-master-addr-by-name<br>返回给定名字的主实例的 IP 地址和端口号. 如果这个主实例正在执行故障转移操作, 或者针对这个主实例的故障转移操作已经完成, 那么这个命令返回新的主服务器的 IP 地址和端口号.</p>
<p>SENTINEL reset:<br>重置所有名字和给定模式 pattern 相匹配的主服务器. pattern 参数是一个 Glob 风格的模式. 重置操作清除该sentinel的所保存的所有状态信息,并进行一次重新的发现过程.</p>
<p>SENTINEL failover<br>进行一次主动的failover.即在不询问其他 Sentinel 意见的情况下, 强制开始一次自动故障迁移 .发起故障转移的 Sentinel 会向其他 Sentinel 发送一个新的配置,其他 Sentinel 会根据这个配置进行相应的更新.^_^[17:19:25][root@master01 ~]#redis-cli  -p 6666</p>
<p><pre class="lang:default decode:true ">redis 127.0.0.1:6666&gt; SENTINEL masters<br>1)  1) “name”<br>2) “master-1111”<br>3) “ip”<br>4) “192.168.9.10”<br>5) “port”<br>6) “1111”<br>7) “runid”<br>8) “5d6c2f08547ffe9446eb54c85dc40959e66b203d”<br>9) “flags”<br>10) “master”<br>11) “pending-commands”<br>12) “0”<br>13) “last-ping-sent”<br>14) “0”<br>15) “last-ok-ping-reply”<br>16) “947”<br>17) “last-ping-reply”<br>18) “947”<br>19) “down-after-milliseconds”<br>20) “30000”<br>21) “info-refresh”<br>22) “6259”<br>23) “role-reported”<br>24) “master”<br>25) “role-reported-time”<br>26) “126884”<br>27) “config-epoch”<br>28) “7”<br>29) “num-slaves”<br>30) “3”<br>31) “num-other-sentinels”<br>32) “1”<br>33) “quorum”<br>34) “1”<br>35) “failover-timeout”<br>36) “180000”<br>37) “parallel-syncs”<br>38) “1”</pre></p>
<p>redis 127.0.0.1:6666&gt; SENTINEL slaves master-1111<br>1)  1) “name”<br>2) “192.168.9.10:1112”<br>3) “ip”<br>4) “192.168.9.10”<br>5) “port”<br>6) “1112”<br>7) “runid”<br>8) “”<br>9) “flags”<br>10) “s_down,slave,disconnected”<br>11) “pending-commands”<br>12) “0”<br>13) “last-ping-sent”<br>14) “215549”<br>15) “last-ok-ping-reply”<br>16) “215549”<br>17) “last-ping-reply”<br>18) “215549”<br>19) “s-down-time”<br>20) “185544”<br>21) “down-after-milliseconds”<br>22) “30000”<br>23) “info-refresh”<br>24) “1458206565223”<br>25) “role-reported”<br>26) “slave”<br>27) “role-reported-time”<br>28) “215549”<br>29) “master-link-down-time”<br>30) “0”<br>31) “master-link-status”<br>32) “err”<br>33) “master-host”<br>34) “?”<br>35) “master-port”<br>36) “0”<br>37) “slave-priority”<br>38) “100”<br>39) “slave-repl-offset”<br>40) “0”<br>2)  1) “name”<br>2) “192.168.9.70:2222”<br>3) “ip”<br>4) “192.168.9.70”<br>5) “port”<br>6) “2222”<br>7) “runid”<br>8) “”<br>9) “flags”<br>10) “s_down,slave,disconnected”<br>11) “pending-commands”<br>12) “0”<br>13) “last-ping-sent”<br>14) “215549”<br>15) “last-ok-ping-reply”<br>16) “215549”<br>17) “last-ping-reply”<br>18) “215549”<br>19) “s-down-time”<br>20) “185544”<br>21) “down-after-milliseconds”<br>22) “30000”<br>23) “info-refresh”<br>24) “1458206565223”<br>25) “role-reported”<br>26) “slave”<br>27) “role-reported-time”<br>28) “215549”<br>29) “master-link-down-time”<br>30) “0”<br>31) “master-link-status”<br>32) “err”<br>33) “master-host”<br>34) “?”<br>35) “master-port”<br>36) “0”<br>37) “slave-priority”<br>38) “100”<br>39) “slave-repl-offset”<br>40) “0”<br>3)  1) “name”<br>2) “192.168.9.70:2223”<br>3) “ip”<br>4) “192.168.9.70”<br>5) “port”<br>6) “2223”<br>7) “runid”<br>8) “9987aebafc55d750145a61f9109cf7d9fb7c8613”<br>9) “flags”<br>10) “slave”<br>11) “pending-commands”<br>12) “0”<br>13) “last-ping-sent”<br>14) “0”<br>15) “last-ok-ping-reply”<br>16) “372”<br>17) “last-ping-reply”<br>18) “372”<br>19) “down-after-milliseconds”<br>20) “30000”<br>21) “info-refresh”<br>22) “4616”<br>23) “role-reported”<br>24) “slave”<br>25) “role-reported-time”<br>26) “215549”<br>27) “master-link-down-time”<br>28) “0”<br>29) “master-link-status”<br>30) “ok”<br>31) “master-host”<br>32) “192.168.9.10”<br>33) “master-port”<br>34) “1111”<br>35) “slave-priority”<br>36) “100”<br>37) “slave-repl-offset”<br>38) “29082”</p>
<p>查看当前的master<br>redis 127.0.0.1:6666&gt;  SENTINEL get-master-addr-by-name master-1111<br>1) “192.168.9.10”<br>2) “1111”<br>&nbsp;</p>
<p>使用发布与订阅功能, 通过接收 Sentinel 发送的通知: 当执行故障转移操作, 或者某个被监视的实例被判断为主观下线或者客观下线时, Sentinel 就会发送相应的信息.<br>一个频道能够接收和这个频道的名字相同的事件. 比如说,名为 +sdown 的频道就可以接收所有实例进入主观下线（SDOWN）状态的事件.<br>通过执行 PSUBSCRIBE * 命令可以接收所有事件信息.例如：</p>
<p><pre class="lang:default decode:true ">^_^[17:50:13][root@master01 ~]#redis-cli -p 6666 info| grep 192<br>master0:name=master-1111,status=ok,address=192.168.9.10:1111,slaves=3,sentinels=2</pre></p>
<p>^_^[17:50:21][root@master01 ~]#redis-cli -p 6666 sentinel failover master-1111<br>OK</p>
<p>@_@[17:50:09][root@master01 ~]#redis-cli -p 6666<br>redis 127.0.0.1:6666&gt;  SENTINEL get-master-addr-by-name master-1111<br>1) “192.168.9.10”<br>2) “1111”<br>redis 127.0.0.1:6666&gt; PSUBSCRIBE <em><br>Reading messages… (press Ctrl-C to quit)<br>1) “psubscribe”<br>2) “</em>“<br>3) (integer) 1<br>1) “pmessage”<br>2) “<em>“<br>3) “+new-epoch”<br>4) “8”<br>1) “pmessage”<br>2) “</em>“<br>3) “+try-failover”<br>4) “master master-1111 192.168.9.10 1111”<br>1) “pmessage”<br>2) “<em>“<br>3) “+vote-for-leader”<br>4) “691dc32d3a3c1afdc5b18a8e5541c885aa04c487 8”<br>1) “pmessage”<br>2) “</em>“<br>3) “+elected-leader”<br>4) “master master-1111 192.168.9.10 1111”<br>1) “pmessage”<br>2) “<em>“<br>3) “+failover-state-select-slave”<br>4) “master master-1111 192.168.9.10 1111”<br>1) “pmessage”<br>2) “</em>“<br>3) “+selected-slave”<br>4) “slave 192.168.9.10:1112 192.168.9.10 1112 @ master-1111 192.168.9.10 1111”<br>1) “pmessage”<br>2) “<em>“<br>3) “+failover-state-send-slaveof-noone”<br>4) “slave 192.168.9.10:1112 192.168.9.10 1112 @ master-1111 192.168.9.10 1111”<br>1) “pmessage”<br>2) “</em>“<br>3) “+failover-state-wait-promotion”<br>4) “slave 192.168.9.10:1112 192.168.9.10 1112 @ master-1111 192.168.9.10 1111”<br>1) “pmessage”<br>2) “<em>“<br>3) “-role-change”<br>4) “slave 192.168.9.10:1112 192.168.9.10 1112 @ master-1111 192.168.9.10 1111 new reported role is master”<br>1) “pmessage”<br>2) “</em>“<br>3) “+promoted-slave”<br>4) “slave 192.168.9.10:1112 192.168.9.10 1112 @ master-1111 192.168.9.10 1111”<br>1) “pmessage”<br>2) “<em>“<br>3) “+failover-state-reconf-slaves”<br>4) “master master-1111 192.168.9.10 1111”<br>1) “pmessage”<br>2) “</em>“<br>3) “+slave-reconf-sent”<br>4) “slave 192.168.9.70:2222 192.168.9.70 2222 @ master-1111 192.168.9.10 1111”<br>1) “pmessage”<br>2) “<em>“<br>3) “+slave-reconf-inprog”<br>4) “slave 192.168.9.70:2222 192.168.9.70 2222 @ master-1111 192.168.9.10 1111”<br>1) “pmessage”<br>2) “</em>“<br>3) “+slave-reconf-done”<br>4) “slave 192.168.9.70:2222 192.168.9.70 2222 @ master-1111 192.168.9.10 1111”<br>1) “pmessage”<br>2) “<em>“<br>3) “+slave-reconf-sent”<br>4) “slave 192.168.9.70:2223 192.168.9.70 2223 @ master-1111 192.168.9.10 1111”<br>1) “pmessage”<br>2) “</em>“<br>3) “+slave-reconf-inprog”<br>4) “slave 192.168.9.70:2223 192.168.9.70 2223 @ master-1111 192.168.9.10 1111”<br>1) “pmessage”<br>2) “<em>“<br>3) “+slave-reconf-done”<br>4) “slave 192.168.9.70:2223 192.168.9.70 2223 @ master-1111 192.168.9.10 1111”<br>1) “pmessage”<br>2) “</em>“<br>3) “+failover-end”<br>4) “master master-1111 192.168.9.10 1111”<br>1) “pmessage”<br>2) “<em>“<br>3) “+switch-master”<br>4) “master-1111 192.168.9.10 1111 192.168.9.10 1112”<br>1) “pmessage”<br>2) “</em>“<br>3) “+slave”<br>4) “slave 192.168.9.70:2222 192.168.9.70 2222 @ master-1111 192.168.9.10 1112”<br>1) “pmessage”<br>2) “<em>“<br>3) “+slave”<br>4) “slave 192.168.9.70:2223 192.168.9.70 2223 @ master-1111 192.168.9.10 1112”<br>1) “pmessage”<br>2) “</em>“<br>3) “+slave”<br>4) “slave 192.168.9.10:1111 192.168.9.10 1111 @ master-1111 192.168.9.10 1112”<br>1) “pmessage”<br>2) “<em>“<br>3) “-role-change”<br>4) “slave 192.168.9.10:1111 192.168.9.10 1111 @ master-1111 192.168.9.10 1112 new reported role is master”<br>1) “pmessage”<br>2) “</em>“<br>3) “+role-change”<br>4) “slave 192.168.9.10:1111 192.168.9.10 1111 @ master-1111 192.168.9.10 1112 new reported role is slave”<br>一次故障转移操作由以下步骤组成：<br>(1). 由sentinel主动发起failover或者发现主服务器已经进入客观下线状态.<br>(2). sentinel对我们的当前纪元(epoch)进行自增,并尝试在这个纪元中当选为此次failover的总指挥.<br>(3). 如果当选失败, 那么在设定的故障迁移超时时间的两倍之后, 重新尝试当选. 如果当选成功, 那么执行以下步骤.<br>(4). 选出一个从redis实例,并将它升级为主redis实例.<br>(5). 向被选中的从redis实例发送 SLAVEOF NO ONE 命令,让它转变为主redis实例.<br>(6). 通过发布与订阅功能, 将更新后的配置传播给所有其他 Sentinel , 其他 Sentinel 对它们自己的配置进行更新.<br>(7). 向已下线主服务器的从服务器发送SLAVEOF命令, 让它们去复制新的主服务器.<br>(8). 当所有从redis实例都已经开始复制新的主redis实例时, 领头Sentinel 终止这次故障迁移操作.</p>
<p>FAQ:<br>若master实例故障,则最好等sentinel选出new master且稳定后（选新主并完成切换的时间与配置有关,典型值在1分钟之内）,再重启old master,避免引发sentinel的误判,导致整个系统无法选出new master.</p>
<p>最大内存问题:要设置好最大内存,以防不停的申请内存,造成系统内存都被用完.</p>
<p>Fork进程问题:’vm.overcommit_memory = 1’这一个选项要加到系统的配置中,防止fork因内存不足而失败.</p>
<p>密码问题:需要设置复杂一些,防止暴力破解.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.suzf.net/2016/03/17/redis-sentinel-test/" data-id="ciq4n5j7v003n7xo9xvrfys0p" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/">redis</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Redis_主从复制" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/17/Redis_主从复制/" class="article-date">
  <time datetime="2016-03-17T07:56:24.000Z" itemprop="datePublished">2016-03-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Redis/">Redis</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/17/Redis_主从复制/">Redis 主从复制</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Redis 安装见 <a href="http://suzf.net/thread-0314-616.html" target="_blank" rel="external">Redis Setup</a></p>
<p>环境<br>CentOS 6.x<br>Redis=3.0.7</p>
<p>master01<br>port 1111<br>192.168.9.10/24</p>
<p>ocean-lab<br>port 2222<br>192.168.9.70/24</p>
<p>主从复制<br>1.为什么使用，好处？<br>1.1 单个redis服务器压力过大，可考虑，master写，slave读，分散缓解服务器压力。<br>1.2 一个master可以拥有多个slave，而一个slave又可以拥有多个slave</p>
<p>2.主从复制过程<br>2.1 master、slave 建立连接且slave 向master 发起同步请求<br>2.2 请求成功之后 slave 接受master发送过来的dump.rdb的快照文件<br>2.3 slave载入dump.rdb文件<br>2.4 当master和slave的连接断开时slave可以自动重新建立连接。如果master同时收到多个 slave发来的同步连接命令，只会使用启动一个进程来写数据库镜像，然后发送给所有slave。</p>
<p><a href="http://suzf.net/wp-content/uploads/2016/03/redis_replication.png" target="_blank" rel="external"><img src="http://suzf.net/wp-content/uploads/2016/03/redis_replication.png" alt="redis_replication"></a></p>
<p>主从配置<br>配置 Master-Slave,只需要在 Slave 上配置 Master 节点IP Port:</p>
<h1 id="slaveof__26lt_3Bmasterip_26gt_3B__26lt_3Bmasterport_26gt_3B"><a href="#slaveof__26lt_3Bmasterip_26gt_3B__26lt_3Bmasterport_26gt_3B" class="headerlink" title="slaveof &lt;masterip&gt; &lt;masterport&gt;"></a>slaveof &lt;masterip&gt; &lt;masterport&gt;</h1><h1 id="Since_Redis_2-6_by_default_slaves_are_read-only_-_slave-read-only_yes"><a href="#Since_Redis_2-6_by_default_slaves_are_read-only_-_slave-read-only_yes" class="headerlink" title="Since Redis 2.6 by default slaves are read-only - slave-read-only yes"></a>Since Redis 2.6 by default slaves are read-only - slave-read-only yes</h1><p>[16:44:26][root@ocean-lab ~]$ echo “slaveof  192.168.9.10 1111” &gt;&gt; /etc/redis/2222.conf<br>[16:44:40][root@ocean-lab ~]$ /etc/init.d/redis_2222 restart</p>
<p>测试<br>^<em>^[16:52:22][root@master01 ~]#redis-cli -h 192.168.9.70 -p 2222 ping<br>PONG<br>^</em>^[16:56:39][root@master01 ~]#redis-cli -h 192.168.9.10 -p 1111 ping<br>PONG</p>
<p>验证</p>
<p>在master 上查看当前有多少key<br>^<em>^[16:52:10][root@master01 ~]#redis-cli -p 1111 get name<br>“suzf.net”<br>^</em>^[16:56:57][root@master01 ~]#redis-cli -h 192.168.9.10 -p 1111 keys *<br>1) “name”</p>
<p>在master上添加一个key<br>^_^[16:59:54][root@master01 ~]#redis-cli -h 192.168.9.10 -p 1111 set homepage suzf.net<br>OK</p>
<p>然后在slave上面查看<br>^<em>^[17:02:19][root@master01 ~]#redis-cli -h 192.168.9.70 -p 2222 keys *<br>1) “name”<br>2) “homepage”<br>^</em>^[17:02:59][root@master01 ~]#redis-cli -h 192.168.9.10 -p 1111 get homepage<br>“suzf.net”</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.suzf.net/2016/03/17/Redis_主从复制/" data-id="ciq4n5jgv00bd7xo93wq9mjpy" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/">redis</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Redis_监控技巧" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/14/Redis_监控技巧/" class="article-date">
  <time datetime="2016-03-14T10:03:29.000Z" itemprop="datePublished">2016-03-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Redis/">Redis</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/14/Redis_监控技巧/">Redis 监控技巧</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <div id="wrap"><br><div id="content"><br><div id="contentleft"><br><div class="postarea"><br><div id="wrap"><br><div id="content"><br><div id="contentleft"><br><div class="postarea"><br><br>本文来自 <a href="https://bugsnag.com/" target="_blank" rel="external">Bugsnag</a> 的联合创始人 <a href="https://twitter.com/snmaynard/" target="_blank" rel="external">Simon Maynard</a> 的系列文章，作者根据几年来对 <span class="wp_keywordlink_affiliate"><a href="http://blog.nosqlfan.com/tags/redis" title="查看 Redis 的全部文章" target="_blank" rel="external">Redis</a></span> 的使用经历，对 Redis <span class="wp_keywordlink_affiliate"><a href="http://blog.nosqlfan.com/tags/%e7%9b%91%e6%8e%a7" title="查看 监控 的全部文章" target="_blank" rel="external">监控</a></span>方法进行了系统性的总结，干货很多，值得一看。<br><br>原文链接：<a href="http://snmaynard.com/2013/01/22/redis-masterclass-part-two-monitoring-redis/" target="_blank" rel="external">Redis Masterclass – Part 2, Monitoring</a><br><br>Redis 监控最直接的方法当然就是使用系统提供的 info 命令来做了，你只需要执行下面一条命令，就能获得 Redis 系统的状态报告。<br><pre>redis-cli info</pre><br><br>### 内存使用<br><br>如果 Redis 使用的内存超出了可用的物理内存大小，那么 Redis 很可能系统会被 <a href="http://linux-mm.org/OOM_Killer" target="_blank" rel="external">OOM Killer</a> 杀掉。针对这一点，你可以通过 info 命令对 _used<em>memory</em> 和 _used_memory<em>peak</em> 进行监控，为使用内存量设定阈值，并设定相应的报警机制。当然，报警只是手段，重要的是你得预先计划好，当内存使用量过大后，你应该做些什么，是清除一些没用的冷数据，还是把 Redis 迁移到更强大的机器上去。<br><br>### 持久化<br><br>如果因为你的机器或 Redis 本身的问题导致 Redis 崩溃了，那么你唯一的救命稻草可能就是 dump 出来的 rdb文件了，所以，对 Redis dump 文件进行监控也是很重要的。你可以通过对 _rdb_last_save<em>time</em> 进行监控，了解你最近一次 dump 数据操作的时间，还可以通过对 _rdb_changes_since_last<em>save</em> 进行监控来知道如果这时候出现故障，你会丢失多少数据。<br><br>### 主从复制<br><br>如果你设置了主从复制模式，那么你最好对复制的情况是否正常做一些监控，主要是对 info 输出中的 _master_link<em>status</em> 进行监控，如果这个值是 up，那么说明同步正常，如果是 down，那么你就要注意一下输出的其它一些诊断信息了。比如下面这些：<br><pre>role:slave master_host:192.168.1.128 master_port:6379 master_link_status:down master_last_io_seconds_ago:-1 master_sync_in_progress:0 master_link_down_since_seconds:1356900595</pre><br><br>### Fork 性能<br><br>当 Redis 持久化数据到磁盘上时，它会进行一次 fork 操作，通过 fork 对内存的 copy on write 机制最廉价的实现内存镜像。但是虽然内存是 copy on write 的，但是虚拟内存表是在 fork 的瞬间就需要分配，所以 fork 会造成主线程短时间的卡顿（停止所有读写操作），这个卡顿时间和当前 Redis 的内存使用量有关。通常 GB 量级的 Redis 进行 fork 操作的时间在毫秒级。你可以通过对 info 输出的 _latest_fork<em>usec</em> 进行监控来了解最近一次 fork 操作导致了多少时间的卡顿。<br><br>### 配置一致<br><br>Redis 支持使用 <a href="http://redis.io/commands/config-set" target="_blank" rel="external">CONFIG SET</a> 操作来实现运行实的配置修改，这很方便，但同时也会导致一个问题。就是通过这个命令动态修改的配置，是不会同步到你的配置文件中去的。所以当你因为某些原 因重启 Redis 时，你使用 CONFIG SET 做的配置修改就会丢失掉，所以我们最好保证在每次使用 CONFIG SET 修改配置时，也把配置文件一起相应地改掉。为了防止人为的失误，所以我们最好对配置进行监控，使用 <a href="http://redis.io/commands/config-get" target="_blank" rel="external">CONFIG GET</a> 命令来获取当前运行时的配置，并与 redis.conf 中的配置值进行对比，如果发现两边对不上，就启动报警。<br><br>### 慢日志<br><br>Redis 提供了 <a href="http://redis.io/commands/slowlog" target="_blank" rel="external">SLOWLOG</a> 指令来获取最近的慢日志，Redis 的慢日志是直接存在内存中的，所以它的慢日志开销并不大，在实际应用中，我们通过 crontab 任务执行 SLOWLOG 命令来获取慢日志，然后将慢日志存到文件中，并用 <a href="http://kibana.org/" target="_blank" rel="external">Kibana</a> 生成实时的性能图表来实现性能监控。<br><br>值得一提的是，Redis 的慢日志记录的时间，仅仅包括 Redis 自身对一条命令的执行时间，不包括 IO 的时间，比如接收客户端数据和发送客户端数据这些时间。另外，Redis 的慢日志和其它数据库的慢日志有一点不同，其它数据库偶尔出现 100ms 的慢日志可能都比较正常，因为一般数据库都是多线程并发执行，某个线程执行某个命令的性能可能并不能代表整体性能，但是对<br><br>来说，它是单线程的，一旦出现慢日志，可能就需要马上得到重视，最好去查一下具体是什么原因了。<br><br>### 监控服务<br><br>#### -Sentinel<br><br><a href="http://redis.io/topics/sentinel" target="_blank" rel="external">Sentinel</a> 是 Redis 自带的工具，它可以对 Redis 主从复制进行监控，并实现主挂掉之后的自动故障转移。在转移的过程中，它还可以被配置去执行一个用户自定义的脚本，在脚本中我们就能够实现报警通知等功能。<br><br>#### -Redis Live<br><br><a href="http://www.nkrode.com/article/real-time-dashboard-for-redis" target="_blank" rel="external">Redis Live</a> 是一个更通用的 Redis 监控方案，它的原理是定时在 Redis 上执行 <a href="http://redis.io/commands/monitor" target="_blank" rel="external">MONITOR</a> 命令，来获取当前 Redis 当前正在执行的命令，并通过统计分析，生成web页面的可视化分析报表。<br><br>#### -Redis Faina<br><br><a href="http://instagram-engineering.tumblr.com/post/23132009381/redis-faina-a-query-analysis-tool-for-redis" target="_blank" rel="external">Redis Faina</a> 是由著名的图片分享应用 instagram 开发的 Redis 监控服务，其原理和 Redis Live 类似，都是对通过 <span class="wp_keywordlink_affiliate"><a href="http://blog.nosqlfan.com/tags/monitor" title="查看 MONITOR 的全部文章" target="_blank" rel="external">MONITOR</a></span> 来做的。<br><br>### 数据分布<br><br>弄清 Redis 中数据存储分布是一件很难的是，比如你想知道哪类型的 key 值占用内存最多。下面是一些工具，可以帮助你对 Redis 的数据集进行分析。<br><br>#### -Redis-sampler<br><br><a href="https://github.com/antirez/redis-sampler" target="_blank" rel="external">Redis-sampler</a> 是 Redis 作者开发的工具，它通过采样的方法，能够让你了解到当前Redis 中的数据的大致类型，数据及分布状况。<br><br>#### -Redis-audit<br><br><a href="https://github.com/snmaynard/redis-audit" target="_blank" rel="external">Redis-audit</a> 是一个脚本，通过它，我们可以知道每一类 key 对内存的使用量。它可以提供的数据有：某一类 key 值的访问频率如何，有多少值设置了过期时间，某一类 key 值使用内存的大小，这很方便让我们能排查哪些 key 不常用或者压根不用。<br><br>#### -Redis-rdb-tools<br><br><a href="https://github.com/sripathikrishnan/redis-rdb-tools" target="_blank" rel="external">Redis-rdb-tools</a>跟 Redis-audit 功能类似，不同的是它是通过对 rdb 文件进行分析来取得统计数据的。<br><br>来源: <a href="http://blog.nosqlfan.com/html/4166.html" target="_blank" rel="external">nosqlfan</a><br><br></div><br></div><br></div><br></div><br></div><br></div><br></div><br></div>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.suzf.net/2016/03/14/Redis_监控技巧/" data-id="ciq4n5jgf00b27xo951hkgnb5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NoSQL/">NoSQL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/">redis</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Redis_安装与特性简述" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/14/Redis_安装与特性简述/" class="article-date">
  <time datetime="2016-03-14T09:51:57.000Z" itemprop="datePublished">2016-03-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Redis/">Redis</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/14/Redis_安装与特性简述/">Redis 安装与特性简述</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Redis&lt; Remote Dictionary Server  &gt;作为NoSQL数据库的一种应用，响应速度和命中率上还是比较高效的。<br>项目中需要用集中式可横向扩展的缓存框架，做了一点调研，即便redis、memcached存在效率上的差异（具体比较参考<a href="http://timyang.net/data/mcdb-tt-redis/），但其实都能满足目前项目的需求；但是redis还是比较风骚的，支持链表和集合操作，支持正则表达式查找key，目前项目缓存的结果大多是链表，如果链表新增或者修改数据的话，redis就体现出了极大的优势（memcached只能重新加载链表，redis可以对链表新增或者修改）" target="_blank" rel="external">http://timyang.net/data/mcdb-tt-redis/），但其实都能满足目前项目的需求；但是redis还是比较风骚的，支持链表和集合操作，支持正则表达式查找key，目前项目缓存的结果大多是链表，如果链表新增或者修改数据的话，redis就体现出了极大的优势（memcached只能重新加载链表，redis可以对链表新增或者修改）</a></p>
<p>到目前为止Redis 支持的数据类型如下：</p>
<p>– 字符串类型<br>– 散列类型<br>– 列表类型<br>– 集合类型<br>– 有序集合类型</p>
<p><strong>1. Redis 安装</strong><br>== Redis 源码安装<br>– 参照源码 README<br>– 默认端口 6379</p>
<p><strong><em> 安装redis之前先要确认系统已经安装了GCC和libc库 </em></strong></p>
<p>wget <a href="http://download.redis.io/releases/redis-3.0.7.tar.gz" target="_blank" rel="external">http://download.redis.io/releases/redis-3.0.7.tar.gz</a><br>tar xf redis-3.0.7.tar.gz<br>cd redis-3.0.7<br>make</p>
<h1 id="make_test"><a href="#make_test" class="headerlink" title="make test"></a>make test</h1><p>make PREFIX=/usr/local/redis install</p>
<p>== 可执行命令<br>redis-server    Redis服务系统<br>redis-cli       Redis一个客户端管理工具<br>redis-benchmark 用来检测redis性能<br>redis-check-aof &amp; redis-check-dump 用来处理损坏的数据文件<br>redis-sentinel -&gt; redis-server   &lt; soft link &gt;</p>
<p>cd utils<br>./install_server.sh</p>
<p>^_^[15:50:34][root@master01 utils]#bash install_server.sh<br>Welcome to the redis service installer<br>This script will help you easily set up a running redis server</p>
<p>Please select the redis port for this instance: [6379] 1111<br>Please select the redis config file name [/etc/redis/1111.conf]<br>Selected default - /etc/redis/1111.conf<br>Please select the redis log file name [/var/log/redis_1111.log]<br>Selected default - /var/log/redis_1111.log<br>Please select the data directory for this instance [/var/lib/redis/1111]<br>Selected default - /var/lib/redis/1111<br>Please select the redis executable path [/usr/sbin/redis-server] /usr/local/redis/bin/redis-server<br>Selected config:<br>Port           : 1111<br>Config file    : /etc/redis/1111.conf<br>Log file       : /var/log/redis_1111.log<br>Data dir       : /var/lib/redis/1111<br>Executable     : /usr/local/redis/bin/redis-server<br>Cli Executable : /usr/bin/redis-cli<br>Is this ok? Then press ENTER to go on or Ctrl-C to abort.<br>Copied /tmp/1111.conf =&gt; /etc/init.d/redis_1111<br>Installing service…<br>Successfully added to chkconfig!<br>Successfully added to runlevels 345!<br>Starting Redis server…<br>Installation successful!</p>
<p><strong>2. 系统配置</strong><br>设置内存分配策略（可选，根据服务器的实际情况进行设置）<br>/proc/sys/vm/overcommit_memory<br>可选值：0、1、2。<br>0， 表示内核将检查是否有足够的可用内存供应用进程使用；如果有足够的可用内存，内存申请允许；否则，内存申请失败，并把错误返回给应用进程。<br>1， 表示内核允许分配所有的物理内存，而不管当前的内存状态如何。<br>2， 表示内核允许分配超过所有物理内存和交换空间总和的内存</p>
<p>值得注意的一点是，redis在dump数据的时候，会fork出一个子进程，理论上child进程所占用的内存和parent是一样的，比如parent占用的内存为8G，这个时候也要同样分配8G的内存给child,如果内存无法负担，往往会造成redis服务器的down机或者IO负载过高，效率下降。所以这里比较优化的内存分配策略应该设置为 1（表示内核允许分配所有的物理内存，而不管当前的内存状态如何）</p>
<p>防火墙开启redis端口</p>
<p>加入端口配置<br>iptables -A INPUT -m state –state NEW -m tcp -p tcp –dport 1111 -j ACCEPT  # &lt; redis instance port &gt;</p>
<p>写入配置文件<br>iptables-save &gt; /etc/sysconfig/iptables</p>
<p><strong>3. 启动redis服务</strong><br>/etc/init.d/redis_1111  start</p>
<p><strong>4. 测试redis</strong></p>
<p>#redis-cli  -p 1111<br>redis 127.0.0.1:1111&gt; set name suzf.net<br>OK<br>redis 127.0.0.1:1111&gt; get name<br>“suzf.net”</p>
<p>客户端连接验证</p>
<p>#redis-cli -p 1111 ping<br>PONG</p>
<p><strong>5. 关闭redis服务</strong><br>停止Redis<br>/etc/init.d/redis_1111  stop</p>
<p>关闭指定端口的redis-server<br>redis-cli -p 1111 shutdown</p>
<p>redis服务关闭后，缓存数据会自动dump到硬盘上，硬盘地址为redis.conf中的配置项dbfilename dump.rdb所设定<br>强制备份数据到磁盘，使用如下命令</p>
<p>redis-cli save<br>redis-cli -p 111 save（指定端口）</p>
<p><strong>6. Redis 常用命令</strong><br>info #查看server版本内存使用连接等信息</p>
<p>client list #获取客户连接列表</p>
<p>client kill 127.0.0.1:33441 #终止某个客户端连接</p>
<p>dbsize #当前保存key的数量</p>
<p>save #立即保存数据到硬盘</p>
<p>bgsave #异步保存数据到硬盘</p>
<p>flushdb #当前库中移除所有key</p>
<p>flushall #移除所有key从所有库中</p>
<p>lastsave #获取上次成功保存到硬盘的unix时间戳</p>
<p>monitor #实时监测服务器接收到的请求</p>
<p>slowlog len #查询慢查询日志条数</p>
<p>slowlog get #返回所有的慢查询日志，最大值取决于slowlog-max-len配置</p>
<p>slowlog get 2 #打印两条慢查询日志</p>
<p>slowlog reset #清空慢查询日志信息</p>
<p><strong>7. Redis与Mongodb 多数据库 区别</strong></p>
<p>redis数据库</p>
<p>redis的数据库个数，在配置文件中设定死了，并且名称是不允许改的。<br>databases 16     //默认16个数据库</p>
<p>这16个数据库编号是0-15，如果没有切换数据库的话，默认是0号数据库.</p>
<p><pre class="lang:default decode:true ">    #redis-cli<br>    redis 127.0.0.1:6379&gt; set test 111<br>    OK<br>    redis 127.0.0.1:6379&gt; select 1<br>    OK<br>    redis 127.0.0.1:6379[1]&gt; set test 222<br>    OK<br>    redis 127.0.0.1:6379[1]&gt; get test<br>    “222”<br>    redis 127.0.0.1:6379[1]&gt; select 0<br>    OK<br>    redis 127.0.0.1:6379&gt; get test<br>    “111”<br>    redis 127.0.0.1:6379&gt;</pre><br>数据库间相同的key,相互不受影响。</p>
<p>mongodb数据库<br>mongodb非常像关系型数据库，与redis不同的是，mongodb不用事先定义多少个数据库，数据库名也是自定义的。限制比redis少。</p>
<p><pre class="lang:default decode:true ">    #mongo<br>    MongoDB shell version: 2.4.14<br>    connecting to: test<br>    &gt; use Fern     // 如果数据库不存在会自动创建<br>    switched to db Fern</pre><br>&nbsp;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.suzf.net/2016/03/14/Redis_安装与特性简述/" data-id="ciq4n5jgp00b97xo9qzbct0lo" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NoSQL/">NoSQL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/">redis</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Python_time_模块简述" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/10/Python_time_模块简述/" class="article-date">
  <time datetime="2016-03-10T08:33:51.000Z" itemprop="datePublished">2016-03-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Python/">Python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/10/Python_time_模块简述/">Python time 模块简述</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>一、简介</p>
<p>time模块提供各种操作时间的函数<br>说明：一般有两种表示时间的方式:<br>第一种是时间戳的方式(相对于1970.1.1 00:00:00以秒计算的偏移量),时间戳是惟一的<br>第二种以数组的形式表示即(struct_time),共有九个元素，分别表示，同一个时间戳的struct_time会因为时区不同而不同<br>year (four digits, e.g. 1998)<br>month (1-12)<br>day (1-31)<br>hours (0-23)<br>minutes (0-59)<br>seconds (0-59)<br>weekday (0-6, Monday is 0)<br>Julian day (day in the year, 1-366)<br>DST (Daylight Savings Time) flag (-1, 0 or 1) 是否是夏令时<br>If the DST flag is 0, the time is given in the regular time zone;<br>if it is 1, the time is given in the DST time zone;<br>if it is -1, mktime() should guess based on the date and time.<br>夏令时介绍：<a href="http://baike.baidu.com/view/100246.htm" target="_blank" rel="external">http://baike.baidu.com/view/100246.htm</a><br>UTC介绍：<a href="http://wenda.tianya.cn/wenda/thread?tid=283921a9da7c5aef&amp;clk=wttpcts" target="_blank" rel="external">http://wenda.tianya.cn/wenda/thread?tid=283921a9da7c5aef&amp;clk=wttpcts</a></p>
<p>二、函数介绍<br>1.asctime()<br>asctime([tuple]) -&gt; string<br>将一个struct_time(默认为当时时间)，转换成字符串<br>Convert a time tuple to a string, e.g. ‘Sat Jun 06 16:26:11 1998’.<br>When the time tuple is not present, current time as returned by localtime()<br>is used.</p>
<p>2.clock()<br>clock() -&gt; floating point number<br>该函数有两个功能，<br>在第一次调用的时候，返回的是程序运行的实际时间；<br>以第二次之后的调用，返回的是自第一次调用后,到这次调用的时间间隔</p>
<p>示例：</p>
<p>[python] view plain copy</p>
<p>import time<br>if <strong>name</strong> == ‘<strong>main</strong>‘:<br>time.sleep(1)<br>print “clock1:%s” % time.clock()<br>time.sleep(1)<br>print “clock2:%s” % time.clock()<br>time.sleep(1)<br>print “clock3:%s” % time.clock()</p>
<p>输出：<br>clock1:3.35238137808e-006<br>clock2:1.00004944763<br>clock3:2.00012040636<br>其中第一个clock输出的是程序运行时间<br>第二、三个clock输出的都是与第一个clock的时间间隔</p>
<p>3.sleep(…)<br>sleep(seconds)<br>线程推迟指定的时间运行，经过测试，单位为秒，但是在帮助文档中有以下这样一句话，这关是看不懂<br>“The argument may be a floating point number for subsecond precision.”</p>
<p>4.ctime(…)<br>ctime(seconds) -&gt; string<br>将一个时间戳(默认为当前时间)转换成一个时间字符串<br>例如：<br>time.ctime()<br>输出为：’Sat Mar 28 22:24:24 2009’</p>
<p>5.gmtime(…)<br>gmtime([seconds]) -&gt; (tm_year, tm_mon, tm_day, tm_hour, tm_min,tm_sec, tm_wday, tm_yday, tm_isdst)<br>将一个时间戳转换成一个UTC时区(0时区)的struct_time，如果seconds参数未输入，则以当前时间为转换标准</p>
<p>6.localtime(…)<br>localtime([seconds]) -&gt; (tm_year,tm_mon,tm_day,tm_hour,tm_min,tm_sec,tm_wday,tm_yday,tm_isdst)<br>将一个时间戳转换成一个当前时区的struct_time，如果seconds参数未输入，则以当前时间为转换标准</p>
<p>7.mktime(…)<br>mktime(tuple) -&gt; floating point number<br>将一个以struct_time转换为时间戳</p>
<p>8.strftime(…)<br>strftime(format[, tuple]) -&gt; string<br>将指定的struct_time(默认为当前时间)，根据指定的格式化字符串输出<br>python中时间日期格式化符号：<br>%y 两位数的年份表示（00-99）<br>%Y 四位数的年份表示（000-9999）<br>%m 月份（01-12）<br>%d 月内中的一天（0-31）<br>%H 24小时制小时数（0-23）<br>%I 12小时制小时数（01-12）<br>%M 分钟数（00=59）<br>%S 秒（00-59）</p>
<p>%a 本地简化星期名称<br>%A 本地完整星期名称<br>%b 本地简化的月份名称<br>%B 本地完整的月份名称<br>%c 本地相应的日期表示和时间表示<br>%j 年内的一天（001-366）<br>%p 本地A.M.或P.M.的等价符<br>%U 一年中的星期数（00-53）星期天为星期的开始<br>%w 星期（0-6），星期天为星期的开始<br>%W 一年中的星期数（00-53）星期一为星期的开始<br>%x 本地相应的日期表示<br>%X 本地相应的时间表示<br>%Z 当前时区的名称<br>%% %号本身</p>
<p>9.strptime(…)<br>strptime(string, format) -&gt; struct_time<br>将时间字符串根据指定的格式化符转换成数组形式的时间<br>例如：<br>2009-03-20 11:45:39  对应的格式化字符串为：%Y-%m-%d %H:%M:%S<br>Sat Mar 28 22:24:24 2009 对应的格式化字符串为：%a %b %d %H:%M:%S %Y</p>
<p>10.time(…)<br>time() -&gt; floating point number<br>返回当前时间的时间戳</p>
<p>三、疑点<br>1.夏令时<br>在struct_time中，夏令时好像没有用，例如<br>a = (2009, 6, 28, 23, 8, 34, 5, 87, 1)<br>b = (2009, 6, 28, 23, 8, 34, 5, 87, 0)<br>a和b分别表示的是夏令时和标准时间，它们之间转换为时间戳应该相关3600，但是转换后输出都为646585714.0</p>
<p>四、小应用<br>1.python获取当前时间<br>time.time() 获取当前时间戳<br>time.localtime() 当前时间的struct_time形式<br>time.ctime() 当前时间的字符串形式</p>
<p>2.python格式化字符串<br>格式化成2009-03-20 11:45:39形式<br>time.strftime(“%Y-%m-%d %H:%M:%S”, time.localtime())</p>
<p>不加参数时，默认就是输出当前的时间<br>time.strftime(‘%Y-%m-%d %H:%M:%S’)</p>
<p>格式化成Sat Mar 28 22:24:24 2009形式<br>time.strftime(“%a %b %d %H:%M:%S %Y”, time.localtime())</p>
<p>3.将格式字符串转换为时间戳<br>a = “Sat Mar 28 22:24:24 2009”<br>b = time.mktime(time.strptime(a,”%a %b %d %H:%M:%S %Y”))</p>
<p>4.将时间字符串转换为时间元组struct_time<br>time.strptime(‘2015-09-16 10:27:36’,’%Y-%m-%d %H:%M:%S’)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.suzf.net/2016/03/10/Python_time_模块简述/" data-id="ciq4n5jh700bn7xo90rwq3obu" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-MySQLdb_参数处理的坑" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/02/29/MySQLdb_参数处理的坑/" class="article-date">
  <time datetime="2016-02-29T11:36:49.000Z" itemprop="datePublished">2016-02-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Python/">Python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/29/MySQLdb_参数处理的坑/">MySQLdb 参数处理的坑</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <div class="entry-content">

<p>前几天又有同事掉进了给 SQL 的 IN 条件传参的坑，就像 SELECT col1, col2 FROM table1 WHERE id IN (1, 2, 3) 这类 SQL，如果是一个可变的列表作为 IN 的参数，那这个参数应该怎么传呢？</p>
<p>我见过至少这么几种：</p>
<p><pre class="lang:default decode:true">id_list = [1, 2, 3]<br>cursor.execute(‘SELECT col1, col2 FROM table1 WHERE id IN (%s)’, id_list)<br></pre><br>这种方式是语法错误的，原因是 MySQLdb 做字符串格式化时占位符和参数个数不匹配。</p>
<p><pre class="lang:default decode:true">id_list = [1, 2, 3]<br>cursor.execute(‘SELECT col1, col2 FROM table1 WHERE id IN (%s)’, (id_list,))<br></pre><br>这种方式语法是正确的，但语义是错误的，因为生成的 SQL 是 SELECT col1, col2 FROM table1 WHERE id IN ((‘1’, ‘2’, ‘3’))</p>
<p><pre class="lang:default decode:true">id_list = [1, 2, 3]<br>id_list = ‘,’.join([str(i) for i in id_list])<br>cursor.execute(‘SELECT col1, col2 FROM table1 WHERE id IN (%s)’, id_list)</pre><br>这种方式语义也是错误的，因为生成的 SQL 是 SELECT col1, col2 FROM table1 WHERE id IN (‘1,2,3’)</p>
<p>这三种是第一次使用 MySQLdb 给 IN 传参时犯的最多的错误，大多数人遇到第一种错和掉进后两个坑之后，转而采用了下面的方式：</p>
<p><pre class="lang:default decode:true">id_list = [1, 2, 3]<br>id_list = ‘,’.join([str(i) for i in id_list])<br>cursor.execute(‘SELECT col1, col2 FROM table1 WHERE id IN (%s)’ % id_list)<br></pre><br>这个方式对于可信的参数(比如自己生成的列表：<code>range(1, 10, 2)</code>)来说可以用，但由于参数未经 escape，对于从用户端接受的不可信参数来说，存在 SQL 注入的风险。</p>
<p>严防 SQL 注入的问题时刻都不能松懈，于是就有了这样的改进版本：</p>
<p><pre class="lang:default decode:true">id_list = [1, 2, 3]<br>id_list = ‘,’.join([str(cursor.connection.literal(i)) for i in id_list])<br>cursor.execute(‘SELECT col1, col2 FROM table1 WHERE id IN (%s)’ % id_list)<br></pre><br>这个方式控制了 SQL 注入问题的滋生，但由于 <code>cursor.connection.literal</code> 是内部接口，并不推荐从外部使用。</p>
<p>然后就有了这样的方式：</p>
<p><pre class="lang:default decode:true">id_list = [1, 2, 3]<br>arg_list = ‘,’.join([‘%s’] * len(id_list))<br>cursor.execute(‘SELECT col1, col2 FROM table1 WHERE id IN (%s)’ % arg_list, id_list)<br></pre><br>这个方式是先生成与参数个数相同的 %s 占位，拼出 ‘SELECT col1, col2 FROM table1 WHERE id IN (%s,%s,%s)’ 这样的 SQL，然后使用安全的方式来传参。</p>
<p>就是想传一个参数而已，怎么会这么麻烦呢？触令丧惨！</p>
<p><strong>更正：以下划线内容为未经充分测试的错误结论，仅做记录：</strong></p>
<p>一直以为 MySQLdb 是不支持给 IN 传参的，直到这次又有同事掉坑我才读了 MySQLdb escape 部分的代码，然后发现，MySQLdb 是在很多类型的 Python object 和 SQL 支持的类型之间做自动转换的，比如 MySQLdb 会对 list 和 tuple 内的元素逐个进行 escape，生成一个 tuple，因此这才是正确的给 IN 传参的方式：</p>
<p><pre class="lang:default decode:true">id_list = [1, 2, 3]<br>cursor.execute(‘SELECT col1, col2 FROM table1 WHERE id IN %s’, (id_list,))<br></pre><br>可以把 MySQLdb 处理参数的过程简化描述为：</p>
<ol>
<li>对参数 (id_list,) 做 escape 得到 ((‘1’, ‘2’, ‘3’),)</li>
<li>用 escape 过的参数对 SQL 进行格式化：’SELECT col1, col2 FROM table1 WHERE id IN %s’ % ((‘1’, ‘2’, ‘3’),)，得到完整 SQL：’SELECT col1, col2 FROM table1 WHERE id IN (‘1’, ‘2’, ‘3’)<br>整理一下口诀：IN 的参数和其他参数一样，是一个整体，就要不要对属于参数一部分的 <code>()</code> 念念不忘了……</li>
</ol>
<p>总结一下评论中对这个方法提出的问题：</p>
<ol>
<li>如果参数列表只有一个元素，比如 <code>cursor.execute(&#39;SELECT col1, col2 FROM table1 WHERE id IN %s&#39;, ([1],))</code>，生成的 SQL 是 <code>SELECT col1, col2 FROM table1 WHERE id IN (&#39;1&#39;,)</code>，是语法错误的</li>
<li>对列表内元素做 esacpe 时增加的引号会被留下，如果列表元素是字符串，结果会是错误的，比如 <code>cursor.execute(&#39;SELECT col1, col2 FROM table1 WHERE id IN %s&#39;, ([&quot;1&quot;, &quot;2&quot;],))</code> 生成的 SQL 是 <code>SELECT col1, col2 FROM table1 WHERE id IN (&quot;&#39;1&#39;&quot;, &quot;&#39;2&#39;&quot;)</code>，而对于数字参数恰好能正确工作的原因是，在执行 SQL 时如果列定义是 int 而传参为字符串，MySQL 会做隐式类型转换（<a href="http://dev.mysql.com/doc/refman/5.5/en/type-conversion.html" target="_blank" rel="external">Type Conversion in Expression Evaluation</a>）。<br>MySQLdb 支持对各种类型的 Python object 进行转换和 escape，感兴趣的同学可以看看 <code>MySQLdb.converters</code> 和 <code>_mysql.c</code> 中 <code>*_escape*</code> 系列的函数，另外 MySQLdb 也支持自定义转换规则，参见 <code>MySQLdb.connect</code> 的 <code>conv</code> 参数。</li>
</ol>
<p></p></div><br>来源: <a href="http://blog.xupeng.me/2013/09/25/mysqldb-args-processing/" target="_blank" rel="external"> 互联网</a><p></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.suzf.net/2016/02/29/MySQLdb_参数处理的坑/" data-id="ciq4n5jhr00c47xo9i3l4nwvh" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Mysql/">Mysql</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-LVS_负载均衡简述" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/02/28/LVS_负载均衡简述/" class="article-date">
  <time datetime="2016-02-28T03:33:11.000Z" itemprop="datePublished">2016-02-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/LVS/">LVS</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/28/LVS_负载均衡简述/">LVS 负载均衡简述</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>基础知识及一些要点<br>LVS 性能调优<br>工作模式<br>– 通过NAT实现虚拟服务器（VS/NAT）<br>– 通过IP隧道实现虚拟服务器（VS/TUN）<br>– 通过直接路由实现虚拟服务器（VS/DR）</p>
<p><strong>Load Balancer(负载均衡器)：</strong></p>
<p><strong>Load Balancer</strong>是整个集群系统的前端，负责把客户请求转发到Real Server上。Load Balancer通过Ldirectord监测各Real Server的健康状况。在Real Server不可用时把它从群中剔除，恢复时重新加入。<br><strong>Backup</strong>是备份Load Balancer，当Load Balancer不可用时接替它，成为实际的Load Balancer。</p>
<p><strong>Server Array(服务器群)：</strong></p>
<p><strong>Server Array</strong>是 一组运行实际应用服务的机器，比如WEB, Mail, FTP, DNS, Media等等。在实际应用中，Load Balancer和Backup也可以兼任Real Server的角色。以下的测试就是一台服务器既担任了LVSserver,同时也是realserver节点.</p>
<p><strong>Shared Storage(共享存储)：</strong></p>
<p><strong>Shared Storage</strong>为所有Real Server提供共享存储空间和一致的数据内容。<br><strong>Director</strong>: 前端负载均衡器即运行LVS服务可以针对web、ftp、cache、mms甚至mysql等服务做load balances。<br><strong>RealServer</strong>: 后端需要负载均衡的服务器，可以为各类系统，Linux、Solaris、Aix、BSD、Windows都可，甚至Director本身也可以作为 RealServer使用.
        
          <p class="article-more-link">
            <a href="/2016/02/28/LVS_负载均衡简述/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.suzf.net/2016/02/28/LVS_负载均衡简述/" data-id="ciq4n5jim00cg7xo96651rggb" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LB/">LB</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LVS/">LVS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-How_to_limit_Flask_dev_server_to_only_one_visiting_ip_address" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/02/23/How_to_limit_Flask_dev_server_to_only_one_visiting_ip_address/" class="article-date">
  <time datetime="2016-02-23T06:41:28.000Z" itemprop="datePublished">2016-02-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Python/">Python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/23/How_to_limit_Flask_dev_server_to_only_one_visiting_ip_address/">How to limit Flask dev server to only one visiting ip address</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <div class="post-text">

<p>I’m developing a website using the Python <a href="http://flask.pocoo.org/" target="_blank" rel="external">Flask framework</a> and I now do some devving, pushing my changes to a remote dev server. I set this remote dev server up to serve the website publically using <code>app.run(host=&#39;0.0.0.0&#39;)</code>.</p>
<p>This works fine, but I just don’t want other people to view my website yet. For this reason I somehow want to whitelist my ip so that the dev server only serves the website to my own ip address, giving no response, 404’s or some other non-useful response to other ip addresses. I can of course set up the server to use apache or nginx to actually serve the website, but I like the automatic reloading of the website on code changes for devving my website</p>
<p>So does anybody know of a way to do this using the built in Flask dev server? All tips are welcome!</p>
<p></p></div><p></p>
<div class="post-text">

<p>Using <em>just</em> the features of Flask, you could use a <a href="https://flask.readthedocs.org/en/latest/api/#flask.Flask.before_request" target="_blank" rel="external"><code>before_request()</code> hook</a> testing the <a href="http://werkzeug.pocoo.org/docs/wrappers/#werkzeug.wrappers.BaseRequest.remote_addr" target="_blank" rel="external"><code>request.remote_addr</code> attribute</a>:</p>
<p><pre class="lang:default decode:true">from flask import abort, request</pre></p>
<p>@app.before_request<br>def limit_remote_addr():<br>    if request.remote_addr != ‘10.20.30.40’:<br>        abort(403)  # Forbidden<br>but using a firewall rule on the server is probably the safer and more robust option.</p>
<p>Note that the Remote_Addr can be masked if there is a reverse proxy in between the browser and your server; be careful how you limit this and don’t lock yourself out. If the proxy lives close to the server itself (like a load balancer or front-end cache), you can inspect the <a href="http://werkzeug.pocoo.org/docs/wrappers/#werkzeug.wrappers.BaseRequest.access_route" target="_blank" rel="external"><code>request.access_route</code> list</a> to access the actual IP address. _Do this only if <code>remote_addr</code> itself is a trusted IP address too_:</p>
<p><pre class="lang:default decode:true">trusted_proxies = (‘42.42.42.42’, ‘82.42.82.42’, ‘127.0.0.1’)</pre></p>
<p>def limit_remote_addr():<br>    remote = request.remote_addr<br>    route = list(request.access_route)<br>    while remote in trusted_proxies:<br>        remote = route.pop()</p>
<pre><code>if remote != &apos;10.20.30.40&apos;:
    abort(403)  # Forbidden&lt;/pre&gt;
</code></pre><p></p></div><br>来源： <a href="http://stackoverflow.com/questions/22251038/how-to-limit-flask-dev-server-to-only-one-visiting-ip-address" target="_blank" rel="external">stackoverflow</a><p></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.suzf.net/2016/02/23/How_to_limit_Flask_dev_server_to_only_one_visiting_ip_address/" data-id="ciq4n5jj700cq7xo9rdsyrc4c" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Flask/">Flask</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Shell_正则表达式" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/02/21/Shell_正则表达式/" class="article-date">
  <time datetime="2016-02-21T09:53:41.000Z" itemprop="datePublished">2016-02-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Shell/">Shell</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/21/Shell_正则表达式/">Shell 正则表达式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <div class="title"><br><br>## 正则表达式的分类<br><br>1.  基本的正则表达式（Basic Regular Expression 又叫Basic RegEx 简称BREs）<br>2.  扩展的正则表达式（Extended Regular Expression 又叫Extended RegEx 简称EREs）<br>3.  Perl的正则表达式（Perl Regular Expression 又叫Perl RegEx 简称PREs）<br></div><br><div class="title"><br><br>## 基本组成部分<br><br>正则表达式的基本组成部分。<br><br><a href="http://suzf.net/wp-content/uploads/2016/02/Re_2016-03-12T02-09-32.504Z.png" target="_blank" rel="external"><img src="http://suzf.net/wp-content/uploads/2016/02/Re_2016-03-12T02-09-32.504Z.png" alt="Re_2016-03-12T02-09-32.504Z"></a><br><br>&nbsp;<br><br></div><br><div class="title"><br><br>## POSIX字符类<br><br>POSIX字符类是一个形如[:…:]的特殊元序列（meta sequence），他可以用于匹配特定的字符范围。<br><br><a href="http://suzf.net/wp-content/uploads/2016/02/Re_2016-03-12T02-10-24.294Z.png" target="_blank" rel="external"><img src="http://suzf.net/wp-content/uploads/2016/02/Re_2016-03-12T02-10-24.294Z.png" alt="Re_2016-03-12T02-10-24.294Z"></a><br><br></div><br><div class="title"><br><br>## 元字符<br><br>元字符（meta character）是一种Perl风格的正则表达式，只有一部分文本处理工具支持它，并不是所有的文本处理工具都支持。<br><br><a href="http://suzf.net/wp-content/uploads/2016/02/Re_2016-03-12T02-10-44.117Z.png" target="_blank" rel="external"><img src="http://suzf.net/wp-content/uploads/2016/02/Re_2016-03-12T02-10-44.117Z.png" alt="Re_2016-03-12T02-10-44.117Z"></a><br><br></div><br>&nbsp;<br><div class="title"></div>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.suzf.net/2016/02/21/Shell_正则表达式/" data-id="ciq4n5jgb00ay7xo9u0nniwm5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Re/">Re</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Linux_下_僵尸进程与D进程" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/02/11/Linux_下_僵尸进程与D进程/" class="article-date">
  <time datetime="2016-02-11T09:43:59.000Z" itemprop="datePublished">2016-02-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/11/Linux_下_僵尸进程与D进程/">Linux 下 僵尸进程与D进程</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>————- 1 关于ZOMBIE进程：</p>
<h1 id="ps_-el_7C_grep_Z"><a href="#ps_-el_7C_grep_Z" class="headerlink" title="ps -el| grep Z"></a>ps -el| grep Z</h1><p>F S   UID   PID  PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD<br>0 Z     0  3288  3278  0  80   0 -     0 exit   ?        00:00:00 sh &lt;defunct&gt;<br>0 Z     0  7289  7282  0  80   0 -     0 exit   ?        00:00:00 sh &lt;defunct&gt;<br>0 Z     0  9862  9856  0  80   0 -     0 exit   ?        00:00:00 sh &lt;defunct&gt;</p>
<h1 id="ps_-ef__7Cgrep_defunct"><a href="#ps_-ef__7Cgrep_defunct" class="headerlink" title="ps -ef |grep defunct"></a>ps -ef |grep defunct</h1><p>root      3288  3278  0 Feb19 ?        00:00:00 [sh] &lt;defunct&gt;<br>root      3789  1710  0 17:05 pts/8    00:00:00 grep defunct<br>root      7289  7282  0 07:11 ?        00:00:00 [sh] &lt;defunct&gt;<br>root      9862  9856  0 Feb26 ?        00:00:00 [sh] &lt;defunct&gt;</p>
<p>这些进程已经死亡，但没有释放系统资源，包括内存和一些一些系统表等， 如果这样的进程很多，会引发系统问题。用ps -el看出的进程状态如果是Z，就是僵尸进程。</p>
<p>Z 之所以杀不死，是因为它已经死了，否则怎么叫 Zombie（僵尸）呢？冤魂不散，自然是生前有结未解之故。在UNIX/Linux中，每个进程都有一个父进程，进程号叫PID（Process ID），相应地，父进程号就叫PPID（Parent PID）。当进程死亡时，它会自动关闭已打开的文件，舍弃已占用的内存、交换空间等等系统资源，然后向其父进程返回一个退出状态值，报告死讯。如果程序有 bug，就会在这最后一步出问题。儿子说我死了，老子却没听见，没有及时收棺入殓，儿子便成了僵尸。在UNIX/Linux中消灭僵尸的手段比较残忍，执 行 ps axjf 找出僵尸进程的父进程号（PPID，第一列），先杀其父，然后再由进程天子 init（其PID为1，PPID为0）来一起收拾父子僵尸，超度亡魂，往生极乐。注意，子进程变成僵尸只是碍眼而已，并不碍事，如果僵尸的父进程当前有 要务在身，则千万不可贸然杀之。</p>
<p>清除ZOMBIE（僵尸）进程可以使用如下方法：<br>1&gt; kill –18 PPID （PPID是其父进程）<br>这个信号是告诉父进程，该子进程已经死亡了，请收回分配给他的资源。<br>2&gt;如 果不行则看能否终止其父进程（如果其父进程不需要的话）。先看其父进程又无其他子进程，如果有，可能需要先kill其他子进程，也就是兄弟进程。方法是：<br>kill –15 PID1 PID2(PID1,PID2是僵尸进程的父进程的其它子进程)。<br>然后再kill父进程：kill –15 PPID<br>这 样僵尸进程就可能被完全杀掉了。</p>
<p>ps alx | grep 17191<br>lsof   -p 进程ID<br>pstree -p 进程ID<br>ps     -p 进程ID</p>
<p>详细信息查看：<br>/proc/[PID]/stat</p>
<h1 id="cat_/proc/6873/stat"><a href="#cat_/proc/6873/stat" class="headerlink" title="cat /proc/6873/stat"></a>cat /proc/6873/stat</h1><p>6873 (a.out) R 6723 6873 6723 34819 6873 8388608 77 0 0 0 41958 31 0 0 25 0 3 0 5882654 1409024 56 4294967295 134512640 134513720 3215579040 0 2097798 0 0 0 0 0 0 0 17 0 0 0 [root@localhost ~]#</p>
<p>每个参数意思为：<br>参数 解释<br>pid=6873 进程(包括轻量级进程，即线程)号<br>comm=a.out 应用程序或命令的名字<br>task_state=R 任务的状态，R:runnign, S:sleeping (TASK_INTERRUPTIBLE), D:disk sleep (TASK_UNINTERRUPTIBLE), T: stopped, T:tracing stop,Z:zombie, X:dead<br>ppid=6723 父进程ID<br>pgid=6873 线程组号<br>sid=6723 c该任务所在的会话组ID<br>tty_nr=34819(pts/3) 该任务的tty终端的设备号，INT（34817/256）=主设备号，（34817-主设备号）=次设备号<br>tty_pgrp=6873 终端的进程组号，当前运行在该任务所在终端的前台任务(包括shell 应用程序)的PID。<br>task-&gt;flags=8388608 进程标志位，查看该任务的特性<br>min_flt=77 该任务不需要从硬盘拷数据而发生的缺页（次缺页）的次数<br>cmin_flt=0 累计的该任务的所有的waited-for进程曾经发生的次缺页的次数目<br>maj_flt=0 该任务需要从硬盘拷数据而发生的缺页（主缺页）的次数<br>cmaj_flt=0 累计的该任务的所有的waited-for进程曾经发生的主缺页的次数目<br>utime=1587 该任务在用户态运行的时间，单位为jiffies<br>stime=1 该任务在核心态运行的时间，单位为jiffies<br>cutime=0 累计的该任务的所有的waited-for进程曾经在用户态运行的时间，单位为jiffies<br>cstime=0 累计的该任务的所有的waited-for进程曾经在核心态运行的时间，单位为jiffies<br>priority=25 任务的动态优先级<br>nice=0 任务的静态优先级<br>num_threads=3 该任务所在的线程组里线程的个数<br>it_realvalue=0 由于计时间隔导致的下一个 SIGALRM 发送进程的时延，以 jiffy 为单位.<br>start_time=5882654 该任务启动的时间，单位为jiffies<br>vsize=1409024（page） 该任务的虚拟地址空间大小<br>rss=56(page) 该任务当前驻留物理地址空间的大小<br>Number of pages the process has in real memory,minu 3 for administrative purpose.<br>这些页可能用于代码，数据和栈。<br>rlim=4294967295（bytes） 该任务能驻留物理地址空间的最大值<br>start_code=134512640 该任务在虚拟地址空间的代码段的起始地址<br>end_code=134513720 该任务在虚拟地址空间的代码段的结束地址<br>start_stack=3215579040 该任务在虚拟地址空间的栈的结束地址<br>kstkesp=0 esp(32 位堆栈指针) 的当前值, 与在进程的内核堆栈页得到的一致.<br>kstkeip=2097798 指向将要执行的指令的指针, EIP(32 位指令指针)的当前值.<br>pendingsig=0 待处理信号的位图，记录发送给进程的普通信号<br>block_sig=0 阻塞信号的位图<br>sigign=0 忽略的信号的位图<br>sigcatch=082985 被俘获的信号的位图<br>wchan=0 如果该进程是睡眠状态，该值给出调度的调用点<br>nswap 被swapped的页数，当前没用<br>cnswap 所有子进程被swapped的页数的和，当前没用<br>exit_signal=17 该进程结束时，向父进程所发送的信号<br>task_cpu(task)=0 运行在哪个CPU上<br>task_rt_priority=0 实时进程的相对优先级别<br>task_policy=0 进程的调度策略，0=非实时进程，1=FIFO实时进程；2=RR实时进程</p>
<p>这类进程是有问题的. 需要回收资源.<br>在unix程序设计的一本书里印像有一种情况会出现这样的进程.<br>主程序fork出的子进程结束之后. 父进程没有释放子进程所占用的资源. 这时这个进程就一直是zombie状态.</p>
<p>—- 百科：<br>ZOMBIE：僵尸状态，表示进程结束但尚未消亡的一种状态，此时进程已经结束运行并释放大部分资源，但尚未释放进程控制块。<br>与ZOMBIE对应的进程状态还有RUNNING（正在运行或等待运行状态），UNINTERRUPTABLE（不可中断阻塞状态），INTERRUPTABLE（可中断阻塞状态），STOPPED（挂起状态）。</p>
<p>服务器通常都会带来一些僵尸进程，占用系统资源，浪费资源等，一般我们使用top命令就可以看得出来，如图：<br>（可以看到，我的服务器已经产生了两个僵尸进程）</p>
<p>解决方法：</p>
<p>#ps -A -o stat,ppid,pid,cmd |grep -e “^[Zz]”　　　　//先查看具体进程：</p>
<p>#lsof -p ppid;</p>
<p>#lsof -p pid;</p>
<p>#kill -9 pid号　　　　　　　　　//杀死z进程（这些动作是比较危险的，希望在真正的服务器上面慎用！！！）</p>
<p>假若你的z进程比较多，可以编写个小小的脚本，下面是参与网上的</p>
<p>#ps -A -o stat,ppid,pid,cmd | grep -e ‘^[Zz]’ | awk ‘{print $2}’ | xargs kill</p>
<p>首先，我们可以用top命令来查看服务器当前是否有僵尸进程，可以看到第二行行尾有个 0 zombie，如果数字大于0，那么意味着服务器当前存在有僵尸进程  可以用ps和grep命令寻找僵尸进程</p>
<p>ps -A -ostat,ppid,pid,cmd | grep -e ‘^[Zz]’</p>
<p>命令选项说明:</p>
<p>-A 参数列出所有进程<br>-o 自定义输出字段 我们设定显示字段为 stat（状态）, ppid（进程父id）, pid(进程id)，cmd（命令）这四个参数<br>因为状态为 z或者Z的进程为僵尸进程，所以我们使用grep抓取stat状态为zZ进程</p>
<p>运行结果参考如下<br>Z 12334 12339 /path/cmd<br>这时，我们可以使用 kill -HUP 12339来杀掉这个僵尸进程<br>运行后，可以再次运行ps -A -ostat,ppid,pid,cmd | grep -e ‘^[Zz]’来确认是否将僵尸进程杀死<br>如果kill 子进程的无效，可以尝试kill 其父进程来解决问题，例如上面例子父进程pid是 12334，那么我们就运行<br>kill -HUP 12334来解决问题</p>
<hr>
<p>1) 检查当前僵尸进程信息</p>
<h1 id="ps_-ef__7C_grep_defunct__7C_grep_-v_grep__7C_wc_-l"><a href="#ps_-ef__7C_grep_defunct__7C_grep_-v_grep__7C_wc_-l" class="headerlink" title="ps -ef | grep defunct | grep -v grep | wc -l"></a>ps -ef | grep defunct | grep -v grep | wc -l</h1><p>175</p>
<h1 id="top__7C_head_-2"><a href="#top__7C_head_-2" class="headerlink" title="top | head -2"></a>top | head -2</h1><p>top - 15:05:54 up 97 days, 23:49, 4 users, load average: 0.66, 0.45, 0.39</p>
<p>Tasks: 829 total, 1 running, 479 sleeping, 174 stopped, 175 zombie</p>
<h1 id="ps_-ef__7C_grep_defunct__7C_grep_-v_grep"><a href="#ps_-ef__7C_grep_defunct__7C_grep_-v_grep" class="headerlink" title="ps -ef | grep defunct | grep -v grep"></a>ps -ef | grep defunct | grep -v grep</h1><p>2) 获得杀僵尸进程语句</p>
<h1 id="ps_-ef__7C_grep_defunct__7C_grep_-v_grep__7C_awk__u2018_7Bprint__u201Ckill_-9__u201C__242_2C_243_7D_u2019"><a href="#ps_-ef__7C_grep_defunct__7C_grep_-v_grep__7C_awk__u2018_7Bprint__u201Ckill_-9__u201C__242_2C_243_7D_u2019" class="headerlink" title="ps -ef | grep defunct | grep -v grep | awk ‘{print “kill -9 “ $2,$3}’"></a>ps -ef | grep defunct | grep -v grep | awk ‘{print “kill -9 “ $2,$3}’</h1><p>执行上面获得的语句即可, 使用信号量9, 僵尸进程数会大大减少.</p>
<p>3) 过一会儿检查当前僵尸进程信息</p>
<h1 id="ps_-ef__7C_grep_defunct__7C_grep_-v_grep__7C_wc_-l-1"><a href="#ps_-ef__7C_grep_defunct__7C_grep_-v_grep__7C_wc_-l-1" class="headerlink" title="ps -ef | grep defunct | grep -v grep | wc -l"></a>ps -ef | grep defunct | grep -v grep | wc -l</h1><p>125</p>
<h1 id="top__7C_head_-2-1"><a href="#top__7C_head_-2-1" class="headerlink" title="top | head -2"></a>top | head -2</h1><p>top - 15:29:26 up 98 days, 12 min, 7 users, load average: 0.27, 0.54, 0.56</p>
<p>Tasks: 632 total, 1 running, 381 sleeping, 125 stopped, 125 zombie</p>
<p>发现僵尸进程数减少了一些, 但还有不少啊.</p>
<p>4) 再次获得杀僵尸进程语句</p>
<h1 id="ps_-ef__7C_grep_defunct__7C_grep_-v_grep__7C_awk__u2018_7Bprint__u201Ckill_-18__u201C__243_7D_u2019"><a href="#ps_-ef__7C_grep_defunct__7C_grep_-v_grep__7C_awk__u2018_7Bprint__u201Ckill_-18__u201C__243_7D_u2019" class="headerlink" title="ps -ef | grep defunct | grep -v grep | awk ‘{print “kill -18 “ $3}’"></a>ps -ef | grep defunct | grep -v grep | awk ‘{print “kill -18 “ $3}’</h1><p>执行上面获得的语句即可, 这次使用信号量18杀其父进程, 僵尸进程应该会全部消失.</p>
<p>5) 过一会儿再检查当前僵尸进程信息</p>
<h1 id="ps_-ef__7C_grep_defunct__7C_grep_-v_grep__7C_wc_-l-2"><a href="#ps_-ef__7C_grep_defunct__7C_grep_-v_grep__7C_wc_-l-2" class="headerlink" title="ps -ef | grep defunct | grep -v grep | wc -l"></a>ps -ef | grep defunct | grep -v grep | wc -l</h1><p>0</p>
<h1 id="top__7C_head_-2-2"><a href="#top__7C_head_-2-2" class="headerlink" title="top | head -2"></a>top | head -2</h1><p>top - 15:39:46 up 98 days, 23 min, 7 users, load average: 5.46, 2.20, 1.12</p>
<p>Tasks: 134 total, 1 running, 133 sleeping, 0 stopped, 0 zombie</p>
<p>6) 清除ZOMBIE(僵尸)进程原理</p>
<h1 id="kill_-18_PPID"><a href="#kill_-18_PPID" class="headerlink" title="kill -18 PPID"></a>kill -18 PPID</h1><p>PPID是其父进程, 这个信号是告诉父进程, 该子进程已经死亡了, 请收回分配给他的资源. 如果还不行则看先看其父进程又无其他子进程, 如果有, 可能需要先kill其他子进程, 也就是兄弟进程.</p>
<p>方法是:</p>
<h1 id="kill_-15_PID1_PID2"><a href="#kill_-15_PID1_PID2" class="headerlink" title="kill -15 PID1 PID2"></a>kill -15 PID1 PID2</h1><p>PID1,PID2是僵尸进程的父进程的其它子进程.</p>
<p>然后再kill父进程:</p>
<h1 id="kill_-15_PPID"><a href="#kill_-15_PPID" class="headerlink" title="kill -15 PPID"></a>kill -15 PPID</h1><p>=======================2  Linux进程的Uninterruptible sleep(D)状态</p>
<p>D，往往是由于 I/O 资源得不到满足，而引发等待，在内核源码 fs/proc/array.c 里，其文字定义为“ “D (disk sleep)”, /<em> 2 </em>/ ”（由此可知 D 原是Disk的打头字母），对应着 include/linux/sched.h 里的“ #define TASK_UNINTERRUPTIBLE 2 ”。举个例子，当 NFS 服务端关闭之时，若未事先 umount 相关目录，在 NFS 客户端执行 df 就会挂住整个登录会话，按 Ctrl+C 、Ctrl+Z 都无济于事。断开连接再登录，执行 ps axf 则看到刚才的 df 进程状态位已变成了 D ，kill -9 无法杀灭。正确的处理方式，是马上恢复 NFS 服务端，再度提供服务，刚才挂起的 df 进程发现了其苦苦等待的资源，便完成任务，自动消亡。若 NFS 服务端无法恢复服务，在 reboot 之前也应将 /etc/mtab 里的相关 NFS mount 项删除，以免 reboot 过程例行调用 netfs stop 时再次发生等待资源，导致系统重启过程挂起。<br><img src="http://dl.iteye.com/upload/attachment/0079/8447/5f87764c-da7a-30bb-ac9e-5ad7c651c0b5.jpg" alt="" title="点击查看原始大小图片"></p>
<p>运行在KVM虚拟机里的一些进程突然出了问题，这些出了问题的进程无法用kill杀掉，使用ps可以看到这些进程处于D状 态：</p>
<h1 id="ps_-a_-ubuild_-o_pid_2Cppid_2Cstat_2Ccommand"><a href="#ps_-a_-ubuild_-o_pid_2Cppid_2Cstat_2Ccommand" class="headerlink" title="ps -a -ubuild -o pid,ppid,stat,command"></a>ps -a -ubuild -o pid,ppid,stat,command</h1><p>PID  PPID STAT COMMAND</p>
<p>17009     1 Ds   -bash</p>
<p>17065     1 D    ls –color=tty -al</p>
<p>17577     1 D    /usr/java/jdk1.5.0_17/bin/java -Xmx512m -classpath /usr/local/a</p>
<p>17629     1 D    /usr/java/jdk1.5.0_17/bin/java -Xmx512m -classpath /usr/local/a</p>
<p>ps 的手册里说D状态是uninterruptible sleep，Linux进程有两种睡眠状态，一种interruptible sleep，处在这种睡眠状态的进程是可以通过给它发信号来唤醒的，比如发HUP信号给nginx的master进程可以让nginx重新加载配置文件而 不需要重新启动nginx进程；另外一种睡眠状态是uninterruptible sleep，处在这种状态的进程不接受外来的任何信号，这也是为什么之前我无法用kill杀掉这些处于D状态的进程，无论是”kill”, “kill -9″还是”kill -15″，因为它们压根儿就不受这些信号的支配。</p>
<p>进程为什么会被置于uninterruptible sleep状态呢？处于uninterruptible sleep状态的进程通常是在等待IO，比如磁盘IO，网络IO，其他外设IO，如果进程正在等待的IO在较长的时间内都没有响应，那么就很会不幸地被 ps看到了，同时也就意味着很有可能有IO出了问题，可能是外设本身出了故障，也可能是比如挂载的远程文件系统已经不可访问了，我这里遇到的问题就是由 down掉的NFS服务器引起的。</p>
<p>正是因为得不到IO的相应，进程才进入了uninterruptible sleep状态，所以要想使进程从uninterruptible sleep状态恢复，就得使进程等待的IO恢复，比如如果是因为从远程挂载的NFS卷不可访问导致进程进入uninterruptible sleep状态的，那么可以通过恢复该NFS卷的连接来使进程的IO请求得到满足，除此之外，要想干掉处在D状态进程就只能重启整个Linux系统了。</p>
<p>看到有人说如果要想杀掉D状态的进程，通常可以去杀掉它的父进程（通常是shell，我理解的这种情况是在shell下直接运行的该进程，之后该进 程转入了D状态），于是我就照做了，之后就出现了上面的状态：他们的父进程被杀掉了，但是他们的父进程PID都变成了1，也就是init进程，这下可如何是好？此时我这些D状态的进程已经影响到其他一些进程的运行，而已经无法访问的NFS卷又在段时间内无法恢复，那么，只好重新启动了，root不是玉皇大 帝，也有无奈的时候。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.suzf.net/2016/02/11/Linux_下_僵尸进程与D进程/" data-id="ciq4n5jih00ce7xo9y12ulwqs" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
    </nav>
  
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Apache/">Apache</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Auto-ops/">Auto ops</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/CouchBase/">CouchBase</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/HA/">HA</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hadoop/">Hadoop</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hardware/">Hardware</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Highcharts/">Highcharts</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/LVS/">LVS</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Life/">Life</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">28</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MongoDB/">MongoDB</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mysql/">Mysql</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Oracle/">Oracle</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Puppet/">Puppet</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">23</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Redis/">Redis</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Shell/">Shell</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tomcat/">Tomcat</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Zabbix/">Zabbix</a><span class="category-list-count">13</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Apache/">Apache</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CMD/">CMD</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ceph/">Ceph</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Debian/">Debian</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ELK/">ELK</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Exsi/">Exsi</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flask/">Flask</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GTID/">GTID</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kernel/">Kernel</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kickstart/">Kickstart</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LB/">LB</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LVS/">LVS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Life/">Life</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lnmp/">Lnmp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Log/">Log</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MongoDB/">MongoDB</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mysql/">Mysql</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NoSQL/">NoSQL</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Oracle/">Oracle</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/">PHP</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Proxy/">Proxy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Puppet/">Puppet</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a><span class="tag-list-count">23</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RAC/">RAC</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Re/">Re</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ZK/">ZK</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zabbix/">Zabbix</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bug/">bug</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/code/">code</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/coredump/">coredump</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/couchbase/">couchbase</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/debug/">debug</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/diy/">diy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elasticsearch/">elasticsearch</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/expect/">expect</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/facter/">facter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/faq/">faq</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hadoop/">hadoop</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/highcharts/">highcharts</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/idrac/">idrac</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iso/">iso</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka/">kafka</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lvm/">lvm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pip/">pip</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/">redis</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rewrite/">rewrite</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rsync/">rsync</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rsyslog/">rsyslog</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/snmp/">snmp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/strace/">strace</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sudo/">sudo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tcpdump/">tcpdump</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tomcat/">tomcat</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/">web</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wiki/">wiki</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zookeeper/">zookeeper</a><span class="tag-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Apache/" style="font-size: 10px;">Apache</a> <a href="/tags/CMD/" style="font-size: 10px;">CMD</a> <a href="/tags/Ceph/" style="font-size: 10.91px;">Ceph</a> <a href="/tags/Debian/" style="font-size: 10px;">Debian</a> <a href="/tags/ELK/" style="font-size: 10px;">ELK</a> <a href="/tags/Exsi/" style="font-size: 10px;">Exsi</a> <a href="/tags/Flask/" style="font-size: 10px;">Flask</a> <a href="/tags/GTID/" style="font-size: 10.91px;">GTID</a> <a href="/tags/Kernel/" style="font-size: 10.91px;">Kernel</a> <a href="/tags/Kickstart/" style="font-size: 10px;">Kickstart</a> <a href="/tags/LB/" style="font-size: 10px;">LB</a> <a href="/tags/LVS/" style="font-size: 10px;">LVS</a> <a href="/tags/Life/" style="font-size: 10px;">Life</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/Lnmp/" style="font-size: 10px;">Lnmp</a> <a href="/tags/Log/" style="font-size: 10px;">Log</a> <a href="/tags/MongoDB/" style="font-size: 11.82px;">MongoDB</a> <a href="/tags/Mysql/" style="font-size: 19.09px;">Mysql</a> <a href="/tags/Nginx/" style="font-size: 16.36px;">Nginx</a> <a href="/tags/NoSQL/" style="font-size: 12.73px;">NoSQL</a> <a href="/tags/Oracle/" style="font-size: 11.82px;">Oracle</a> <a href="/tags/PHP/" style="font-size: 10.91px;">PHP</a> <a href="/tags/Proxy/" style="font-size: 10px;">Proxy</a> <a href="/tags/Puppet/" style="font-size: 14.55px;">Puppet</a> <a href="/tags/Python/" style="font-size: 20px;">Python</a> <a href="/tags/RAC/" style="font-size: 10.91px;">RAC</a> <a href="/tags/Re/" style="font-size: 11.82px;">Re</a> <a href="/tags/ZK/" style="font-size: 10px;">ZK</a> <a href="/tags/Zabbix/" style="font-size: 18.18px;">Zabbix</a> <a href="/tags/bug/" style="font-size: 10px;">bug</a> <a href="/tags/code/" style="font-size: 10px;">code</a> <a href="/tags/coredump/" style="font-size: 10px;">coredump</a> <a href="/tags/couchbase/" style="font-size: 10px;">couchbase</a> <a href="/tags/debug/" style="font-size: 10px;">debug</a> <a href="/tags/diy/" style="font-size: 10px;">diy</a> <a href="/tags/elasticsearch/" style="font-size: 10px;">elasticsearch</a> <a href="/tags/expect/" style="font-size: 10px;">expect</a> <a href="/tags/facter/" style="font-size: 10px;">facter</a> <a href="/tags/faq/" style="font-size: 17.27px;">faq</a> <a href="/tags/hadoop/" style="font-size: 10px;">hadoop</a> <a href="/tags/highcharts/" style="font-size: 10px;">highcharts</a> <a href="/tags/idrac/" style="font-size: 10px;">idrac</a> <a href="/tags/iso/" style="font-size: 10px;">iso</a> <a href="/tags/kafka/" style="font-size: 10px;">kafka</a> <a href="/tags/lvm/" style="font-size: 10px;">lvm</a> <a href="/tags/pip/" style="font-size: 12.73px;">pip</a> <a href="/tags/redis/" style="font-size: 15.45px;">redis</a> <a href="/tags/rewrite/" style="font-size: 10px;">rewrite</a> <a href="/tags/rsync/" style="font-size: 10px;">rsync</a> <a href="/tags/rsyslog/" style="font-size: 10px;">rsyslog</a> <a href="/tags/snmp/" style="font-size: 10px;">snmp</a> <a href="/tags/strace/" style="font-size: 10px;">strace</a> <a href="/tags/sudo/" style="font-size: 10px;">sudo</a> <a href="/tags/tcpdump/" style="font-size: 10px;">tcpdump</a> <a href="/tags/tomcat/" style="font-size: 13.64px;">tomcat</a> <a href="/tags/vim/" style="font-size: 10.91px;">vim</a> <a href="/tags/web/" style="font-size: 12.73px;">web</a> <a href="/tags/wiki/" style="font-size: 10px;">wiki</a> <a href="/tags/zookeeper/" style="font-size: 12.73px;">zookeeper</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/05/12/839/">Linux 下使用 strace 诊断疑难杂症</a>
          </li>
        
          <li>
            <a href="/2016/04/27/MySQL_mysqldump_数据导出详解/">MySQL mysqldump 数据导出详解</a>
          </li>
        
          <li>
            <a href="/2016/04/24/Python_Re_module_learn/">Python Re module learn</a>
          </li>
        
          <li>
            <a href="/2016/04/22/Python正则表达式操作指南/">Python正则表达式操作指南</a>
          </li>
        
          <li>
            <a href="/2016/04/18/Hello_Kafka/">Hello Kafka</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Jeffrey Su<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>