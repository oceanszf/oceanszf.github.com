
 <!DOCTYPE HTML>
<html lang="default">
<head>
  <meta charset="UTF-8">
  
    <title>How-to setup gtid on replication | Suzf Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="Jeffrey Su">
    
    <meta name="description" content="准备工作Mysql 单机多实例详解What is the GTID of the replication
实验环境Os: CentOS 6.XMysql: 5.6 单机多实例 [3306,3307]Hostname: lab.suzf.net
场景一：新机器 无数据##### 
对于GTID的配置，主要修改配置文件中与GTID特性相关的几个重要参数">
    
    
    
    
    <link rel="alternate" href="/atom.xml" title="Suzf Blog" type="application/atom+xml">
    
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
    
    <link rel="icon" href="/img/favicon.ico">
    <a href="https://github.com/oceanszf" target="_blank"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>

</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Suzf Blog" title="Suzf Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Suzf Blog">Suzf Blog</a></h1>
				<h2 class="blog-motto">Life is short, We need smile.</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					

                        <li><a href="http://blog.suzf.net/atom.xml">Rss</a></li>
                        <li><a title="Let's High!!!" href='javascript:(function() {
	function c() {
		var e = document.createElement("link");
		e.setAttribute("type", "text/css");
		e.setAttribute("rel", "stylesheet");
		e.setAttribute("href", f);
		e.setAttribute("class", l);
		document.body.appendChild(e)
	}
 
	function h() {
		var e = document.getElementsByClassName(l);
		for (var t = 0; t < e.length; t++) {
			document.body.removeChild(e[t])
		}
	}
 
	function p() {
		var e = document.createElement("div");
		e.setAttribute("class", a);
		document.body.appendChild(e);
		setTimeout(function() {
			document.body.removeChild(e)
		}, 100)
	}
 
	function d(e) {
		return {
			height : e.offsetHeight,
			width : e.offsetWidth
		}
	}
 
	function v(i) {
		var s = d(i);
		return s.height > e && s.height < n && s.width > t && s.width < r
	}
 
	function m(e) {
		var t = e;
		var n = 0;
		while (!!t) {
			n += t.offsetTop;
			t = t.offsetParent
		}
		return n
	}
 
	function g() {
		var e = document.documentElement;
		if (!!window.innerWidth) {
			return window.innerHeight
		} else if (e && !isNaN(e.clientHeight)) {
			return e.clientHeight
		}
		return 0
	}
 
	function y() {
		if (window.pageYOffset) {
			return window.pageYOffset
		}
		return Math.max(document.documentElement.scrollTop, document.body.scrollTop)
	}
 
	function E(e) {
		var t = m(e);
		return t >= w && t <= b + w
	}
 
	function S() {
		var e = document.createElement("audio");
		e.setAttribute("class", l);
		e.src = i;
		e.loop = false;
		e.addEventListener("canplay", function() {
			setTimeout(function() {
				x(k)
			}, 500);
			setTimeout(function() {
				N();
				p();
				for (var e = 0; e < O.length; e++) {
					T(O[e])
				}
			}, 15500)
		}, true);
		e.addEventListener("ended", function() {
			N();
			h()
		}, true);
		e.innerHTML = " <p>If you are reading this, it is because your browser does not support the audio element. We recommend that you get a new browser.</p> <p>";
		document.body.appendChild(e);
		e.play()
	}
 
	function x(e) {
		e.className += " " + s + " " + o
	}
 
	function T(e) {
		e.className += " " + s + " " + u[Math.floor(Math.random() * u.length)]
	}
 
	function N() {
		var e = document.getElementsByClassName(s);
		var t = new RegExp("\\b" + s + "\\b");
		for (var n = 0; n < e.length; ) {
			e[n].className = e[n].className.replace(t, "")
		}
	}
 
	var e = 30;
	var t = 30;
	var n = 350;
	var r = 350;
	var i = "//s3.amazonaws.com/moovweb-marketing/playground/harlem-shake.mp3";
	var s = "mw-harlem_shake_me";
	var o = "im_first";
	var u = ["im_drunk", "im_baked", "im_trippin", "im_blown"];
	var a = "mw-strobe_light";
	var f = "//s3.amazonaws.com/moovweb-marketing/playground/harlem-shake-style.css";
	var l = "mw_added_css";
	var b = g();
	var w = y();
	var C = document.getElementsByTagName("*");
	var k = null;
	for (var L = 0; L < C.length; L++) {
		var A = C[L];
		if (v(A)) {
			if (E(A)) {
				k = A;
				break
			}
		}
	}
	if (A === null) {
		console.warn("Could not find a node of the right size. Please try a different page.");
		return
	}
	c();
	S();
	var O = [];
	for (var L = 0; L < C.length; L++) {
		var A = C[L];
		if (v(A)) {
			O.push(A)
		}
	}
})()    '>High一下</a> </li>

                    <li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:blog.suzf.net">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/04/01/How-to_setup_gtid_on_replication/" title="How-to setup gtid on replication" itemprop="url">How-to setup gtid on replication</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://blog.suzf.net" title="Jeffrey Su">Jeffrey Su</a>
    </p>
  <p class="article-time">
    <time datetime="2016-04-01T06:41:02.000Z" itemprop="datePublished">2016-04-01</time>
    Updated:<time datetime="2016-04-29T12:43:02.000Z" itemprop="dateModified">2016-04-29</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#u51C6_u5907_u5DE5_u4F5C"><span class="toc-number">1.</span> <span class="toc-text">准备工作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u5B9E_u9A8C_u73AF_u5883"><span class="toc-number">2.</span> <span class="toc-text">实验环境</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#u573A_u666F_u4E00_uFF1A_u65B0_u673A_u5668__u65E0_u6570_u636E"><span class="toc-number">2.0.1.</span> <span class="toc-text">场景一：新机器 无数据</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#master"><span class="toc-number"></span> <span class="toc-text">master</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#set_for_GTID_Replication"><span class="toc-number"></span> <span class="toc-text">set for GTID Replication</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#binlog"><span class="toc-number"></span> <span class="toc-text">binlog</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#rely_log"><span class="toc-number"></span> <span class="toc-text">rely log</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#slave"><span class="toc-number"></span> <span class="toc-text">slave</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#set_for_GTID_Replication-1"><span class="toc-number"></span> <span class="toc-text">set for GTID Replication</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#bin_log"><span class="toc-number"></span> <span class="toc-text">bin log</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#rely_log-1"><span class="toc-number"></span> <span class="toc-text">rely log</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#A_simple_startup_script_for_mysqld_multi_by_Tim_Smith_and_Jani_Tolonen"><span class="toc-number"></span> <span class="toc-text">A simple startup script for mysqld_multi by Tim Smith and Jani Tolonen.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#This_script_assumes_that_my-cnf_file_exists_either_in_/etc/my-cnf_or"><span class="toc-number"></span> <span class="toc-text">This script assumes that my.cnf file exists either in /etc/my.cnf or</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#/root/-my-cnf_and_has_groups__5Bmysqld_multi_5D_and__5BmysqldN_5D-_See_the"><span class="toc-number"></span> <span class="toc-text">/root/.my.cnf and has groups [mysqld_multi] and [mysqldN]. See the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mysqld_multi_documentation_for_detailed_instructions"><span class="toc-number"></span> <span class="toc-text">mysqld_multi documentation for detailed instructions.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#This_script_can_be_used_as_/etc/init-d/mysql-server"><span class="toc-number"></span> <span class="toc-text">This script can be used as /etc/init.d/mysql.server</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Comments_to_support_chkconfig_on_RedHat_Linux"><span class="toc-number"></span> <span class="toc-text">Comments to support chkconfig on RedHat Linux</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#chkconfig_3A_2345_64_36"><span class="toc-number"></span> <span class="toc-text">chkconfig: 2345 64 36</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#description_3A_A_very_fast_and_reliable_SQL_database_engine"><span class="toc-number"></span> <span class="toc-text">description: A very fast and reliable SQL database engine.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Version_1-0"><span class="toc-number"></span> <span class="toc-text">Version 1.0</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#u573A_u666F_u4E8C_uFF1A_u79FB_u9664_Replication"><span class="toc-number">0.0.1.</span> <span class="toc-text">场景二：移除  Replication</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#u573A_u666F_u4E09_uFF1A_u62F7_u8D1D_u6570_u636E__u65B0_u5EFA_GTID_slave"><span class="toc-number">0.0.2.</span> <span class="toc-text">场景三：拷贝数据 新建 GTID slave</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Using_mysqldump"><span class="toc-number">0.1.</span> <span class="toc-text">Using mysqldump</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Using_XtraBackup"><span class="toc-number">0.2.</span> <span class="toc-text">Using XtraBackup</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#set_for_GTID_Replication-2"><span class="toc-number"></span> <span class="toc-text">set for GTID Replication</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#binlog-1"><span class="toc-number"></span> <span class="toc-text">binlog</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#rely_log-2"><span class="toc-number"></span> <span class="toc-text">rely log</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#set_for_GTID_Replication-3"><span class="toc-number"></span> <span class="toc-text">set for GTID Replication</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#bin_log-1"><span class="toc-number"></span> <span class="toc-text">bin log</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#rely_log-3"><span class="toc-number"></span> <span class="toc-text">rely log</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u51FA_u73B0_u4E0A_u9762_u4E2A_u9519_u8BEF__u6267_u884C_u4E0B_u9762_u64CD_u4F5C"><span class="toc-number"></span> <span class="toc-text">出现上面个错误 执行下面操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#u573A_u666F_u56DB_uFF1A_u7ECF_u5178_u590D_u5236__u2013_26gt_3B_GTID_Replication"><span class="toc-number">0.0.1.</span> <span class="toc-text">场景四：经典复制 –> GTID Replication</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FAQ"><span class="toc-number">1.</span> <span class="toc-text">FAQ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Skip_counter_with_GTID"><span class="toc-number">2.</span> <span class="toc-text">Skip counter with GTID</span></a></li></ol>
		</div>
		
		<h3 id="u51C6_u5907_u5DE5_u4F5C"><a href="#u51C6_u5907_u5DE5_u4F5C" class="headerlink" title="准备工作"></a>准备工作</h3><p><a href="http://suzf.net/thread-1202-555.html" target="_blank" rel="external">Mysql 单机多实例详解</a><br><a href="http://suzf.net/thread-0401-693.html" target="_blank" rel="external">What is the GTID of the replication</a></p>
<h3 id="u5B9E_u9A8C_u73AF_u5883"><a href="#u5B9E_u9A8C_u73AF_u5883" class="headerlink" title="实验环境"></a>实验环境</h3><p>Os: CentOS 6.X<br>Mysql: 5.6 单机多实例 [3306,3307]<br>Hostname: lab.suzf.net</p>
<h5 id="u573A_u666F_u4E00_uFF1A_u65B0_u673A_u5668__u65E0_u6570_u636E"><a href="#u573A_u666F_u4E00_uFF1A_u65B0_u673A_u5668__u65E0_u6570_u636E" class="headerlink" title="场景一：新机器 无数据"></a>场景一：新机器 无数据</h5><p>##### </p>
<p>对于GTID的配置，主要修改配置文件中与GTID特性相关的几个重要参数<a id="more"></a></p>
<p><pre class="lang:default decode:true ">[mysqld_multi]<br>mysqld = /usr/local/mysql/bin/mysqld_safe<br>mysqladmin = /usr/local/mysql/bin/mysqladmin<br>log = /usr/local/mysql/data/log/mysqld_multi.log<br>user = root ## Used for stopping the server via mysqladmin</pre></p>
<h1 id="master"><a href="#master" class="headerlink" title="master"></a>master</h1><p>[mysqld3306]<br>socket = /usr/local/mysql/data/run/mysqld_3306.sock<br>port = 3306<br>pid-file = /usr/local/mysql/data/run/mysqld_3306.pid<br>datadir = /usr/local/mysql/data/mysql_3306</p>
<h1 id="set_for_GTID_Replication"><a href="#set_for_GTID_Replication" class="headerlink" title="set for GTID Replication"></a>set for GTID Replication</h1><p>server_id = 3232237894<br>gtid_mode = on<br>enforce_gtid_consistency = on  #强制gtid一致性，开启后对于特定create table不被支持</p>
<h1 id="binlog"><a href="#binlog" class="headerlink" title="binlog"></a>binlog</h1><p>log-bin = /usr/local/mysql/data/binlogs/master-binlog<br>log-slave-updates = 1<br>binlog_format = row            #强烈建议，其他格式可能造成数据不一致</p>
<h1 id="rely_log"><a href="#rely_log" class="headerlink" title="rely log"></a>rely log</h1><p>skip_slave_start=1</p>
<h1 id="slave"><a href="#slave" class="headerlink" title="slave"></a>slave</h1><p>[mysqld3307]<br>socket = /usr/local/mysql/data/run/mysqld_3307.sock<br>port = 3307<br>pid-file = /usr/local/mysql/data/run/mysqld_3307.pid<br>datadir = /usr/local/mysql/data/mysql_3307</p>
<h1 id="set_for_GTID_Replication-1"><a href="#set_for_GTID_Replication-1" class="headerlink" title="set for GTID Replication"></a>set for GTID Replication</h1><p>server_id = 3232237866<br>gtid_mode = on<br>enforce_gtid_consistency = on</p>
<h1 id="bin_log"><a href="#bin_log" class="headerlink" title="bin log"></a>bin log</h1><p>log-bin = /usr/local/mysql/data/binlogs/slave-binlog<br>log-slave-updates = 1<br>binlog_format = row</p>
<h1 id="rely_log-1"><a href="#rely_log-1" class="headerlink" title="rely log"></a>rely log</h1><p>skip_slave_start=1</p>
<p>[client]<br>default-character-set = utf8<br><strong>重启mysql</strong><br>/etc/init.d/mysqld_multi.server restart</p>
<p><strong>Mysql 多实例启动脚本</strong></p>
<p><pre class="lang:default decode:true ">cat /etc/init.d/mysqld_multi.server</pre></p>
<p>#!/bin/sh<br>#</p>
<h1 id="A_simple_startup_script_for_mysqld_multi_by_Tim_Smith_and_Jani_Tolonen"><a href="#A_simple_startup_script_for_mysqld_multi_by_Tim_Smith_and_Jani_Tolonen" class="headerlink" title="A simple startup script for mysqld_multi by Tim Smith and Jani Tolonen."></a>A simple startup script for mysqld_multi by Tim Smith and Jani Tolonen.</h1><h1 id="This_script_assumes_that_my-cnf_file_exists_either_in_/etc/my-cnf_or"><a href="#This_script_assumes_that_my-cnf_file_exists_either_in_/etc/my-cnf_or" class="headerlink" title="This script assumes that my.cnf file exists either in /etc/my.cnf or"></a>This script assumes that my.cnf file exists either in /etc/my.cnf or</h1><h1 id="/root/-my-cnf_and_has_groups__5Bmysqld_multi_5D_and__5BmysqldN_5D-_See_the"><a href="#/root/-my-cnf_and_has_groups__5Bmysqld_multi_5D_and__5BmysqldN_5D-_See_the" class="headerlink" title="/root/.my.cnf and has groups [mysqld_multi] and [mysqldN]. See the"></a>/root/.my.cnf and has groups [mysqld_multi] and [mysqldN]. See the</h1><h1 id="mysqld_multi_documentation_for_detailed_instructions"><a href="#mysqld_multi_documentation_for_detailed_instructions" class="headerlink" title="mysqld_multi documentation for detailed instructions."></a>mysqld_multi documentation for detailed instructions.</h1><p>#</p>
<h1 id="This_script_can_be_used_as_/etc/init-d/mysql-server"><a href="#This_script_can_be_used_as_/etc/init-d/mysql-server" class="headerlink" title="This script can be used as /etc/init.d/mysql.server"></a>This script can be used as /etc/init.d/mysql.server</h1><p>#</p>
<h1 id="Comments_to_support_chkconfig_on_RedHat_Linux"><a href="#Comments_to_support_chkconfig_on_RedHat_Linux" class="headerlink" title="Comments to support chkconfig on RedHat Linux"></a>Comments to support chkconfig on RedHat Linux</h1><h1 id="chkconfig_3A_2345_64_36"><a href="#chkconfig_3A_2345_64_36" class="headerlink" title="chkconfig: 2345 64 36"></a>chkconfig: 2345 64 36</h1><h1 id="description_3A_A_very_fast_and_reliable_SQL_database_engine"><a href="#description_3A_A_very_fast_and_reliable_SQL_database_engine" class="headerlink" title="description: A very fast and reliable SQL database engine."></a>description: A very fast and reliable SQL database engine.</h1><p>#</p>
<h1 id="Version_1-0"><a href="#Version_1-0" class="headerlink" title="Version 1.0"></a>Version 1.0</h1><p>#</p>
<p>basedir=/usr/local/mysql<br>bindir=/usr/local/mysql/bin</p>
<p>conf=$basedir/data/etc/my.cnf<br>export PATH=$PATH:$bindir</p>
<p>if test -x $bindir/mysqld_multi<br>then<br>  mysqld_multi=”$bindir/mysqld_multi”;<br>else<br>  echo “Can’t execute $bindir/mysqld_multi from dir $basedir”;<br>  exit;<br>fi</p>
<p>case “$1” in<br>    ‘start’ )<br>        “$mysqld_multi” –defaults-extra-file=$conf start $2<br>        ;;<br>    ‘stop’ )<br>        “$mysqld_multi” –defaults-extra-file=$conf stop $2<br>        ;;<br>    ‘report’ )<br>        “$mysqld_multi” –defaults-extra-file=$conf report $2<br>        ;;<br>    ‘restart’ )<br>        “$mysqld_multi” –defaults-extra-file=$conf stop $2<br>        “$mysqld_multi” –defaults-extra-file=$conf start $2<br>        ;;<br>    <em>)<br>        echo “Usage: $0 {start|stop|report|restart}” &gt;&amp;2<br>        ;;<br>esac<br><em>*Master OPS</em></em></p>
<p><pre class="lang:default decode:true ">mysql -uroot -S /usr/local/mysql/data/run/mysqld_3306.sock<br>mysql&gt; GRANT REPLICATION SLAVE ON <em>.</em> TO ‘repluser’@’localhost’ IDENTIFIED BY ‘suzf.net666’;<br>Query OK, 0 rows affected (0.00 sec)</pre><br><strong>Slave OPS</strong></p>
<p><pre class="lang:default decode:true">mysql -uroot -S /usr/local/mysql/data/run/mysqld_3307.sock<br>mysql&gt; CHANGE MASTER TO<br>    -&gt; MASTER_HOST=’localhost’,<br>    -&gt; MASTER_USER=’repluser’,<br>    -&gt; MASTER_PASSWORD=’suzf.net666’,<br>    -&gt; MASTER_PORT=3306,<br>    -&gt; MASTER_AUTO_POSITION = 1;<br>Query OK, 0 rows affected, 2 warnings (0.04 sec)<br>mysql&gt; start slave;<br>Query OK, 0 rows affected (0.19 sec)</pre><br>验证</p>
<p><a href="http://suzf.net/wp-content/uploads/2016/04/gtid1.png" target="_blank" rel="external"><img src="http://suzf.net/wp-content/uploads/2016/04/gtid1.png" alt="gtid1"></a></p>
<p>##### </p>
<p>&nbsp;</p>
<h5 id="u573A_u666F_u4E8C_uFF1A_u79FB_u9664_Replication"><a href="#u573A_u666F_u4E8C_uFF1A_u79FB_u9664_Replication" class="headerlink" title="场景二：移除  Replication"></a>场景二：移除  Replication</h5><p>首先关闭 SLAVE</p>
<p><pre class="lang:default decode:true">mysql&gt; STOP SLAVE;<br>Query OK, 0 rows affected (0.00 sec)</pre><br>使用ALL 参数 重置 SLAVE (MySQL &gt;= 5.6.7):</p>
<p><pre class="lang:default decode:true">mysql&gt; RESET SLAVE ALL;<br>Query OK, 0 rows affected (0.02 sec)</pre><br>此时 mysql replication 已经消失了</p>
<p><pre class="lang:default decode:true">mysql&gt; SHOW SLAVE STATUS\G<br>Empty set (0.00 sec)</pre><br>如果你希望这个SLAVE节点继续做一个新的MASTER的slave 节点，那么请设置 gtid_purged,你应该发出一下命令（即使 gtid_puerged 看起来是空的，你也应该重置一下MASTER.）</p>
<p><pre class="lang:default decode:true">mysql&gt; reset master;<br>Query OK, 0 rows affected (0.11 sec)</pre></p>
<p>mysql&gt; show variables like ‘%gtid%’;<br>+————————–+———–+<br>| Variable_name            | Value     |<br>+————————–+———–+<br>| enforce_gtid_consistency | ON        |<br>| gtid_executed            |           |<br>| gtid_mode                | ON        |<br>| gtid_next                | AUTOMATIC |<br>| gtid_owned               |           |<br>| gtid_purged              |           |<br>+————————–+———–+<br>6 rows in set (0.00 sec)<br>备注<br>我很确定我已经删除了 rely-binary-logs. (relay_log_basename variable)</p>
<p>&nbsp;</p>
<h5 id="u573A_u666F_u4E09_uFF1A_u62F7_u8D1D_u6570_u636E__u65B0_u5EFA_GTID_slave"><a href="#u573A_u666F_u4E09_uFF1A_u62F7_u8D1D_u6570_u636E__u65B0_u5EFA_GTID_slave" class="headerlink" title="场景三：拷贝数据 新建 GTID slave"></a>场景三：拷贝数据 新建 GTID slave</h5><h4 id="Using_mysqldump"><a href="#Using_mysqldump" class="headerlink" title="Using mysqldump"></a>Using mysqldump</h4><p>在 slave 几点初始化数据库</p>
<p><pre class="lang:default decode:true ">$ ./scripts/mysql_install_db –datadir=/usr/local/mysql/data/mysql_3307</pre><br>为了更简单使用 mysqldump, 是将下列参数加入配置文件</p>
<p><pre class="lang:default decode:true">[mysqldump]<br>quick<br>max_allowed_packet = 16M<br>port = 3306<br>socket = /usr/local/mysql/data/run/mysqld_3306.sock<br></pre><br>之后使用下面命令导出 Master 节点的 Cherry 数据库</p>
<p><pre class="lang:default decode:true">$ mysqldump –defaults-file=/usr/local/mysql/data/etc/my.cnf –user=root –password=<code>cat ~mysql/.root_password</code> –single-transaction –databases Cherry &gt; backup.sql<br>Warning: Using a password on the command line interface can be insecure.<br>Warning: A partial dump from a server that has GTIDs will by default include the GTIDs of all transactions, even those that changed suppressed parts of the database. If you don’t want to restore GTIDs, pass –set-gtid-purged=OFF. To make a complete dump, pass –all-databases –triggers –routines –events.</pre><br>备注<br>–defaults-file 参数必须放在第一个位置, 否则你将会入到一个我认为已经修复的<a href="http://bugs.mysql.com/bug.php?id=31312" target="_blank" rel="external"> bug</a>.</p>
<p>GTID 的诀窍在这里，当然它是通过 mysqldump 来实现的</p>
<p><pre class="lang:default decode:true">$grep -i gtid 、/tmp/backup.sql<br>– GTID state at the beginning of the backup<br>SET @@GLOBAL.GTID_PURGED=’770d3753-c6e4-11e2-8e78-080027d93e15:1-8’;</pre><br>之后将dump 文件传送到 slave 节点，然后导入它；</p>
<p><pre class="lang:default decode:true">mysql&gt; source /tmp/backup.sql;</pre><br>我最初得到了下面的错误：</p>
<p><pre class="lang:default decode:true">ERROR 1840 (HY000): @@GLOBAL.GTID_PURGED can only be set when @@GLOBAL.GTID_EXECUTED is empty.</pre><br>但是我的 gtid_executed 参数是空的:</p>
<p><pre class="lang:default decode:true">mysql&gt; show variables like ‘%gtid%’;<br>+————————–+——————————————+<br>| Variable_name            | Value                                    |<br>+————————–+——————————————+<br>| enforce_gtid_consistency | ON                                       |<br>| gtid_executed            |                                          |<br>| gtid_mode                | ON                                       |<br>| gtid_next                | AUTOMATIC                                |<br>| gtid_owned               |                                          |<br>| gtid_purged              | 770d3753-c6e4-11e2-8e78-080027d93e15:1-6 |<br>+————————–+——————————————+<br>6 rows in set (0.00 sec)</pre><br>错误消息显示冲突 一个<a href="http://bugs.mysql.com/bug.php?id=68038" target="_blank" rel="external">bug</a>已经打开。实际上，gtid_purged也必须是空的，以便能够设置它。<a href="http://dev.mysql.com/doc/refman/5.6/en/replication-options-gtids.html" target="_blank" rel="external">官方文档</a>中引用的唯一解决方法是使用下面的命令：</p>
<p><pre class="lang:default decode:true">mysql&gt; DROP DATABASE replicationdb;<br>Query OK, 1 row affected (0.07 sec)</pre></p>
<p>mysql&gt; RESET MASTER;<br>Query OK, 0 rows affected (0.06 sec)</p>
<p>mysql&gt; SHOW VARIABLES LIKE ‘%gtid%’;<br>+————————–+———–+<br>| Variable_name            | Value     |<br>+————————–+———–+<br>| enforce_gtid_consistency | ON        |<br>| gtid_executed            |           |<br>| gtid_mode                | ON        |<br>| gtid_next                | AUTOMATIC |<br>| gtid_owned               |           |<br>| gtid_purged              |           |<br>+————————–+———–+<br>6 rows in set (0.01 sec)<br><br>一旦完成你可以从新导入备份文件，如果最后没有错误出现，那么现在可以设置 replication 了。</p>
<p><pre class="lang:default decode:true">mysql&gt; change master to master_host=’lab.suzf.net’, master_port=3306, master_user=’repluser’, master_password=’suzf.net666’, master_auto_position=1;<br>Query OK, 0 rows affected, 2 warnings (0.16 sec)</pre></p>
<p>mysql&gt; start slave;<br>Query OK, 0 rows affected (0.03 sec)</p>
<p>mysql&gt; SHOW SLAVE STATUS\G<br><strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong> 1. row <strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong></p>
<pre><code>       Slave_IO_Running: Yes
      Slave_SQL_Running: Yes
          ... ...
Slave_SQL_Running_State: Slave has read all relay log; waiting for the slave I/O thread to update it&lt;/pre&gt;
</code></pre><p>如果使用的是mysql 5.5 可能会用到</p>
<p><pre class="lang:default decode:true">change master to master_host=’lab.suzf.net’, master_port=3306, master_user=’repluser’, master_password=’suzf.net666’,  master_log_file=’mysql-bin.000006’, master_log_pos=1026;</pre><br>从哪里可以获得 master_log_file 和 log_position（在你导入数据时请不要将 master 设置为 read-only ）</p>
<p><pre class="lang:default decode:true ">mysql&gt; FLUSH TABLES WITH READ LOCK;<br>mysql&gt; SHOW MASTER STATUS;</pre><br>&nbsp;</p>
<h4 id="Using_XtraBackup"><a href="#Using_XtraBackup" class="headerlink" title="Using XtraBackup"></a>Using XtraBackup</h4><p>准备工作</p>
<p><pre class="lang:default decode:true ">$mkdir  /opt/data/backup/mysql -p<br>$ cat 3306.cnf<br>[mysqld]<br>socket = /usr/local/mysql/data/run/mysqld_3306.sock<br>port = 3306<br>pid-file = /usr/local/mysql/data/run/mysqld_3306.pid<br>datadir = /usr/local/mysql/data/mysql_3306</pre></p>
<h1 id="set_for_GTID_Replication-2"><a href="#set_for_GTID_Replication-2" class="headerlink" title="set for GTID Replication"></a>set for GTID Replication</h1><p>server_id = 3232237894<br>gtid_mode = on<br>enforce_gtid_consistency = on</p>
<h1 id="binlog-1"><a href="#binlog-1" class="headerlink" title="binlog"></a>binlog</h1><p>log-bin = /usr/local/mysql/data/binlogs/master-binlog<br>log-slave-updates = 1<br>binlog_format = row</p>
<h1 id="rely_log-2"><a href="#rely_log-2" class="headerlink" title="rely log"></a>rely log</h1><p>skip_slave_start=1</p>
<p>[client]<br>default-character-set = utf8</p>
<p>$ cat 3307.cnf<br>[mysqld]<br>socket = /usr/local/mysql/data/run/mysqld_3307.sock<br>port = 3307<br>pid-file = /usr/local/mysql/data/run/mysqld_3307.pid<br>datadir = /usr/local/mysql/data/mysql_3307</p>
<h1 id="set_for_GTID_Replication-3"><a href="#set_for_GTID_Replication-3" class="headerlink" title="set for GTID Replication"></a>set for GTID Replication</h1><p>server_id = 3232237866<br>gtid_mode = on<br>enforce_gtid_consistency = on</p>
<h1 id="bin_log-1"><a href="#bin_log-1" class="headerlink" title="bin log"></a>bin log</h1><p>log-bin = /usr/local/mysql/data/binlogs/slave-binlog<br>log-slave-updates = 1<br>binlog_format = row</p>
<h1 id="rely_log-3"><a href="#rely_log-3" class="headerlink" title="rely log"></a>rely log</h1><p>skip_slave_start=1</p>
<p>[client]<br>default-character-set = utf8<br>我们将使用下面命令完整数据库备份：</p>
<p><pre class="lang:default decode:true">$innobackupex –defaults-file=/opt/data/backup/mysql/3306.cnf –user=root  –socket=/usr/local/mysql/data/run/mysqld_3306.sock  /tmp</pre><br><a href="http://suzf.net/wp-content/uploads/2016/04/innobackup.png" target="_blank" rel="external"><img src="http://suzf.net/wp-content/uploads/2016/04/innobackup.png" alt="innobackup"></a></p>
<p>这里要注意的重要的文件是在xtrabackup_binlog_info</p>
<p><pre class="lang:default decode:true ">$ cat /tmp/2016-04-05_15-26-40/xtrabackup_binlog_info<br>master-binlog.000006  191 81ee72fe-c957-11e5-ae70-0800272aa66e:1-12</pre><br>在 Slave 节点恢复数据</p>
<p><pre class="lang:default decode:true ">$ innobackupex –defaults-file=/opt/data/backup/mysql/3307.cnf –user=root  –copy-back /tmp/2016-04-05_15-26-40</pre><br>备注<br>Original data directory must be empty!<br>即 Slave 节点数据目录必须为空</p>
<p>权限修复 启动实例</p>
<p><pre class="lang:default decode:true ">$ chown -R mysql:mysql  /usr/local/mysql/data/mysql_3307<br>$ /etc/init.d/mysqld_multi.server start 3307<br>$ /etc/init.d/mysqld_multi.server report<br>Reporting MySQL servers<br>MySQL server from group: mysqld3306 is running<br>MySQL server from group: mysqld3307 is running</pre><br>你需要先设置 gtid_purged 然后再创建 replication，在 <a href="https://www.percona.com/doc/percona-xtrabackup/2.1/howtos/recipes_ibkx_gtid.html" target="_blank" rel="external">Percona 文档 </a>中有说明</p>
<p><pre class="lang:default decode:true ">mysql&gt;  SET GLOBAL gtid_purged=”81ee72fe-c957-11e5-ae70-0800272aa66e:1-12”;<br>ERROR 1840 (HY000): @@GLOBAL.GTID_PURGED can only be set when @@GLOBAL.GTID_EXECUTED is empty.</pre></p>
<h1 id="u51FA_u73B0_u4E0A_u9762_u4E2A_u9519_u8BEF__u6267_u884C_u4E0B_u9762_u64CD_u4F5C"><a href="#u51FA_u73B0_u4E0A_u9762_u4E2A_u9519_u8BEF__u6267_u884C_u4E0B_u9762_u64CD_u4F5C" class="headerlink" title="出现上面个错误 执行下面操作"></a>出现上面个错误 执行下面操作</h1><p>mysql&gt; reset master;<br>Query OK, 0 rows affected (0.02 sec)</p>
<p>mysql&gt;  SET GLOBAL gtid_purged=”81ee72fe-c957-11e5-ae70-0800272aa66e:1-12”;<br>Query OK, 0 rows affected (0.05 sec)</p>
<p>mysql&gt; CHANGE MASTER TO<br>    -&gt; MASTER_HOST=’localhost’,<br>    -&gt; MASTER_USER=’repluser’,<br>    -&gt; MASTER_PASSWORD=’suzf.net666’,<br>    -&gt; MASTER_PORT=3306,<br>    -&gt; MASTER_AUTO_POSITION = 1;<br>Query OK, 0 rows affected, 2 warnings (0.06 sec)</p>
<p>mysql&gt; SHOW WARNINGS;<br>+——-+——+————————————————————————————————————————————————————————————————————————————————————————————–+<br>| Level | Code | Message                                                                                                                                                                                                                                                                              |<br>+——-+——+————————————————————————————————————————————————————————————————————————————————————————————–+<br>| Note  | 1759 | Sending passwords in plain text without SSL/TLS is extremely insecure.                                                                                                                                                                                                               |<br>| Note  | 1760 | Storing MySQL user name or password information in the master info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START SLAVE; see the ‘START SLAVE Syntax’ in the MySQL Manual for more information. |<br>+——-+——+————————————————————————————————————————————————————————————————————————————————————————————–+<br>2 rows in set (0.00 sec)<br>在经典的复制中（MySQL的5.5及以下）命令应该是这样的：</p>
<p><pre class="lang:default decode:true ">change master to master_host=’lab.suzf.net’, master_port=3306, master_user=’repluser’, master_password=’suzf.net666’,  master_log_file=’mysql-bin.000006’, master_log_pos=1026;</pre><br>启动 slave 查看状态</p>
<p><pre class="lang:default decode:true ">mysql&gt; start slave;<br>Query OK, 0 rows affected (0.01 sec)</pre></p>
<p>mysql&gt; show slave status\G<br>             Slave_IO_Running: Yes<br>            Slave_SQL_Running: Yes<br>      Slave_SQL_Running_State: Slave has read all relay log; waiting for the slave I/O thread to update it<br>           Retrieved_Gtid_Set: 81ee72fe-c957-11e5-ae70-0800272aa66e:13<br>            Executed_Gtid_Set: 81ee72fe-c957-11e5-ae70-0800272aa66e:1-13<br>                Auto_Position: 1<br>&nbsp;</p>
<p>&nbsp;</p>
<h5 id="u573A_u666F_u56DB_uFF1A_u7ECF_u5178_u590D_u5236__u2013_26gt_3B_GTID_Replication"><a href="#u573A_u666F_u56DB_uFF1A_u7ECF_u5178_u590D_u5236__u2013_26gt_3B_GTID_Replication" class="headerlink" title="场景四：经典复制 –&gt; GTID Replication"></a>场景四：经典复制 –&gt; GTID Replication</h5><p>a. 按场景一中描述配置参数文件<br>b. 所有服务器设置global.read_only参数，等待主从服务器同步完毕；<br>mysql&gt; SET @@global.read_only = ON;<br>c. 依次重启主从服务器；<br>d. 使用change master 更新主从配置；<br>mysql&gt; CHANGE MASTER TO<br>&gt; MASTER_HOST = host,<br>&gt; MASTER_PORT = port,<br>&gt; MASTER_USER = user,<br>&gt; MASTER_PASSWORD = password,<br>&gt; MASTER_AUTO_POSITION = 1;<br>e. 从库开启复制<br>mysql&gt; START SLAVE;<br>f. 验证主从复制</p>
<p>##### </p>
<h3 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h3><h3 id="Skip_counter_with_GTID"><a href="#Skip_counter_with_GTID" class="headerlink" title="Skip counter with GTID"></a>Skip counter with GTID</h3><p><pre class="lang:default decode:true mysql ">mysql&gt; show slave status\G<br><strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong> 1. row <strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong><br>           Retrieved_Gtid_Set: 770d3753-c6e4-11e2-8e78-080027d93e15:1-9<br>            Executed_Gtid_Set: 770d3753-c6e4-11e2-8e78-080027d93e15:1-7,<br>97e23f6a-cc52-11e2-b1e1-08002776e125:1-2<br>                Auto_Position: 1<br>1 row in set (0.00 sec)</pre><br>从上面我们可以猜测到 事务执行到 事务ID 8 可能出现错误，接下来我们需要注入相同的空事务ID。</p>
<p><pre class="lang:default decode:true mysql">mysql&gt; stop slave;<br>Query OK, 0 rows affected (0.00 sec)</pre></p>
<p>mysql&gt; show variables like ‘%gtid%’;<br>+————————–+———–+<br>| Variable_name            | Value     |<br>+————————–+———–+<br>| enforce_gtid_consistency | ON        |<br>| gtid_executed            |           |<br>| gtid_mode                | ON        |<br>| gtid_next                | AUTOMATIC |<br>| gtid_owned               |           |<br>| gtid_purged              |           |<br>+————————–+———–+<br>6 rows in set (0.00 sec)</p>
<p>mysql&gt; set gtid_next=’770d3753-c6e4-11e2-8e78-080027d93e15:8’;<br>Query OK, 0 rows affected (0.00 sec)</p>
<p>mysql&gt; begin;<br>Query OK, 0 rows affected (0.00 sec)</p>
<p>mysql&gt; commit;<br>Query OK, 0 rows affected (0.00 sec)</p>
<p>mysql&gt; set gtid_next=’AUTOMATIC’;<br>Query OK, 0 rows affected (0.00 sec)</p>
<p>mysql&gt; start slave;<br>Query OK, 0 rows affected (0.00 sec)<br>&nbsp;</p>
<p>Reference : <a href="https://dev.mysql.com/doc/refman/5.6/en/replication-gtids.html" target="_blank" rel="external">Mysql manual</a></p>
<p>&nbsp;</p>
  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/GTID/">GTID</a><a href="/tags/Mysql/">Mysql</a>
  </div>


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Mysql/">Mysql</a>
</div>



<div class="article-share" id="share">

  <div data-url="http://blog.suzf.net/2016/04/01/How-to_setup_gtid_on_replication/" data-title="How-to setup gtid on replication | Suzf Blog" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2016/04/03/pip_faq_-_Cannot_fetch_index_base_URL/" title="pip_faq - Cannot fetch index base URL">
  <strong>PREVIOUS:</strong><br/>
  <span>
  pip_faq - Cannot fetch index base URL</span>
</a>
</div>


<div class="next">
<a href="/2016/04/01/Mysql_GTID_简述/"  title="Mysql GTID 简述">
 <strong>NEXT:</strong><br/> 
 <span>Mysql GTID 简述
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
  <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#u51C6_u5907_u5DE5_u4F5C"><span class="toc-number">1.</span> <span class="toc-text">准备工作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u5B9E_u9A8C_u73AF_u5883"><span class="toc-number">2.</span> <span class="toc-text">实验环境</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#u573A_u666F_u4E00_uFF1A_u65B0_u673A_u5668__u65E0_u6570_u636E"><span class="toc-number">2.0.1.</span> <span class="toc-text">场景一：新机器 无数据</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#master"><span class="toc-number"></span> <span class="toc-text">master</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#set_for_GTID_Replication"><span class="toc-number"></span> <span class="toc-text">set for GTID Replication</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#binlog"><span class="toc-number"></span> <span class="toc-text">binlog</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#rely_log"><span class="toc-number"></span> <span class="toc-text">rely log</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#slave"><span class="toc-number"></span> <span class="toc-text">slave</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#set_for_GTID_Replication-1"><span class="toc-number"></span> <span class="toc-text">set for GTID Replication</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#bin_log"><span class="toc-number"></span> <span class="toc-text">bin log</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#rely_log-1"><span class="toc-number"></span> <span class="toc-text">rely log</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#A_simple_startup_script_for_mysqld_multi_by_Tim_Smith_and_Jani_Tolonen"><span class="toc-number"></span> <span class="toc-text">A simple startup script for mysqld_multi by Tim Smith and Jani Tolonen.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#This_script_assumes_that_my-cnf_file_exists_either_in_/etc/my-cnf_or"><span class="toc-number"></span> <span class="toc-text">This script assumes that my.cnf file exists either in /etc/my.cnf or</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#/root/-my-cnf_and_has_groups__5Bmysqld_multi_5D_and__5BmysqldN_5D-_See_the"><span class="toc-number"></span> <span class="toc-text">/root/.my.cnf and has groups [mysqld_multi] and [mysqldN]. See the</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mysqld_multi_documentation_for_detailed_instructions"><span class="toc-number"></span> <span class="toc-text">mysqld_multi documentation for detailed instructions.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#This_script_can_be_used_as_/etc/init-d/mysql-server"><span class="toc-number"></span> <span class="toc-text">This script can be used as /etc/init.d/mysql.server</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Comments_to_support_chkconfig_on_RedHat_Linux"><span class="toc-number"></span> <span class="toc-text">Comments to support chkconfig on RedHat Linux</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#chkconfig_3A_2345_64_36"><span class="toc-number"></span> <span class="toc-text">chkconfig: 2345 64 36</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#description_3A_A_very_fast_and_reliable_SQL_database_engine"><span class="toc-number"></span> <span class="toc-text">description: A very fast and reliable SQL database engine.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Version_1-0"><span class="toc-number"></span> <span class="toc-text">Version 1.0</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#u573A_u666F_u4E8C_uFF1A_u79FB_u9664_Replication"><span class="toc-number">0.0.1.</span> <span class="toc-text">场景二：移除  Replication</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#u573A_u666F_u4E09_uFF1A_u62F7_u8D1D_u6570_u636E__u65B0_u5EFA_GTID_slave"><span class="toc-number">0.0.2.</span> <span class="toc-text">场景三：拷贝数据 新建 GTID slave</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Using_mysqldump"><span class="toc-number">0.1.</span> <span class="toc-text">Using mysqldump</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Using_XtraBackup"><span class="toc-number">0.2.</span> <span class="toc-text">Using XtraBackup</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#set_for_GTID_Replication-2"><span class="toc-number"></span> <span class="toc-text">set for GTID Replication</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#binlog-1"><span class="toc-number"></span> <span class="toc-text">binlog</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#rely_log-2"><span class="toc-number"></span> <span class="toc-text">rely log</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#set_for_GTID_Replication-3"><span class="toc-number"></span> <span class="toc-text">set for GTID Replication</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#bin_log-1"><span class="toc-number"></span> <span class="toc-text">bin log</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#rely_log-3"><span class="toc-number"></span> <span class="toc-text">rely log</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#u51FA_u73B0_u4E0A_u9762_u4E2A_u9519_u8BEF__u6267_u884C_u4E0B_u9762_u64CD_u4F5C"><span class="toc-number"></span> <span class="toc-text">出现上面个错误 执行下面操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#u573A_u666F_u56DB_uFF1A_u7ECF_u5178_u590D_u5236__u2013_26gt_3B_GTID_Replication"><span class="toc-number">0.0.1.</span> <span class="toc-text">场景四：经典复制 –> GTID Replication</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FAQ"><span class="toc-number">1.</span> <span class="toc-text">FAQ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Skip_counter_with_GTID"><span class="toc-number">2.</span> <span class="toc-text">Skip counter with GTID</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
			<li><a href="/categories/Apache/" title="Apache">Apache<sup>1</sup></a></li>
		
			<li><a href="/categories/Auto-ops/" title="Auto ops">Auto ops<sup>3</sup></a></li>
		
			<li><a href="/categories/CouchBase/" title="CouchBase">CouchBase<sup>1</sup></a></li>
		
			<li><a href="/categories/HA/" title="HA">HA<sup>1</sup></a></li>
		
			<li><a href="/categories/Hadoop/" title="Hadoop">Hadoop<sup>6</sup></a></li>
		
			<li><a href="/categories/Hardware/" title="Hardware">Hardware<sup>1</sup></a></li>
		
			<li><a href="/categories/Highcharts/" title="Highcharts">Highcharts<sup>1</sup></a></li>
		
			<li><a href="/categories/LVS/" title="LVS">LVS<sup>1</sup></a></li>
		
			<li><a href="/categories/Life/" title="Life">Life<sup>3</sup></a></li>
		
			<li><a href="/categories/Linux/" title="Linux">Linux<sup>27</sup></a></li>
		
			<li><a href="/categories/MongoDB/" title="MongoDB">MongoDB<sup>3</sup></a></li>
		
			<li><a href="/categories/Mysql/" title="Mysql">Mysql<sup>10</sup></a></li>
		
			<li><a href="/categories/Nginx/" title="Nginx">Nginx<sup>5</sup></a></li>
		
			<li><a href="/categories/Oracle/" title="Oracle">Oracle<sup>2</sup></a></li>
		
			<li><a href="/categories/PHP/" title="PHP">PHP<sup>1</sup></a></li>
		
			<li><a href="/categories/Puppet/" title="Puppet">Puppet<sup>6</sup></a></li>
		
			<li><a href="/categories/Python/" title="Python">Python<sup>23</sup></a></li>
		
			<li><a href="/categories/Redis/" title="Redis">Redis<sup>7</sup></a></li>
		
			<li><a href="/categories/Shell/" title="Shell">Shell<sup>2</sup></a></li>
		
			<li><a href="/categories/Tomcat/" title="Tomcat">Tomcat<sup>1</sup></a></li>
		
			<li><a href="/categories/Web/" title="Web">Web<sup>5</sup></a></li>
		
			<li><a href="/categories/Zabbix/" title="Zabbix">Zabbix<sup>13</sup></a></li>
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			<li><a href="/tags/Apache/" title="Apache">Apache<sup>1</sup></a></li>
		
			<li><a href="/tags/CMD/" title="CMD">CMD<sup>1</sup></a></li>
		
			<li><a href="/tags/Ceph/" title="Ceph">Ceph<sup>2</sup></a></li>
		
			<li><a href="/tags/Debian/" title="Debian">Debian<sup>1</sup></a></li>
		
			<li><a href="/tags/ELK/" title="ELK">ELK<sup>1</sup></a></li>
		
			<li><a href="/tags/Exsi/" title="Exsi">Exsi<sup>1</sup></a></li>
		
			<li><a href="/tags/Flask/" title="Flask">Flask<sup>1</sup></a></li>
		
			<li><a href="/tags/GTID/" title="GTID">GTID<sup>2</sup></a></li>
		
			<li><a href="/tags/Kernel/" title="Kernel">Kernel<sup>2</sup></a></li>
		
			<li><a href="/tags/Kickstart/" title="Kickstart">Kickstart<sup>1</sup></a></li>
		
			<li><a href="/tags/LB/" title="LB">LB<sup>1</sup></a></li>
		
			<li><a href="/tags/LVS/" title="LVS">LVS<sup>1</sup></a></li>
		
			<li><a href="/tags/Life/" title="Life">Life<sup>1</sup></a></li>
		
			<li><a href="/tags/Linux/" title="Linux">Linux<sup>1</sup></a></li>
		
			<li><a href="/tags/Lnmp/" title="Lnmp">Lnmp<sup>1</sup></a></li>
		
			<li><a href="/tags/Log/" title="Log">Log<sup>1</sup></a></li>
		
			<li><a href="/tags/MongoDB/" title="MongoDB">MongoDB<sup>3</sup></a></li>
		
			<li><a href="/tags/Mysql/" title="Mysql">Mysql<sup>15</sup></a></li>
		
			<li><a href="/tags/Nginx/" title="Nginx">Nginx<sup>8</sup></a></li>
		
			<li><a href="/tags/NoSQL/" title="NoSQL">NoSQL<sup>4</sup></a></li>
		
		</ul>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello, I&#39;m a linuser. <br/>
			This is my blog, share with you. ^_^</p>
	</section>
	 
	<div class="social-font clearfix">
		
		
		
		<a href="https://github.com/oceanszf" target="_blank" title="github"></a>
		
		
		
	</div>
    <p class="copyright">Copyright © 2016 <a href="http://suzf.net" target="_blank" title="SUZF.NET">SUZF.NET</a> All Rights Reserved.
<!--		
		<a href="http://blog.suzf.net" target="_blank" title="Jeffrey Su">Jeffrey Su</a>
		
        -->
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"Comment"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 





  </body>
</html>

